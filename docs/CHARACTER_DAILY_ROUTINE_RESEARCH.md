# ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ—¥å¸¸ã‚µã‚¤ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ  - ãƒªã‚µãƒ¼ãƒãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2025-10-23
**èª¿æŸ»å¯¾è±¡**: ä»–ã‚²ãƒ¼ãƒ ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å‹•ä½œãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå‡ºå‹¤ãƒ»åƒããƒ»é€€å‹¤ï¼‰ã®å®Ÿè£…æ–¹æ³•

---

## ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

ã‚«ã‚¤ãƒ­ã‚½ãƒ•ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ—¥å¸¸ã‚µã‚¤ã‚¯ãƒ«ï¼ˆå‡ºå‹¤â†’åƒãâ†’é€€å‹¤ï¼‰ã¯ã€**è¡Œå‹•ãƒ„ãƒªãƒ¼(Behavior Tree)**ã¨**ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³(State Machine)**ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§å®Ÿè£…å¯èƒ½ã§ã™ã€‚

### å®Ÿè£…å¯èƒ½æ€§: âœ… **é«˜ã„ï¼ˆJavaScript/Canvasã§ååˆ†å®Ÿç¾å¯èƒ½ï¼‰**

---

## èª¿æŸ»çµæœ

### 1. ã‚«ã‚¤ãƒ­ã‚½ãƒ•ãƒˆã‚²ãƒ¼ãƒ ã®ç‰¹å¾´

#### ã‚²ãƒ¼ãƒ ä¾‹
- Game Dev Storyï¼ˆã‚²ãƒ¼ãƒ ç™ºå±•å›½ï¼‰
- Hot Springs Storyï¼ˆæ¸©æ³‰ç‰©èªï¼‰
- Anime Studio Storyï¼ˆã‚¢ãƒ‹ãƒ¡ã‚¹ã‚¿ã‚¸ã‚ªç‰©èªï¼‰

#### è¦³å¯Ÿã•ã‚ŒãŸã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å‹•ä½œ
1. **å‡ºå‹¤**
   - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒç”»é¢å¤–ï¼ˆã¾ãŸã¯å…¥å£ï¼‰ã‹ã‚‰ç™»å ´
   - è‡ªåˆ†ã®ãƒ‡ã‚¹ã‚¯ã«å‘ã‹ã£ã¦ç§»å‹•

2. **åƒã**
   - ãƒ‡ã‚¹ã‚¯ã§ä½œæ¥­ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã€æ›¸é¡å‡¦ç†ï¼‰
   - ãƒ©ãƒ³ãƒ€ãƒ ã«æ–½è¨­ã‚’åˆ©ç”¨ï¼ˆä¼‘æ†©æ‰€ã€ä¼šè­°å®¤ï¼‰
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸­ã¯ç‰¹å®šã‚¨ãƒªã‚¢ã«é›†ã¾ã‚‹

3. **é€€å‹¤**
   - æ™‚é–“ã«ãªã‚‹ã¨å‡ºå£ã«å‘ã‹ã£ã¦ç§»å‹•
   - ç”»é¢å¤–ã«æ¶ˆãˆã‚‹

#### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **é–‹ç™ºã‚¨ãƒ³ã‚¸ãƒ³**: Unityï¼ˆã‚«ã‚¤ãƒ­ã‚½ãƒ•ãƒˆå…¬å¼ç™ºè¡¨ï¼‰
- **ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯**: ãƒ‰ãƒƒãƒˆçµµãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆï¼ˆ16x16 or 32x32ï¼‰
- **è¦–ç‚¹**: ã‚¯ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ“ãƒ¥ãƒ¼ï¼ˆæ–œã‚ä¸Šã‹ã‚‰è¦‹ãŸ2.5Dé¢¨ï¼‰

---

## 2. æ¥­ç•Œæ¨™æº–ã®å®Ÿè£…æ‰‹æ³•

### 2.1 è¡Œå‹•ãƒ„ãƒªãƒ¼ (Behavior Tree)

#### æ¦‚è¦
NPCã®æ„æ€æ±ºå®šã‚’æœ¨æ§‹é€ ã§è¡¨ç¾ã™ã‚‹æ‰‹æ³•ã€‚2025å¹´ç¾åœ¨ã€ã‚²ãƒ¼ãƒ AIã®æ¥­ç•Œæ¨™æº–ã€‚

#### ä¸»ãªæ¡ç”¨ä¾‹
- **Halo**: æ•µAIæˆ¦é—˜è¡Œå‹•
- **The Last of Us**: ã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³AI
- **å¤šæ•°ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ **: å¸‚æ°‘/åŠ´åƒè€…NPC

#### æ§‹é€ ä¾‹ï¼ˆå¾“æ¥­å“¡ã®1æ—¥ï¼‰

```
Root (Selector)
â”œâ”€ å‡ºå‹¤ãƒ•ã‚§ãƒ¼ã‚º (Sequence)
â”‚  â”œâ”€ æ™‚åˆ»ãƒã‚§ãƒƒã‚¯: 9:00ï½9:30ã‹ï¼Ÿ
â”‚  â”œâ”€ å…¥å£ã«ç§»å‹•
â”‚  â””â”€ ãƒ‡ã‚¹ã‚¯ã«ç§»å‹•
â”œâ”€ å‹¤å‹™ãƒ•ã‚§ãƒ¼ã‚º (Selector)
â”‚  â”œâ”€ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæ¥­ (Sequence)
â”‚  â”‚  â”œâ”€ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‰²å½“ã‚ã‚‹ã‹ï¼Ÿ
â”‚  â”‚  â”œâ”€ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¨ãƒªã‚¢ã«ç§»å‹•
â”‚  â”‚  â””â”€ ä½œæ¥­ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
â”‚  â”œâ”€ ä¼‘æ†© (Sequence)
â”‚  â”‚  â”œâ”€ ç–²åŠ´åº¦ãƒã‚§ãƒƒã‚¯: 70%ä»¥ä¸Šã‹ï¼Ÿ
â”‚  â”‚  â”œâ”€ ä¼‘æ†©å®¤ã«ç§»å‹•
â”‚  â”‚  â””â”€ ä¼‘æ†©ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
â”‚  â””â”€ ãƒ‡ã‚¹ã‚¯ä½œæ¥­ (Default)
â”‚     â”œâ”€ ãƒ‡ã‚¹ã‚¯ã«ç§»å‹•
â”‚     â””â”€ ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
â””â”€ é€€å‹¤ãƒ•ã‚§ãƒ¼ã‚º (Sequence)
   â”œâ”€ æ™‚åˆ»ãƒã‚§ãƒƒã‚¯: 18:00ä»¥é™ã‹ï¼Ÿ
   â”œâ”€ å‡ºå£ã«ç§»å‹•
   â””â”€ ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
```

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… è¦–è¦šçš„ã«ç†è§£ã—ã‚„ã™ã„
- âœ… ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ãŒå®¹æ˜“
- âœ… ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„
- âœ… è¤‡é›‘ãªè¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¯¾å¿œ

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âš ï¸ åˆæœŸè¨­è¨ˆã«æ™‚é–“ãŒã‹ã‹ã‚‹
- âš ï¸ JavaScriptå®Ÿè£…ã«ã¯å°‚ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ï¼ˆã¾ãŸã¯è‡ªä½œï¼‰

---

### 2.2 ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ (State Machine)

#### æ¦‚è¦
ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®çŠ¶æ…‹ã‚’æ˜ç¢ºã«å®šç¾©ã—ã€çŠ¶æ…‹é–“ã®é·ç§»ã‚’ç®¡ç†ã™ã‚‹æ‰‹æ³•ã€‚

#### çŠ¶æ…‹ä¾‹ï¼ˆå¾“æ¥­å“¡ã®1æ—¥ï¼‰

```javascript
const EmployeeStates = {
    COMMUTING_IN: {
        enter: () => moveToEntrance(),
        update: (dt) => updateMovement(),
        exit: () => arrivedAtDesk()
    },
    IDLE_AT_DESK: {
        enter: () => playIdleAnimation(),
        update: (dt) => {
            if (hasTask()) transition('WORKING');
            if (isTired()) transition('RESTING');
            if (isEndOfDay()) transition('COMMUTING_OUT');
        },
        exit: () => stopIdleAnimation()
    },
    WORKING: {
        enter: () => moveToWorkArea(),
        update: (dt) => {
            progressWork(dt);
            if (taskComplete()) transition('IDLE_AT_DESK');
        },
        exit: () => completeTask()
    },
    RESTING: {
        enter: () => moveToBreakRoom(),
        update: (dt) => {
            recoverEnergy(dt);
            if (energyFull()) transition('IDLE_AT_DESK');
        },
        exit: () => leaveBreakRoom()
    },
    COMMUTING_OUT: {
        enter: () => moveToExit(),
        update: (dt) => updateMovement(),
        exit: () => employeeLeft()
    }
};
```

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… ã‚·ãƒ³ãƒ—ãƒ«ã§å®Ÿè£…ãŒå®¹æ˜“
- âœ… JavaScriptæ¨™æº–æ©Ÿèƒ½ã ã‘ã§å®Ÿè£…å¯èƒ½
- âœ… ãƒ‡ãƒãƒƒã‚°ãŒç°¡å˜
- âœ… è»½é‡ã§é«˜é€Ÿ

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âš ï¸ è¤‡é›‘ãªè¡Œå‹•ã§ã¯çŠ¶æ…‹çˆ†ç™ºãŒèµ·ãã‚‹
- âš ï¸ éšå±¤çš„ãªè¡Œå‹•è¡¨ç¾ãŒé›£ã—ã„

---

### 2.3 ã‚¢ã‚¤ãƒ‰ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

#### è‡ªç„¶ãªå¾…æ©Ÿå‹•ä½œã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

ãƒªã‚µãƒ¼ãƒã‹ã‚‰å¾—ã‚‰ã‚ŒãŸçŸ¥è¦‹ï¼š

> "A common structure for an idle animation loop is to have a **primary looped behavior** which may be broken up by **intermittent behaviors**."

#### å®Ÿè£…ä¾‹

```javascript
class EmployeeIdleAnimation {
    constructor(employee) {
        this.employee = employee;
        this.primaryLoopDuration = 5000; // 5ç§’
        this.intermittentChance = 0.2; // 20%ã®ç¢ºç‡
        this.lastIntermittent = 0;
    }

    update(deltaTime) {
        // ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ«ãƒ¼ãƒ—: å‘¼å¸ã€å°ã•ãªå‹•ã
        this.playBreathingAnimation();

        // ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒŸãƒƒãƒˆãªå‹•ä½œ
        if (Math.random() < this.intermittentChance &&
            Date.now() - this.lastIntermittent > 10000) {
            this.playIntermittentBehavior();
            this.lastIntermittent = Date.now();
        }
    }

    playIntermittentBehavior() {
        const behaviors = [
            'stretch',      // ä¼¸ã³ã‚’ã™ã‚‹
            'yawn',         // ã‚ãã³ã‚’ã™ã‚‹
            'look_around',  // ã‚­ãƒ§ãƒ­ã‚­ãƒ§ãƒ­ã™ã‚‹
            'adjust_hair',  // é«ªã‚’ç›´ã™
            'check_phone'   // ã‚¹ãƒãƒ›ã‚’è¦‹ã‚‹
        ];

        const random = behaviors[Math.floor(Math.random() * behaviors.length)];
        this.employee.playAnimation(random);
    }
}
```

---

## 3. æ¨å¥¨å®Ÿè£…ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ: ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ + ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†

```javascript
// ============================================
// 1. æ™‚é–“ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
// ============================================
class GameClock {
    constructor() {
        this.currentTime = 9 * 60; // 9:00 (åˆ†å˜ä½)
        this.timeSpeed = 1; // 1åˆ† = 1ç§’
        this.dayLength = 10 * 60; // 9:00ï½19:00ã®10æ™‚é–“
    }

    update(deltaTime) {
        this.currentTime += (deltaTime / 1000) * this.timeSpeed;

        // 1æ—¥çµ‚äº†
        if (this.currentTime >= 19 * 60) {
            this.currentTime = 9 * 60;
            this.onDayEnd();
        }
    }

    getCurrentHour() {
        return Math.floor(this.currentTime / 60);
    }

    getCurrentMinute() {
        return Math.floor(this.currentTime % 60);
    }

    getFormattedTime() {
        const h = this.getCurrentHour();
        const m = this.getCurrentMinute();
        return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
    }
}


// ============================================
// 2. å¾“æ¥­å“¡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
// ============================================
class EmployeeSchedule {
    constructor(employee) {
        this.employee = employee;
        this.schedule = [
            { time: '09:00', action: 'arrive', priority: 10 },
            { time: '09:15', action: 'start_work', priority: 8 },
            { time: '12:00', action: 'lunch_break', priority: 9 },
            { time: '13:00', action: 'resume_work', priority: 8 },
            { time: '15:00', action: 'afternoon_break', priority: 5, chance: 0.6 },
            { time: '18:00', action: 'end_work', priority: 10 },
            { time: '18:30', action: 'leave', priority: 10 }
        ];
    }

    getNextAction(currentTime) {
        const now = this.parseTime(currentTime);

        for (let schedule of this.schedule) {
            const scheduleTime = this.parseTime(schedule.time);

            if (scheduleTime <= now && !schedule.completed) {
                // ç¢ºç‡ãƒã‚§ãƒƒã‚¯ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãªè¡Œå‹•ï¼‰
                if (schedule.chance && Math.random() > schedule.chance) {
                    schedule.completed = true;
                    continue;
                }

                return schedule;
            }
        }

        return null;
    }

    parseTime(timeString) {
        const [h, m] = timeString.split(':').map(Number);
        return h * 60 + m;
    }

    resetDay() {
        this.schedule.forEach(s => s.completed = false);
    }
}


// ============================================
// 3. å¾“æ¥­å“¡ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³
// ============================================
class EmployeeStateMachine {
    constructor(employee, schedule, officeLayout) {
        this.employee = employee;
        this.schedule = schedule;
        this.layout = officeLayout;
        this.currentState = 'OFF_DUTY';
        this.states = this.defineStates();
    }

    defineStates() {
        return {
            OFF_DUTY: {
                enter: () => {
                    this.employee.visible = false;
                },
                update: (deltaTime, clock) => {
                    const nextAction = this.schedule.getNextAction(clock.getFormattedTime());
                    if (nextAction && nextAction.action === 'arrive') {
                        this.transition('ARRIVING');
                    }
                }
            },

            ARRIVING: {
                enter: () => {
                    this.employee.visible = true;
                    this.employee.position = this.layout.entrance;
                    this.employee.targetPosition = this.layout.getDesk(this.employee.department);
                    this.employee.playAnimation('walk');
                },
                update: (deltaTime) => {
                    this.employee.moveTowardsTarget(deltaTime);
                    if (this.employee.hasReachedTarget()) {
                        this.transition('IDLE_AT_DESK');
                    }
                }
            },

            IDLE_AT_DESK: {
                enter: () => {
                    this.employee.playAnimation('idle');
                },
                update: (deltaTime, clock) => {
                    const nextAction = this.schedule.getNextAction(clock.getFormattedTime());

                    if (!nextAction) {
                        // ãƒ©ãƒ³ãƒ€ãƒ ãªã‚¢ã‚¤ãƒ‰ãƒ«å‹•ä½œ
                        if (Math.random() < 0.01) { // 1%/ãƒ•ãƒ¬ãƒ¼ãƒ 
                            this.playRandomIdleBehavior();
                        }
                        return;
                    }

                    switch(nextAction.action) {
                        case 'start_work':
                        case 'resume_work':
                            this.transition('WORKING');
                            break;
                        case 'lunch_break':
                        case 'afternoon_break':
                            this.transition('RESTING');
                            break;
                        case 'end_work':
                            this.transition('LEAVING');
                            break;
                    }
                }
            },

            WORKING: {
                enter: () => {
                    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹å ´åˆã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¨ãƒªã‚¢ã¸
                    if (this.employee.currentProject) {
                        this.employee.targetPosition = this.layout.getProjectArea(this.employee.currentProject);
                        this.employee.playAnimation('walk');
                    } else {
                        this.employee.playAnimation('typing');
                    }
                },
                update: (deltaTime, clock) => {
                    // ç§»å‹•ä¸­ã®å ´åˆ
                    if (this.employee.isMoving) {
                        this.employee.moveTowardsTarget(deltaTime);
                        if (this.employee.hasReachedTarget()) {
                            this.employee.playAnimation('typing');
                        }
                        return;
                    }

                    // ä½œæ¥­ä¸­ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    this.employee.work(deltaTime);

                    // æ¬¡ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
                    const nextAction = this.schedule.getNextAction(clock.getFormattedTime());
                    if (nextAction && nextAction.action === 'lunch_break') {
                        this.transition('RESTING');
                    } else if (nextAction && nextAction.action === 'end_work') {
                        this.transition('IDLE_AT_DESK');
                    }
                }
            },

            RESTING: {
                enter: () => {
                    this.employee.targetPosition = this.layout.breakRoom;
                    this.employee.playAnimation('walk');
                },
                update: (deltaTime, clock) => {
                    // ç§»å‹•ä¸­
                    if (this.employee.isMoving) {
                        this.employee.moveTowardsTarget(deltaTime);
                        if (this.employee.hasReachedTarget()) {
                            this.employee.playAnimation('resting');
                        }
                        return;
                    }

                    // ä¼‘æ†©
                    this.employee.recover(deltaTime);

                    // ä¼‘æ†©çµ‚äº†
                    const nextAction = this.schedule.getNextAction(clock.getFormattedTime());
                    if (nextAction && nextAction.action === 'resume_work') {
                        // ãƒ‡ã‚¹ã‚¯ã«æˆ»ã‚‹
                        this.employee.targetPosition = this.layout.getDesk(this.employee.department);
                        this.employee.playAnimation('walk');
                        this.employee.isMoving = true;
                        this.transition('IDLE_AT_DESK');
                    }
                }
            },

            LEAVING: {
                enter: () => {
                    this.employee.targetPosition = this.layout.exit;
                    this.employee.playAnimation('walk');
                },
                update: (deltaTime) => {
                    this.employee.moveTowardsTarget(deltaTime);
                    if (this.employee.hasReachedTarget()) {
                        this.transition('OFF_DUTY');
                    }
                }
            }
        };
    }

    transition(newState) {
        if (this.states[this.currentState].exit) {
            this.states[this.currentState].exit();
        }

        console.log(`${this.employee.name}: ${this.currentState} â†’ ${newState}`);
        this.currentState = newState;

        if (this.states[this.currentState].enter) {
            this.states[this.currentState].enter();
        }
    }

    update(deltaTime, clock) {
        if (this.states[this.currentState].update) {
            this.states[this.currentState].update(deltaTime, clock);
        }
    }

    playRandomIdleBehavior() {
        const behaviors = ['stretch', 'yawn', 'look_around', 'adjust_hair'];
        const random = behaviors[Math.floor(Math.random() * behaviors.length)];
        this.employee.playAnimation(random);
    }
}


// ============================================
// 4. ã‚ªãƒ•ã‚£ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆçµ±åˆï¼‰
// ============================================
class OfficeManager {
    constructor(canvasId, employees) {
        this.canvas = document.getElementById(canvasId);
        this.ctx = this.canvas.getContext('2d');
        this.employees = employees;
        this.clock = new GameClock();
        this.layout = this.createOfficeLayout();

        // å„å¾“æ¥­å“¡ã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚’è¨­å®š
        this.employees.forEach(employee => {
            employee.schedule = new EmployeeSchedule(employee);
            employee.stateMachine = new EmployeeStateMachine(
                employee,
                employee.schedule,
                this.layout
            );
        });

        this.startAnimationLoop();
    }

    createOfficeLayout() {
        return {
            entrance: { x: 400, y: 580 },
            exit: { x: 400, y: 580 },
            breakRoom: { x: 350, y: 300 },
            desks: {
                development: [
                    { x: 100, y: 100 },
                    { x: 200, y: 100 },
                    { x: 300, y: 100 }
                ],
                sales: [
                    { x: 500, y: 100 },
                    { x: 600, y: 100 }
                ],
                planning: [
                    { x: 100, y: 400 },
                    { x: 200, y: 400 }
                ]
            },
            getDesk: function(department) {
                const deskList = this.desks[department];
                if (!deskList || deskList.length === 0) {
                    return { x: 400, y: 300 }; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä½ç½®
                }
                return deskList[Math.floor(Math.random() * deskList.length)];
            },
            getProjectArea: function(project) {
                return { x: 425, y: 300 }; // ä¼šè­°ã‚¨ãƒªã‚¢
            }
        };
    }

    startAnimationLoop() {
        let lastTime = performance.now();

        const animate = (currentTime) => {
            const deltaTime = currentTime - lastTime;
            lastTime = currentTime;

            // æ™‚è¨ˆã‚’é€²ã‚ã‚‹
            this.clock.update(deltaTime);

            // å…¨å¾“æ¥­å“¡ã‚’æ›´æ–°
            this.employees.forEach(employee => {
                employee.stateMachine.update(deltaTime, this.clock);
            });

            // æç”»
            this.render();

            requestAnimationFrame(animate);
        };

        requestAnimationFrame(animate);
    }

    render() {
        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªã‚¢
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

        // èƒŒæ™¯æç”»
        this.renderBackground();

        // æ™‚è¨ˆè¡¨ç¤º
        this.renderClock();

        // å¾“æ¥­å“¡æç”»
        this.employees.forEach(employee => {
            if (employee.visible) {
                employee.render(this.ctx);
            }
        });
    }

    renderClock() {
        this.ctx.font = 'bold 20px sans-serif';
        this.ctx.fillStyle = '#333';
        this.ctx.fillText(this.clock.getFormattedTime(), 20, 30);
    }

    renderBackground() {
        // ã‚ªãƒ•ã‚£ã‚¹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæç”»
        // ï¼ˆçœç•¥ - å‰å›ã®OfficeVisualizationã‚¯ãƒ©ã‚¹ã‚’å‚ç…§ï¼‰
    }
}
```

---

## 4. å®Ÿè£…è¨ˆç”»

### ãƒ•ã‚§ãƒ¼ã‚º1: åŸºç¤ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ2-3æ™‚é–“ï¼‰

1. **GameClock** - ã‚²ãƒ¼ãƒ å†…æ™‚é–“ç®¡ç†
2. **EmployeeSchedule** - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†
3. **EmployeeStateMachine** - åŸºæœ¬ã‚¹ãƒ†ãƒ¼ãƒˆå®Ÿè£…ï¼ˆ5çŠ¶æ…‹ï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º2: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ2-3æ™‚é–“ï¼‰

4. **EmployeeSprite** - çµµæ–‡å­—ãƒ™ãƒ¼ã‚¹ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
5. **MovementSystem** - ç§»å‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
6. **IdleAnimationManager** - ãƒ©ãƒ³ãƒ€ãƒ ãªã‚¢ã‚¤ãƒ‰ãƒ«å‹•ä½œ

### ãƒ•ã‚§ãƒ¼ã‚º3: çµ±åˆï¼ˆ1-2æ™‚é–“ï¼‰

7. **OfficeManager** - å…¨ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ
8. ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã¨ã®é€£æº
9. UIè¡¨ç¤ºï¼ˆæ™‚è¨ˆã€çŠ¶æ…‹è¡¨ç¤ºï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º4: æ‹¡å¼µï¼ˆ2-3æ™‚é–“ï¼‰

10. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæ¥­æ™‚ã®é›†åˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
11. ä¼šè­°ã‚¤ãƒ™ãƒ³ãƒˆ
12. æ–½è¨­åˆ©ç”¨ï¼ˆè‡ªè²©æ©Ÿã€ãƒˆã‚¤ãƒ¬ï¼‰
13. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

**ç·æ‰€è¦æ™‚é–“**: 7-11æ™‚é–“

---

## 5. æŠ€è¡“çš„ãªå®Ÿè£…ä¸Šã®æ³¨æ„ç‚¹

### 5.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### å•é¡Œ
30äººä»¥ä¸Šã®å¾“æ¥­å“¡ãŒãã‚Œãã‚Œç‹¬ç«‹ã—ã¦ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã¨é‡ã„ã€‚

#### è§£æ±ºç­–

```javascript
// æ™‚é–“åˆ†å‰²æ›´æ–°ï¼ˆTime-Slicingï¼‰
class OptimizedOfficeManager extends OfficeManager {
    constructor(canvasId, employees) {
        super(canvasId, employees);
        this.updateBatchSize = 5; // 1ãƒ•ãƒ¬ãƒ¼ãƒ ã§5äººã¾ã§æ›´æ–°
        this.currentBatchIndex = 0;
    }

    update(deltaTime) {
        // ãƒãƒƒãƒæ›´æ–°
        for (let i = 0; i < this.updateBatchSize; i++) {
            const index = (this.currentBatchIndex + i) % this.employees.length;
            this.employees[index].stateMachine.update(deltaTime, this.clock);
        }

        this.currentBatchIndex = (this.currentBatchIndex + this.updateBatchSize) % this.employees.length;
    }
}
```

### 5.2 ãƒ‘ã‚¹ãƒ•ã‚¡ã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

#### ã‚·ãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆæ¨å¥¨ï¼‰
ç›´ç·šç§»å‹• + éšœå®³ç‰©å›é¿

```javascript
class SimplePathfinder {
    findPath(start, end, obstacles) {
        // ç›´ç·šã§è¡Œã‘ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        if (!this.hasObstacle(start, end, obstacles)) {
            return [start, end];
        }

        // ç°¡æ˜“ã‚¦ã‚§ã‚¤ãƒã‚¤ãƒ³ãƒˆçµŒç”±
        const waypoint = this.findNearestWaypoint(start, end);
        return [start, waypoint, end];
    }
}
```

#### é«˜åº¦ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
A*ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å®Ÿè£…ï¼ˆ50äººä»¥ä¸Šã®å ´åˆã®ã¿ï¼‰

### 5.3 ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿

#### çµµæ–‡å­—ãƒ™ãƒ¼ã‚¹ï¼ˆæ¨å¥¨ï¼‰

```javascript
const EMPLOYEE_ANIMATIONS = {
    idle: {
        frames: ['ğŸ‘¨â€ğŸ’¼', 'ğŸ‘¨â€ğŸ’¼'], // åŒã˜çµµæ–‡å­—ï¼ˆå‘¼å¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯CSSï¼‰
        duration: 2000
    },
    walk: {
        frames: ['ğŸš¶', 'ğŸš¶â€â™‚ï¸'],
        duration: 300
    },
    typing: {
        frames: ['ğŸ‘¨â€ğŸ’»', 'ğŸ’»', 'ğŸ‘¨â€ğŸ’»', 'âŒ¨ï¸'],
        duration: 500
    },
    resting: {
        frames: ['ğŸ˜Œ', 'â˜•'],
        duration: 1000
    },
    stretch: {
        frames: ['ğŸ™†', 'ğŸ™†â€â™‚ï¸', 'ğŸ˜Š'],
        duration: 800
    }
};
```

#### ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚·ãƒ¼ãƒˆï¼ˆé«˜åº¦ï¼‰
16x16ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚«ã‚¤ãƒ­ã‚½ãƒ•ãƒˆå®Œå…¨å†ç¾ã®å ´åˆï¼‰

---

## 6. å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

### å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹

1. **Behavior Trees**
   - [Complete Implementation Tutorial 2025](https://generalistprogrammer.com/tutorials/game-ai-behavior-trees-complete-implementation-tutorial)
   - [Game Developer Article](https://www.gamedeveloper.com/programming/behavior-trees-for-ai-how-they-work)

2. **State Machines**
   - [State Machines for JavaScript Developers](https://blog.openreplay.com/state-machines-for-javascript-developers-how-to-use-them-in-your-apps/)
   - [XState Library](https://xstate.js.org/)

3. **Idle Animations**
   - [Programming Natural Idle Character Animations](https://dev.to/arkfuldodger/programming-natural-idle-character-animations-4l0g)

### ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹å®Ÿè£…ä¾‹

- **ç°¡æ˜“ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³**: [GitHub - javascript-state-machine](https://github.com/jakesgordon/javascript-state-machine)
- **è¡Œå‹•ãƒ„ãƒªãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: [GitHub - behavior3js](https://github.com/behavior3/behavior3js)

---

## 7. çµè«–

### å®Ÿè£…å¯èƒ½æ€§: âœ… **éå¸¸ã«é«˜ã„**

ã‚«ã‚¤ãƒ­ã‚½ãƒ•ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ—¥å¸¸ã‚µã‚¤ã‚¯ãƒ«ã¯ã€ä»¥ä¸‹ã®ç†ç”±ã§å®Ÿè£…å¯èƒ½ï¼š

1. **ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³**ã§ååˆ†å¯¾å¿œå¯èƒ½
2. **Canvas 2D**ã§ååˆ†ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
3. **çµµæ–‡å­—ãƒ™ãƒ¼ã‚¹**ãªã‚‰è¿½åŠ ã‚¢ã‚»ãƒƒãƒˆä¸è¦
4. **Vanilla JavaScript**ã®ã¿ã§å®Ÿè£…å¯èƒ½ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸è¦ï¼‰

### æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

**ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ–¹å¼**: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç† + ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³

```
[GameClock] â†’ [EmployeeSchedule] â†’ [EmployeeStateMachine] â†’ [Canvas Rendering]
```

### å®Ÿè£…å„ªå…ˆåº¦

1. **å¿…é ˆ**: å‡ºå‹¤ãƒ»é€€å‹¤ãƒ»ãƒ‡ã‚¹ã‚¯ä½œæ¥­
2. **æ¨å¥¨**: ä¼‘æ†©ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæ¥­
3. **ã‚ªãƒ—ã‚·ãƒ§ãƒ³**: ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¤ãƒ‰ãƒ«å‹•ä½œã€æ–½è¨­åˆ©ç”¨

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

è³‡æ ¼ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…å®Œäº†å¾Œã€ã“ã®ãƒªã‚µãƒ¼ãƒã‚’ã‚‚ã¨ã«ä»¥ä¸‹ã‚’å®Ÿè£…ï¼š

1. âœ… GameClockã®å®Ÿè£…ï¼ˆ1æ™‚é–“ï¼‰
2. âœ… EmployeeScheduleã®å®Ÿè£…ï¼ˆ1æ™‚é–“ï¼‰
3. âœ… EmployeeStateMachineã®å®Ÿè£…ï¼ˆ2æ™‚é–“ï¼‰
4. âœ… Canvasçµ±åˆã¨ãƒ†ã‚¹ãƒˆï¼ˆ2æ™‚é–“ï¼‰

**åˆè¨ˆäºˆæƒ³æ™‚é–“**: 6æ™‚é–“

---

**ãƒ¬ãƒãƒ¼ãƒˆä½œæˆè€…**: Claude (Multi-AI Orchestration)
**æ‰¿èª**: å®Ÿè£…å¯èƒ½ã¨åˆ¤å®š
