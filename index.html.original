<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„Éì„Ç∏„Éç„Çπ„Ç®„É≥„Éë„Ç§„Ç¢ - ÁµåÂñ∂„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- 30Ë≥áÊ†º„Ç∑„Çπ„ÉÜ„É† CSS -->
    <link rel="stylesheet" href="css/qualification-badges.css">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Sans', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        /* „Ç∞„É©„Çπ„É¢„Éº„Éï„Ç£„Ç∫„É†„Éò„ÉÉ„ÉÄ„Éº */
        .header {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%);
            backdrop-filter: blur(10px);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .company-name {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .date { font-size: 14px; opacity: 0.9; }

        /* Ë¶ñË¶öÁöÑ„Å™Áµ±Ë®à„Ç´„Éº„Éâ */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
        }

        .stat {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
            transition: transform 0.2s, background 0.2s;
        }

        .stat:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.3);
        }

        .stat-label {
            font-size: 12px;
            color: #ffffff;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 22px;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
        }

        /* „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 6px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            transition: width 0.5s ease;
        }

        /* „Éã„É•„Éº„Çπ„ÉÜ„Ç£„ÉÉ„Ç´„ÉºÊîπÂñÑ */
        .news-ticker {
            background: linear-gradient(90deg, #2c3e50, #34495e);
            color: #ffd700;
            padding: 10px;
            overflow: hidden;
            white-space: nowrap;
            font-size: 12px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .news-ticker span {
            display: inline-block;
            animation: scroll 25s linear infinite;
            padding-left: 100%;
        }

        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        /* „É©„É≥„Ç≠„É≥„Ç∞Ë°®Á§∫ - „Ç¢„Ç§„Ç≥„É≥ËøΩÂä† */
        .ranking-bar {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 12px;
            display: flex;
            justify-content: space-around;
            font-size: 10px;
            gap: 5px;
        }

        .rank-item {
            text-align: center;
            padding: 8px 6px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex: 1;
            transition: transform 0.2s;
        }

        .rank-item:hover {
            transform: translateY(-2px);
        }

        .rank-item.player {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(255, 215, 0, 0.3);
        }

        .rank-medal {
            font-size: 16px;
            display: block;
            margin-bottom: 2px;
        }

        /* „Çø„ÉñÊîπÂñÑ */
        .tabs {
            display: flex;
            padding: 15px 15px 0 15px;
            gap: 8px;
            overflow-x: auto;
            background: white;
            scrollbar-width: none;
            position: relative;
        }

        .tabs::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 30px;
            background: linear-gradient(to left, white, transparent);
            pointer-events: none;
        }

        .tabs::-webkit-scrollbar { display: none; }

        .tab {
            padding: 12px 16px;
            background: rgba(240, 240, 240, 0.8);
            backdrop-filter: blur(5px);
            border: none;
            border-radius: 12px 12px 0 0;
            font-weight: 600;
            font-size: 13px;
            color: #666;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .content {
            padding: 20px;
            min-height: 450px;
            background: white;
        }

        .panel { display: none; }
        .panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* „Éú„Çø„É≥ÊîπÂñÑ - Ë¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÂº∑Âåñ */
        .btn {
            width: 100%;
            padding: 16px;
            margin: 10px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.2);
            transition: left 0.3s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:disabled {
            background: linear-gradient(135deg, #b0b0b0, #888);
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.6;
        }

        .btn:disabled:active { transform: none; }

        .btn:active:not(:disabled) {
            transform: scale(0.97);
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.4);
        }

        .btn-primary,
        .btn-secondary {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            width: 100%;
            padding: 12px 16px;
            border-radius: 16px;
            border: none;
            font-weight: 600;
            letter-spacing: 0.3px;
            cursor: pointer;
            margin-top: 8px;
            transition: transform 0.2s, box-shadow 0.2s, filter 0.2s;
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before,
        .btn-secondary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.2);
            transition: left 0.3s;
        }

        .btn-primary:hover::before,
        .btn-secondary:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.3);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.2);
        }

        .btn-primary:hover,
        .btn-secondary:hover {
            transform: translateY(-1px);
            filter: brightness(1.02);
        }

        .btn-primary:focus,
        .btn-secondary:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.25);
        }

        .btn-primary:active {
            transform: scale(0.95);
        }

        .btn-secondary:active {
            transform: scale(0.95);
        }

        .btn-primary:disabled,
        .btn-secondary:disabled {
            cursor: not-allowed;
            opacity: 0.5;
            box-shadow: none;
            transform: none;
        }

        #restartButton {
            display: none;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        /* ÂæìÊ•≠Âì°„Ç´„Éº„Éâ - „Ç∞„É©„Çπ„É¢„Éº„Éï„Ç£„Ç∫„É† */
        .employee {
            background: rgba(248, 248, 248, 0.8);
            backdrop-filter: blur(10px);
            padding: 16px;
            margin: 12px 0;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .employee:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .employee:active {
            transform: translateX(2px) scale(0.98);
        }

        .employee-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .employee-name {
            font-weight: bold;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .personality {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 10px;
            border-radius: 14px;
            font-size: 11px;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }

        /* üÜï ÈÉ®ÁΩ≤„ÉªÂΩπËÅ∑„Éê„ÉÉ„Ç∏ */
        .department-badge, .position-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .department-badge {
            background: rgba(102, 126, 234, 0.15);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .position-badge {
            background: rgba(76, 175, 80, 0.15);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        /* üÜï ÈÉ®ÁΩ≤ÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ */
        .dept-options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .dept-option {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            width: 100%;
        }

        .dept-option:hover:not(:disabled) {
            background: rgba(102, 126, 234, 0.1);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .dept-option:active:not(:disabled) {
            transform: translateY(0);
        }

        /* üå≥ „Çπ„Ç≠„É´„ÉÑ„É™„ÉºUIÁî®„Çπ„Çø„Ç§„É´ */
        .skill-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .skill-tab {
            padding: 10px 16px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            backdrop-filter: blur(10px);
        }

        .skill-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .skill-tab.active {
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
        }

        .skill-panel {
            display: none;
        }

        .skill-panel.active {
            display: block;
        }

        .skill-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .skill-card {
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .skill-card.can-unlock {
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(102, 126, 234, 0.05);
        }

        .skill-card.can-unlock:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.8);
        }

        .skill-card.unlocked {
            border-color: rgba(76, 175, 80, 0.5);
            background: rgba(76, 175, 80, 0.05);
        }

        .skill-card.locked {
            cursor: not-allowed;
        }

        .dept-option.current {
            background: rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.5);
            cursor: not-allowed;
        }

        .dept-emoji {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .dept-name {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 4px;
            color: #333;
        }

        .dept-desc {
            font-size: 13px;
            color: #666;
        }

        .current-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 8px;
        }

        .employee-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
        }

        .department-badge, .position-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin: 4px 4px 0 0;
        }

        .department-badge {
            background: rgba(102, 126, 234, 0.15);
            color: #667eea;
        }

        .position-badge {
            background: rgba(76, 175, 80, 0.15);
            color: #4caf50;
        }

        /* „Çπ„Ç≠„É´„Éê„Éº */
        .abilities {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 12px 0;
        }

        .ability {
            font-size: 13px;
        }

        .ability-name {
            color: #666;
            font-size: 11px;
            margin-bottom: 4px;
            display: block;
        }

        .ability-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }

        .ability-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }

        .ability-value {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        /* „É¢„Éº„ÉÄ„É´ÊîπÂñÑ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.2s ease;
        }

        .modal-content {
            background: white;
            padding: 28px;
            border-radius: 20px;
            max-width: 360px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-close {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #e0e0e0, #f0f0f0);
            border: none;
            border-radius: 10px;
            font-weight: bold;
            margin-top: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-close:active {
            transform: scale(0.98);
            background: #d0d0d0;
        }

        .empty {
            text-align: center;
            color: #999;
            padding: 50px 20px;
            font-size: 14px;
        }

        /* Ë£ΩÂìÅ„Ç´„Éº„ÉâÊîπÂñÑ */
        .product {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 16px;
            margin: 12px 0;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(168, 237, 234, 0.4);
            transition: transform 0.2s;
        }

        .product:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(168, 237, 234, 0.5);
        }

        .product-quality {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(255,255,255,0.5);
            backdrop-filter: blur(5px);
            border-radius: 12px;
            margin-top: 8px;
            font-size: 13px;
        }

        /* ÊÉÖÂ†±„Éú„ÉÉ„ÇØ„Çπ - „Ç∞„É©„Çπ„É¢„Éº„Éï„Ç£„Ç∫„É† */
        .info-box {
            background: rgba(240, 240, 240, 0.6);
            backdrop-filter: blur(10px);
            padding: 16px;
            border-radius: 12px;
            margin: 12px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .info-box div {
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .competitor {
            background: linear-gradient(135deg, #fff3cd, #ffe8a1);
            padding: 12px;
            margin: 8px 0;
            border-radius: 10px;
            border-left: 4px solid #ff9800;
            box-shadow: 0 2px 6px rgba(255, 152, 0, 0.2);
            transition: transform 0.2s;
        }

        .competitor:hover {
            transform: translateX(4px);
        }

        /* „ÉÅ„É£„Éº„Éà„Ç≥„É≥„ÉÜ„Éä */
        .chart-container {
            margin: 20px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            position: relative;
            height: 250px;
        }

        .chart-container canvas {
            max-height: 200px !important;
        }

        .chart-title {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 12px;
        }

        /* „Ç¢„Ç§„Ç≥„É≥„Çπ„Çø„Ç§„É´ */
        .icon-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            color: white;
            font-size: 12px;
            margin-right: 6px;
        }

        /* Phase 2: ÁâπÊÄß„Éê„ÉÉ„Ç∏„Çπ„Çø„Ç§„É´ */
        .trait-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .trait-badge:hover {
            transform: translateY(-1px);
        }

        .trait-badge.positive {
            background: rgba(76, 175, 80, 0.15);
            color: #4caf50;
        }

        .trait-badge.negative {
            background: rgba(244, 67, 54, 0.15);
            color: #f44336;
        }

        .trait-badge.hidden {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            padding: 6px 12px;
            font-size: 12px;
            color: #333;
        }

        .compatibility-box {
            margin-bottom: 16px;
            padding: 12px;
            background: rgba(240, 240, 240, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .compatibility-score {
            font-weight: bold;
            font-size: 16px;
        }

        .compatibility-score.good {
            color: #4caf50;
        }

        .compatibility-score.average {
            color: #ff9800;
        }

        .compatibility-score.poor {
            color: #f44336;
        }

        /* „Ç™„Éï„Ç£„ÇπÊàêÈï∑„Ç∑„Çπ„ÉÜ„É†„ÅÆCSS */
        .office-display {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }

        .office-icon {
            font-size: 80px;
            margin: 16px 0;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .office-name {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
            margin: 12px 0 8px 0;
        }

        .office-description {
            font-size: 13px;
            color: #666;
            margin-bottom: 16px;
        }

        .office-progress {
            background: #e0e0e0;
            border-radius: 12px;
            height: 12px;
            overflow: hidden;
            margin: 16px 0;
            position: relative;
        }

        .office-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }

        .office-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .office-stat {
            background: rgba(102, 126, 234, 0.1);
            padding: 10px;
            border-radius: 10px;
            font-size: 13px;
        }

        .office-stat strong {
            color: #667eea;
            font-size: 16px;
            display: block;
            margin-top: 4px;
        }

        .office-level-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        /* ÂæìÊ•≠Âì°Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´Â∞ÇÁî®„Çπ„Çø„Ç§„É´ */
        .employee-detail-modal .modal-content {
            max-width: 420px;
        }

        .radar-chart-container {
            margin: 20px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            position: relative;
            height: 320px;
        }

        .radar-chart-container canvas {
            max-height: 280px !important;
        }

        .growth-timeline {
            margin: 20px 0;
            padding: 16px;
            background: rgba(240, 240, 240, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .timeline-title {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .timeline-item {
            position: relative;
            padding-left: 28px;
            padding-bottom: 16px;
            margin-bottom: 12px;
            border-left: 2px solid #e0e0e0;
        }

        .timeline-item:last-child {
            border-left-color: transparent;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 2px;
            width: 10px;
            height: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }

        .timeline-turn {
            font-size: 11px;
            color: #999;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .timeline-event {
            font-size: 13px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .timeline-description {
            font-size: 12px;
            color: #666;
            line-height: 1.5;
        }

        .employee-detail-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(102, 126, 234, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
        }

        .employee-detail-icon {
            font-size: 48px;
        }

        .employee-detail-info {
            flex: 1;
        }

        .employee-detail-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 6px;
        }

        .employee-detail-meta {
            font-size: 13px;
            color: #666;
        }

        /* üÜï Êé°Áî®UI - Ë§áÊï∞ÂÄôË£ú„Ç´„Éº„Éâ„Çπ„Çø„Ç§„É´ */
        .candidates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        @media (max-width: 768px) {
            .candidates-grid {
                grid-template-columns: 1fr;
            }
        }

        .candidate-card-hiring {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 16px;
            padding: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .candidate-card-hiring::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .candidate-card-hiring:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(102, 126, 234, 0.25);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .candidate-card-hiring:hover::before {
            opacity: 1;
        }

        .candidate-header {
            text-align: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .candidate-name {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin-bottom: 4px;
        }

        .candidate-personality {
            font-size: 12px;
            color: #667eea;
            font-weight: 600;
            background: rgba(102, 126, 234, 0.1);
            padding: 4px 12px;
            border-radius: 12px;
            display: inline-block;
            margin-top: 4px;
        }

        .candidate-abilities,
        .candidate-traits {
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(240, 240, 240, 0.5);
            border-radius: 8px;
        }

        .candidate-salary {
            text-align: center;
            font-size: 16px;
            font-weight: 700;
            color: #2ecc71;
            background: rgba(46, 204, 113, 0.1);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .candidate-hire-btn {
            transition: all 0.2s ease;
            font-weight: 600;
            font-size: 14px;
        }

        .candidate-hire-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .candidate-hire-btn:active {
            transform: scale(0.98);
        }

        .trait-badge-small {
            display: inline-block;
            font-size: 18px;
            padding: 6px 10px;
            background: rgba(76, 175, 80, 0.15);
            border-radius: 8px;
            transition: transform 0.2s ease;
        }

        .trait-badge-small:hover {
            transform: scale(1.15);
        }

        .trait-badge-small.negative {
            background: rgba(244, 67, 54, 0.15);
        }

        /* üÜï ÈÉ®ÁΩ≤ÁÆ°ÁêÜ„Ç´„Éº„Éâ„Çπ„Çø„Ç§„É´ */
        .department-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .department-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .department-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.4);
        }

        .department-card:hover::before {
            opacity: 1;
        }

        .department-card-header {
            text-align: center;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 16px;
        }

        .department-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-item {
            background: rgba(240, 240, 240, 0.6);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }

        .department-stat-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .department-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: #333;
        }

        .department-manager {
            background: rgba(102, 126, 234, 0.05);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 16px;
        }

        .department-efficiency {
            background: rgba(240, 240, 240, 0.6);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 16px;
        }

        .department-employees {
            background: rgba(240, 240, 240, 0.4);
            padding: 10px;
            border-radius: 10px;
        }

        .detail-section {
            background: rgba(255, 255, 255, 0.75);
            border-radius: 14px;
            padding: 14px;
            margin-bottom: 18px;
            box-shadow: inset 0 1px 3px rgba(255,255,255,0.4), 0 6px 18px rgba(102, 126, 234, 0.15);
        }

        .detail-section h4 {
            font-size: 13px;
            color: #667eea;
            margin-bottom: 10px;
        }

        .detail-section div {
            font-size: 13px;
            color: #444;
            margin-bottom: 6px;
        }

        .detail-section .btn-primary,
        .detail-section .btn-secondary {
            margin-top: 6px;
        }

        .department-options {
            display: grid;
            gap: 8px;
            margin: 12px 0 4px;
        }

        .action-toast {
            padding: 18px;
            background: rgba(255, 255, 255, 0.92);
            border-radius: 18px;
            text-align: center;
            box-shadow: 0 18px 40px rgba(102, 126, 234, 0.25);
            animation: toastPop 0.5s ease-out;
        }

        .action-toast .action-icon {
            font-size: 32px;
            margin-bottom: 8px;
            animation: bounce 1.6s infinite ease-in-out;
        }

        .promotion-toast .confetti {
            font-size: 22px;
            margin-bottom: 4px;
            animation: confettiRain 1.6s ease forwards;
        }

        .promotion-toast .action-icon {
            animation: celebrationBounce 1.2s infinite ease-in-out;
        }

        @keyframes toastPop {
            0% { transform: scale(0.8); opacity: 0; }
            60% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes celebrationBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        @keyframes confettiRain {
            0% { opacity: 0; transform: translateY(-12px) scale(0.9); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* ========================================
           Ë≥áÊ†ºÂèñÂæó„Ç∑„Çπ„ÉÜ„É†Â∞ÇÁî®„Çπ„Çø„Ç§„É´
           Certification System Styles
           ======================================== */

        .certification-container {
            max-width: 100%;
        }

        .certification-main {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .certification-main {
                grid-template-columns: 1fr;
            }
        }

        .employee-selector {
            background: rgba(240, 240, 240, 0.5);
            padding: 16px;
            border-radius: 12px;
        }

        .employee-selector h4 {
            margin: 0 0 12px 0;
            font-size: 14px;
            color: #666;
        }

        .employee-cards-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .employee-card {
            background: white;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .employee-card:hover {
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        }

        .employee-card.active {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }

        .certification-detail {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .active-cert-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-bar-large {
            height: 24px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill-large {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .cert-available-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .cert-available-card {
            background: white;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.2s;
        }

        .cert-available-card:hover {
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .cert-difficulty {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .cert-difficulty.low {
            background: rgba(76, 175, 80, 0.15);
            color: #4caf50;
        }

        .cert-difficulty.medium {
            background: rgba(255, 152, 0, 0.15);
            color: #ff9800;
        }

        .cert-difficulty.high {
            background: rgba(244, 67, 54, 0.15);
            color: #f44336;
        }

        .certification-notification {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            background: white;
            padding: 12px 16px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideInRight 0.3s ease;
            min-width: 280px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .certification-notification.success {
            border-left: 4px solid #4caf50;
        }

        .certification-notification.error {
            border-left: 4px solid #f44336;
        }

        .certification-empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="company-name">üè¢ Ê†™Âºè‰ºöÁ§æ„Çπ„Çø„Éº„Éà„Ç¢„ÉÉ„Éó</div>
            <div class="date" id="gameDate">2025Âπ¥1Êúà Á¨¨1ÈÄ±</div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">üí∞ Ë≥áÈáë</div>
                    <div class="stat-value" id="money">1000‰∏á</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="moneyProgress" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">üë• ÂæìÊ•≠Âì°</div>
                    <div class="stat-value" id="employeeCount">1</div>
                </div>
                <div class="stat">
                    <div class="stat-label">üìä Â£≤‰∏ä</div>
                    <div class="stat-value" id="revenue">0‰∏á</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="revenueProgress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- „Éã„É•„Éº„Çπ„ÉÜ„Ç£„ÉÉ„Ç´„Éº -->
        <div class="news-ticker">
            <span id="newsText">üì∞ „Ç≤„Éº„É†ÈñãÂßãÔºÅITÊ•≠Áïå„ÅßÊàêÂäü„ÇíÁõÆÊåá„Åù„ÅÜÔºÅ</span>
        </div>

        <!-- „É©„É≥„Ç≠„É≥„Ç∞Ë°®Á§∫ -->
        <div class="ranking-bar" id="rankingBar">
            <div class="rank-item">
                <span class="rank-medal">ü•á</span>
                „ÉÜ„ÉÉ„ÇØ„Ç≥„Éº„Éó<br>(35%)
            </div>
            <div class="rank-item">
                <span class="rank-medal">ü•à</span>
                „Éá„Ç∏„Çø„É´„ÉØ„Éº„ÇØ„Çπ<br>(29%)
            </div>
            <div class="rank-item">
                <span class="rank-medal">ü•â</span>
                „Çµ„Ç§„Éê„Éº„ÇΩ„Éï„Éà<br>(22%)
            </div>
            <div class="rank-item player">
                <span class="rank-medal">4</span>
                „ÅÇ„Å™„Åü<br>(0.1%)
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" data-panel="overview" onclick="showPanel(this, 'overview')">üìä Ê¶ÇË¶Å</button>
            <button class="tab" data-panel="employees" onclick="showPanel(this, 'employees')">üë• ‰∫∫‰∫ã</button>
            <button class="tab" data-panel="departments" onclick="showPanel(this, 'departments')">üè¢ ÈÉ®ÁΩ≤</button>
            <button class="tab" data-panel="products" onclick="showPanel(this, 'products')">üì¶ Ë£ΩÂìÅ</button>
            <button class="tab" data-panel="market" onclick="showPanel(this, 'market')">üìà Â∏ÇÂ†¥</button>
            <button class="tab" data-panel="finance" onclick="showPanel(this, 'finance')">üí∞ Ë≤°Âãô</button>
            <button class="tab" data-panel="certifications" onclick="showPanel(this, 'certifications')">üéì Ë≥áÊ†º</button>
        </div>

        <div class="content">
            <div id="overview" class="panel active">
                <h3>üè¢ ‰ºöÁ§æÊ¶ÇË¶Å</h3>
                <div class="info-box">
                    <div>
                        <span>Ê•≠Áïå</span>
                        <span>IT„Éª„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢</span>
                    </div>
                    <div>
                        <span>Â∏ÇÂ†¥„Ç∑„Çß„Ç¢</span>
                        <span id="marketShare">0.1%</span>
                    </div>
                    <div>
                        <span>„Éñ„É©„É≥„ÉâÂäõ</span>
                        <span id="brand">‚≠ê</span>
                    </div>
                </div>

                <!-- „Ç™„Éï„Ç£„ÇπÊàêÈï∑Ë°®Á§∫ -->
                <div id="officeDisplay"></div>

                <div class="chart-container">
                    <div class="chart-title">üìà Â£≤‰∏äÊé®Áßª</div>
                    <canvas id="revenueChart" height="180"></canvas>
                </div>

                <button class="btn" data-requires-active="true" onclick="nextTurn()">‚è≠Ô∏è Ê¨°„ÅÆ„Çø„Éº„É≥„Å∏</button>
                <button class="btn" data-requires-active="true" onclick="saveGame()">üíæ „Ç≤„Éº„É†‰øùÂ≠ò</button>
                <button class="btn" id="restartButton" onclick="restartGame()">üîÑ „Ç≤„Éº„É†ÂÜç„Çπ„Çø„Éº„Éà</button>
            </div>

            <div id="employees" class="panel">
                <h3>üë• ÂæìÊ•≠Âì°ÁÆ°ÁêÜ</h3>
                <div id="employeeList"></div>
                <button class="btn" data-requires-active="true" onclick="showHiring()">‚ûï Êé°Áî®Ê¥ªÂãï</button>
                <button class="btn" data-requires-active="true" onclick="trainEmployees()">üìö Á†î‰øÆÂÆüÊñΩ</button>
            </div>

            <div id="products" class="panel">
                <h3>üì¶ Ë£ΩÂìÅÈñãÁô∫</h3>
                <div id="productList"></div>
                <button class="btn" data-requires-active="true" onclick="developProduct()">üîß Êñ∞Ë£ΩÂìÅÈñãÁô∫</button>
            </div>

            <div id="market" class="panel">
                <h3>üè¢ Â∏ÇÂ†¥Áä∂Ê≥Å</h3>
                <div class="chart-container">
                    <div class="chart-title">üìä Â∏ÇÂ†¥„Ç∑„Çß„Ç¢ÂàÜÂ∏É</div>
                    <canvas id="marketChart" height="200"></canvas>
                </div>
                <div id="marketInfo"></div>
                <button class="btn" data-requires-active="true" onclick="doMarketing()">üì¢ „Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞</button>
            </div>

            <div id="finance" class="panel">
                <h3>üí∞ Ë≤°ÂãôÁä∂Ê≥Å</h3>
                <div id="financeInfo"></div>
                <button class="btn" data-requires-active="true" onclick="getLoan()">üè¶ ÈäÄË°åËûçË≥á</button>
                <button class="btn" data-requires-active="true" onclick="repayLoan()">üí∏ ËûçË≥áËøîÊ∏à</button>
            </div>

            <!-- üÜï ÈÉ®ÁΩ≤„Éë„Éç„É´ -->
            <div id="departments" class="panel">
                <h3>üè¢ ÈÉ®ÁΩ≤ÁÆ°ÁêÜ</h3>
                <div style="margin-bottom: 20px; padding: 14px; background: rgba(102, 126, 234, 0.1); border-radius: 12px;">
                    <div style="font-size: 13px; color: #666;">
                        üìä ÂêÑÈÉ®ÁΩ≤„ÅÆÁä∂Ê≥Å„ÇíÁ¢∫Ë™ç„Åó„ÄÅÂäπÁéáÁöÑ„Å™‰∫∫Âì°ÈÖçÁΩÆ„ÇíË°å„ÅÑ„Åæ„Åó„Çá„ÅÜ
                    </div>
                </div>
                <div id="departmentsGrid"></div>
            </div>

            <!-- üéì Ë≥áÊ†º„Éë„Éç„É´ -->
            <div id="certifications" class="panel">
                <div id="certificationPanel">
                    <div class="certification-empty-state">
                        <div class="empty-icon">üéì</div>
                        <h3>Ë≥áÊ†ºÂèñÂæó„Ç∑„Çπ„ÉÜ„É†</h3>
                        <p>ÂæìÊ•≠Âì°„ÅÆ„Çπ„Ç≠„É´„Ç¢„ÉÉ„Éó„ÅÆ„Åü„ÇÅ„Å´Ë≥áÊ†ºÂèñÂæó„ÇíÊîØÊè¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle"></div>
            <div id="modalBody"></div>
            <button class="modal-close" onclick="closeModal()">Èñâ„Åò„Çã</button>
        </div>
    </div>

    <script>
        // Phase 1: 15Á®ÆÈ°û„ÅÆÂü∫Êú¨ÊÄßÊ†ºÂÆöÁæ©
        const PERSONALITIES = {
            passionate: {
                name: 'ÊÉÖÁÜ±ÂÆ∂',
                emoji: 'üî•',
                effects: { developmentSpeed: 1.2 },
                compatible: ['optimist', 'charismatic'],
                incompatible: ['cautious']
            },
            logical: {
                name: 'Ë´ñÁêÜÊÄùËÄÉÂûã',
                emoji: 'üß†',
                effects: { bugRate: 0.7 },
                compatible: ['perfectionist', 'researcher'],
                incompatible: ['intuitive']
            },
            cooperative: {
                name: 'ÂçîË™øÊÄßÈáçË¶ñ',
                emoji: 'ü§ù',
                effects: { teamEfficiency: 1.15 },
                compatible: ['passionate', 'optimist'],
                incompatible: ['lone_genius']
            },
            ambitious: {
                name: 'ÈáéÂøÉÂÆ∂',
                emoji: 'üíº',
                effects: { promotionDesire: 1.3 },
                compatible: ['strategist'],
                incompatible: ['cooperative']
            },
            charismatic: {
                name: '„Ç´„É™„Çπ„Éû',
                emoji: 'üåü',
                effects: { salesPower: 1.25 },
                compatible: ['passionate', 'optimist'],
                incompatible: ['introverted']
            },
            perfectionist: {
                name: 'ÂÆåÁíß‰∏ªÁæ©ËÄÖ',
                emoji: 'üéØ',
                effects: { quality: 1.2, speed: 0.9 },
                compatible: ['logical', 'researcher'],
                incompatible: ['optimist']
            },
            action_oriented: {
                name: 'Ë°åÂãïÊ¥æ',
                emoji: 'üöÄ',
                effects: { decisionSpeed: 1.2 },
                compatible: ['intuitive'],
                incompatible: ['cautious']
            },
            researcher: {
                name: 'Á†îÁ©∂ËÄÖÊ∞óË≥™',
                emoji: 'üìö',
                effects: { learningSpeed: 1.3 },
                compatible: ['logical', 'introverted'],
                incompatible: ['action_oriented']
            },
            optimist: {
                name: 'Ê•ΩË¶≥‰∏ªÁæ©ËÄÖ',
                emoji: 'üòä',
                effects: { stressResistance: 1.2 },
                compatible: ['passionate', 'charismatic'],
                incompatible: ['perfectionist']
            },
            cautious: {
                name: 'ÊÖéÈáçÊ¥æ',
                emoji: 'üîí',
                effects: { riskManagement: 1.25 },
                compatible: ['strategist', 'perfectionist'],
                incompatible: ['action_oriented', 'passionate']
            },
            creative: {
                name: '„ÇØ„É™„Ç®„Ç§„Çø„Éº',
                emoji: 'üé®',
                effects: { creativity: 1.3 },
                compatible: ['intuitive'],
                incompatible: ['logical']
            },
            intuitive: {
                name: 'Áõ¥ÊÑüÂûã',
                emoji: '‚ö°',
                effects: { inspirationRate: 1.2 },
                compatible: ['creative', 'action_oriented'],
                incompatible: ['logical', 'cautious']
            },
            introverted: {
                name: 'ÂÜÖÂêëÁöÑ',
                emoji: 'üßò',
                effects: { soloWork: 1.25 },
                compatible: ['researcher'],
                incompatible: ['charismatic', 'cooperative']
            },
            lone_genius: {
                name: 'Â≠§È´ò„ÅÆÂ§©Êâç',
                emoji: 'üèîÔ∏è',
                effects: { ability: 1.4, cooperation: 0.5 },
                compatible: [],
                incompatible: ['cooperative', 'charismatic']
            },
            strategist: {
                name: 'Êà¶Áï•ÂÆ∂',
                emoji: 'üó∫Ô∏è',
                effects: { projectSuccess: 1.15 },
                compatible: ['cautious', 'ambitious'],
                incompatible: ['intuitive']
            }
        };

        // Phase 2: „Çµ„ÉñÁâπÊÄß20Á®ÆÈ°ûÂÆöÁæ©
        const SUB_TRAITS = {
            // ÈñãÁô∫Á≥ª
            code_reviewer: { name: '„Ç≥„Éº„Éâ„É¨„Éì„É•„Ç¢„Éº', emoji: 'üîç', effect: '„Éê„Ç∞Áô∫Ë¶ãÁéá+40%' },
            debugger: { name: '„Éá„Éê„ÉÉ„Ç¨„Éº', emoji: 'üêõ', effect: '„Éê„Ç∞‰øÆÊ≠£ÈÄüÂ∫¶+50%' },
            architect: { name: '„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„Éà', emoji: 'üèóÔ∏è', effect: 'Â§ßË¶èÊ®°ÈñãÁô∫„ÅßËÉΩÂäõ1.5ÂÄç' },
            rapid_dev: { name: 'ÈÄüÊîªÈñãÁô∫', emoji: '‚ö°', effect: 'Â∞èË¶èÊ®°ÈñãÁô∫„Çí1„Çø„Éº„É≥„ÅßÂÆå‰∫Ü' },

            // „Ç¢„Ç§„Éá„Ç¢Á≥ª
            inspiration: { name: '„Å≤„Çâ„ÇÅ„Åç', emoji: 'üí°', effect: 'Êúà1Âõû„ÄÅÁîªÊúüÁöÑÊ©üËÉΩ„ÇíÊÄù„ÅÑ„Å§„Åè' },
            trend_catcher: { name: '„Éà„É¨„É≥„Éâ„Ç≠„É£„ÉÉ„ÉÅ„É£„Éº', emoji: 'üì°', effect: 'Â∏ÇÂ†¥„Éã„Éº„Ç∫‰∫àÊ∏¨+30%' },
            tech_foresight: { name: 'ÊäÄË°ìÂÖàË™≠„Åø', emoji: 'üîÆ', effect: 'Êñ∞ÊäÄË°ìÁôªÂ†¥„Çí2„Çø„Éº„É≥Ââç„Å´ÂØüÁü•' },

            // ÂØæ‰∫∫Á≥ª
            mentor: { name: '„É°„É≥„Çø„Éº', emoji: 'üë®‚Äçüè´', effect: 'Êñ∞‰∫∫ËÇ≤ÊàêÈÄüÂ∫¶+50%' },
            mediator: { name: 'Ë™øÂÅúËÄÖ', emoji: '‚öñÔ∏è', effect: '„ÉÅ„Éº„É†ÂØæÁ´ã„ÇíËß£Ê∂à' },
            networker: { name: '„Éç„ÉÉ„Éà„ÉØ„Éº„Ç´„Éº', emoji: 'üåê', effect: 'Â§ñÈÉ®‰∫∫ËÑà„ÅßÊÉÖÂ†±ÂÖ•Êâã' },

            // Á≤æÁ•ûÁ≥ª
            steel_mind: { name: 'Èãº„ÅÆ„É°„É≥„Çø„É´', emoji: 'üõ°Ô∏è', effect: '„Éá„Çπ„Éû„Éº„ÉÅ„Åß„ÇÇËÉΩÂäõ‰Ωé‰∏ã„Å™„Åó' },
            crunch_resistant: { name: '„ÇØ„É©„É≥„ÉÅËÄêÊÄß', emoji: 'üí™', effect: 'ÊÆãÊ•≠Á∂ö„Åç„Åß„ÇÇÂÅ•Â∫∑Á∂≠ÊåÅ' },
            pressure_converter: { name: '„Éó„É¨„ÉÉ„Ç∑„É£„ÉºÂ§âÊèõ', emoji: '‚ö°', effect: 'Á∑†ÂàáÁõ¥Ââç„Å´ËÉΩÂäõ+30%' },

            // „Éç„Ç¨„ÉÜ„Ç£„ÉñÁâπÊÄß
            easily_bored: { name: 'È£Ω„ÅçÊÄß', emoji: 'üòë', effect: '3„É∂Êúà„ÅßËÉΩÂäõ-20%', negative: true },
            morning_weak: { name: 'Êúù„ÅåËã¶Êâã', emoji: 'üò¥', effect: 'ÂçàÂâç‰∏≠„ÅÆ‰ΩúÊ•≠ÂäπÁéá-30%', negative: true },
            over_perfectionist: { name: 'ÂÆåÁíß‰∏ªÁæ©„Åô„Åé„Çã', emoji: '‚è∞', effect: 'Á¥çÊúüÈÅÖÂª∂„É™„Çπ„ÇØ+20%', negative: true },

            // „Åù„ÅÆ‰ªñ
            fast_learner: { name: 'Êó©ÁøíÂæó', emoji: 'üìñ', effect: 'Á†î‰øÆÂäπÊûú+50%' },
            cost_conscious: { name: '„Ç≥„Çπ„ÉàÊÑèË≠ò', emoji: 'üí∞', effect: 'ÁÑ°ÈßÑ„Å™ÊîØÂá∫„Çí15%ÂâäÊ∏õ' },
            health_conscious: { name: 'ÂÅ•Â∫∑ÂøóÂêë', emoji: 'ü•ó', effect: 'ÁóÖÊ¨†„É™„Çπ„ÇØ-50%' },
            night_owl: { name: 'Â§úÂûã‰∫∫Èñì', emoji: 'ü¶â', effect: 'Ê∑±Â§ú‰ΩúÊ•≠„ÅßËÉΩÂäõ+20%' }
        };

        // Phase 2: Èö†„ÇåÁâπÊÄß5Á®ÆÈ°ûÂÆöÁæ©
        const HIDDEN_TRAITS = {
            latent_leader: {
                name: 'ÊΩúÂú®„É™„Éº„ÉÄ„Éº',
                emoji: 'üî•',
                effect: '6„É∂ÊúàÂæå„ÄÅÁ™ÅÁÑ∂„Éû„Éç„Ç∏„É°„É≥„ÉàËÉΩÂäõÈñãËä±',
                revealTurn: 24  // 6„É∂Êúà = 24ÈÄ±
            },
            late_bloomer: {
                name: 'Â§ßÂô®Êô©Êàê',
                emoji: 'üíé',
                effect: '1Âπ¥Âæå„Å´ËÉΩÂäõ+50%',
                revealTurn: 48
            },
            burnout_prone: {
                name: 'ÁáÉ„ÅàÂ∞Ω„ÅçÁóáÂÄôÁæ§',
                emoji: 'üî•‚û°Ô∏èüí®',
                effect: 'ÊàêÂäüÂæå„Å´Á™ÅÁÑ∂ÈÄÄËÅ∑„É™„Çπ„ÇØ',
                revealTurn: 36,
                negative: true
            },
            self_taught: {
                name: 'Áã¨Â≠¶„ÅÆÂ§©Êâç',
                emoji: 'üéì',
                effect: 'Á†î‰øÆ„Å™„Åó„ÅßÂãùÊâã„Å´„Çπ„Ç≠„É´„Ç¢„ÉÉ„Éó',
                revealTurn: 12
            },
            inconsistent: {
                name: '„É†„É©„Åå„ÅÇ„Çã',
                emoji: 'üåä',
                effect: 'Êúà„Åî„Å®„Å´ËÉΩÂäõ„Åå20-120%„ÅßÂ§âÂãï',
                revealTurn: 8,
                negative: true
            }
        };

        // üè¢ ÈÉ®ÁΩ≤„Ç∑„Çπ„ÉÜ„É†ÂÆöÁæ©
        const DEPARTMENTS = {
            development: {
                name: 'ÈñãÁô∫ÈÉ®',
                emoji: 'üíª',
                primaryAbility: 'technical',
                salaryMultiplier: 1.0,
                description: 'Ë£ΩÂìÅ„ÅÆÈñãÁô∫„ÇíÊãÖÂΩì'
            },
            sales: {
                name: 'Âñ∂Ê•≠ÈÉ®',
                emoji: 'üìà',
                primaryAbility: 'sales',
                salaryMultiplier: 1.1,
                description: 'Ë£ΩÂìÅ„ÅÆË≤©Â£≤„ÇíÊãÖÂΩì'
            },
            planning: {
                name: '‰ºÅÁîªÈÉ®',
                emoji: 'üí°',
                primaryAbility: 'planning',
                salaryMultiplier: 0.95,
                description: 'Êñ∞Ë£ΩÂìÅ„ÅÆ‰ºÅÁîª„ÇíÊãÖÂΩì'
            },
            management: {
                name: 'ÁÆ°ÁêÜÈÉ®',
                emoji: 'üìä',
                primaryAbility: 'management',
                salaryMultiplier: 1.05,
                description: '‰ºöÁ§æÂÖ®‰Ωì„ÅÆÁÆ°ÁêÜ„ÇíÊãÖÂΩì'
            }
        };

        // üëî ÂΩπËÅ∑„Ç∑„Çπ„ÉÜ„É†ÂÆöÁæ© (ÊòáÈÄ≤„Ç∑„Çπ„ÉÜ„É†)
        const POSITIONS = {
            staff: {
                name: '„Çπ„Çø„ÉÉ„Éï',
                emoji: 'üë§',
                salaryMultiplier: 1.0,
                requiredAbility: 0,
                managementBonus: 0,
                description: '‰∏ÄËà¨Á§æÂì°'
            },
            senior: {
                name: '„Ç∑„Éã„Ç¢',
                emoji: '‚≠ê',
                salaryMultiplier: 1.3,
                requiredAbility: 70,
                managementBonus: 0.1,
                description: '‰∏äÁ¥öÁ§æÂì°'
            },
            manager: {
                name: 'Ë™≤Èï∑',
                emoji: 'üëî',
                salaryMultiplier: 1.6,
                requiredAbility: 80,
                managementBonus: 0.2,
                canManage: 5,
                description: 'Ë™≤Èï∑ËÅ∑ (5Âêç„Åæ„ÅßÁÆ°ÁêÜÂèØËÉΩ)'
            },
            director: {
                name: 'ÈÉ®Èï∑',
                emoji: 'üíº',
                salaryMultiplier: 2.0,
                requiredAbility: 90,
                managementBonus: 0.3,
                canManage: 15,
                description: 'ÈÉ®Èï∑ËÅ∑ (15Âêç„Åæ„ÅßÁÆ°ÁêÜÂèØËÉΩ)'
            }
        };

        // üå≥ „Çπ„Ç≠„É´„ÉÑ„É™„Éº„Ç∑„Çπ„ÉÜ„É†ÂÆöÁæ©
        const SKILL_TREE = {
            technical: {
                name: 'ÊäÄË°ì„Çπ„Ç≠„É´',
                emoji: 'üíª',
                color: '#667eea',
                skills: {
                    tech_basic: {
                        name: '„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞Âü∫Á§é',
                        description: 'Âü∫Êú¨ÁöÑ„Å™„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„Çπ„Ç≠„É´„ÇíÁøíÂæó',
                        cost: 1,
                        effect: { technical: 5 },
                        prerequisites: [],
                        tier: 1,
                        icon: 'üìù'
                    },
                    tech_advanced: {
                        name: '„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£Ë®≠Ë®à',
                        description: '„Ç∑„Çπ„ÉÜ„É†ÂÖ®‰Ωì„ÅÆË®≠Ë®àËÉΩÂäõ„ÇíÁç≤Âæó',
                        cost: 2,
                        effect: { technical: 10, planning: 3 },
                        prerequisites: ['tech_basic'],
                        tier: 2,
                        icon: 'üèóÔ∏è'
                    },
                    tech_optimization: {
                        name: '„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©Âåñ',
                        description: '„Ç≥„Éº„Éâ„ÇíÈ´òÈÄüÂåñ„ÅóÂìÅË≥™„ÇíÂêë‰∏ä',
                        cost: 2,
                        effect: { technical: 8 },
                        prerequisites: ['tech_advanced'],
                        tier: 3,
                        icon: '‚ö°',
                        special: 'product_quality_bonus'
                    },
                    tech_ai: {
                        name: 'AI„ÉªÊ©üÊ¢∞Â≠¶Áøí',
                        description: 'ÊúÄÊñ∞„ÅÆAIÊäÄË°ì„ÇíÊ¥ªÁî®„Åß„Åç„Çã',
                        cost: 3,
                        effect: { technical: 15, planning: 5 },
                        prerequisites: ['tech_advanced'],
                        tier: 3,
                        icon: 'ü§ñ'
                    },
                    tech_security: {
                        name: '„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç®„Ç≠„Çπ„Éë„Éº„Éà',
                        description: '„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÅÆÂ∞ÇÈñÄÁü•Ë≠ò„ÇíÁç≤Âæó',
                        cost: 2,
                        effect: { technical: 10, management: 3 },
                        prerequisites: ['tech_basic'],
                        tier: 2,
                        icon: 'üîí'
                    }
                }
            },
            sales: {
                name: 'Âñ∂Ê•≠„Çπ„Ç≠„É´',
                emoji: 'üìà',
                color: '#f093fb',
                skills: {
                    sales_basic: {
                        name: 'È°ßÂÆ¢ÂØæÂøúÂü∫Á§é',
                        description: 'Âü∫Êú¨ÁöÑ„Å™Âñ∂Ê•≠„Çπ„Ç≠„É´„ÇíÁøíÂæó',
                        cost: 1,
                        effect: { sales: 5 },
                        prerequisites: [],
                        tier: 1,
                        icon: 'ü§ù'
                    },
                    sales_negotiation: {
                        name: '‰∫§Ê∏âË°ì',
                        description: 'È´òÂ∫¶„Å™‰∫§Ê∏â„ÉÜ„ÇØ„Éã„ÉÉ„ÇØ„ÇíÁç≤Âæó',
                        cost: 2,
                        effect: { sales: 10, management: 3 },
                        prerequisites: ['sales_basic'],
                        tier: 2,
                        icon: 'üíº'
                    },
                    sales_presentation: {
                        name: '„Éó„É¨„Çº„É≥„ÉÜ„Éº„Ç∑„Éß„É≥',
                        description: 'Ë™¨ÂæóÂäõ„ÅÆ„ÅÇ„ÇãÊèêÊ°à„Åå„Åß„Åç„Çã',
                        cost: 2,
                        effect: { sales: 8, planning: 4 },
                        prerequisites: ['sales_basic'],
                        tier: 2,
                        icon: 'üìä'
                    },
                    sales_closing: {
                        name: '„ÇØ„É≠„Éº„Ç∏„É≥„Ç∞ÊäÄË°ì',
                        description: 'Á¢∫ÂÆü„Å´Â•ëÁ¥Ñ„ÇíÁç≤Âæó„Åß„Åç„Çã',
                        cost: 3,
                        effect: { sales: 15 },
                        prerequisites: ['sales_negotiation', 'sales_presentation'],
                        tier: 3,
                        icon: 'üéØ',
                        special: 'revenue_bonus'
                    },
                    sales_account: {
                        name: '„Ç¢„Ç´„Ç¶„É≥„ÉàÁÆ°ÁêÜ',
                        description: 'Èï∑ÊúüÁöÑ„Å™È°ßÂÆ¢Èñ¢‰øÇ„ÇíÊßãÁØâ',
                        cost: 2,
                        effect: { sales: 10, management: 5 },
                        prerequisites: ['sales_negotiation'],
                        tier: 3,
                        icon: 'üìá'
                    }
                }
            },
            planning: {
                name: '‰ºÅÁîª„Çπ„Ç≠„É´',
                emoji: 'üí°',
                color: '#4facfe',
                skills: {
                    plan_basic: {
                        name: '‰ºÅÁîªÁ´ãÊ°àÂü∫Á§é',
                        description: 'Âü∫Êú¨ÁöÑ„Å™‰ºÅÁîªÂäõ„ÇíÁøíÂæó',
                        cost: 1,
                        effect: { planning: 5 },
                        prerequisites: [],
                        tier: 1,
                        icon: '‚úèÔ∏è'
                    },
                    plan_market: {
                        name: 'Â∏ÇÂ†¥ÂàÜÊûê',
                        description: 'Â∏ÇÂ†¥ÂãïÂêë„ÇíË™≠„ÅøÂèñ„ÇãÂäõ„ÇíÁç≤Âæó',
                        cost: 2,
                        effect: { planning: 10, sales: 3 },
                        prerequisites: ['plan_basic'],
                        tier: 2,
                        icon: 'üîç'
                    },
                    plan_innovation: {
                        name: '„Ç§„Éé„Éô„Éº„Ç∑„Éß„É≥ÊÄùËÄÉ',
                        description: 'Èù©Êñ∞ÁöÑ„Å™„Ç¢„Ç§„Éá„Ç¢„ÇíÁîü„ÅøÂá∫„Åõ„Çã',
                        cost: 3,
                        effect: { planning: 15, technical: 5 },
                        prerequisites: ['plan_market'],
                        tier: 3,
                        icon: 'üí´',
                        special: 'product_innovation_bonus'
                    },
                    plan_strategy: {
                        name: 'Êà¶Áï•Á´ãÊ°à',
                        description: 'Èï∑ÊúüÁöÑ„Å™Êà¶Áï•„ÇíÁ≠ñÂÆö„Åß„Åç„Çã',
                        cost: 2,
                        effect: { planning: 10, management: 5 },
                        prerequisites: ['plan_basic'],
                        tier: 2,
                        icon: 'üé≤'
                    },
                    plan_ux: {
                        name: 'UXË®≠Ë®à',
                        description: '„É¶„Éº„Ç∂„Éº‰ΩìÈ®ì„ÇíÊúÄÈÅ©Âåñ„Åß„Åç„Çã',
                        cost: 2,
                        effect: { planning: 8, technical: 4 },
                        prerequisites: ['plan_basic'],
                        tier: 2,
                        icon: 'üé®'
                    }
                }
            },
            management: {
                name: 'ÁÆ°ÁêÜ„Çπ„Ç≠„É´',
                emoji: 'üìä',
                color: '#f857a6',
                skills: {
                    mgmt_basic: {
                        name: '„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÁÆ°ÁêÜÂü∫Á§é',
                        description: 'Âü∫Êú¨ÁöÑ„Å™ÁÆ°ÁêÜ„Çπ„Ç≠„É´„ÇíÁøíÂæó',
                        cost: 1,
                        effect: { management: 5 },
                        prerequisites: [],
                        tier: 1,
                        icon: 'üìã'
                    },
                    mgmt_team: {
                        name: '„ÉÅ„Éº„É†„Éû„Éç„Ç∏„É°„É≥„Éà',
                        description: '„ÉÅ„Éº„É†„ÇíÂäπÊûúÁöÑ„Å´ÁÆ°ÁêÜ„Åß„Åç„Çã',
                        cost: 2,
                        effect: { management: 10, sales: 3 },
                        prerequisites: ['mgmt_basic'],
                        tier: 2,
                        icon: 'üë•',
                        special: 'team_productivity_bonus'
                    },
                    mgmt_finance: {
                        name: 'Ë≤°ÂãôÁÆ°ÁêÜ',
                        description: '‰∫àÁÆóÁÆ°ÁêÜ„Å®Ë≤°ÂãôÂàÜÊûê„Åå„Åß„Åç„Çã',
                        cost: 2,
                        effect: { management: 10 },
                        prerequisites: ['mgmt_basic'],
                        tier: 2,
                        icon: 'üí∞',
                        special: 'cost_reduction'
                    },
                    mgmt_leadership: {
                        name: '„É™„Éº„ÉÄ„Éº„Ç∑„ÉÉ„Éó',
                        description: 'ÁµÑÁπîÂÖ®‰Ωì„ÇíÁâΩÂºï„Åß„Åç„Çã',
                        cost: 3,
                        effect: { management: 15, sales: 5 },
                        prerequisites: ['mgmt_team'],
                        tier: 3,
                        icon: 'üëë',
                        special: 'company_bonus'
                    },
                    mgmt_risk: {
                        name: '„É™„Çπ„ÇØÁÆ°ÁêÜ',
                        description: '„É™„Çπ„ÇØ„Çí‰∫àÊ∏¨„ÅóÂØæÂá¶„Åß„Åç„Çã',
                        cost: 2,
                        effect: { management: 8, planning: 4 },
                        prerequisites: ['mgmt_basic'],
                        tier: 2,
                        icon: 'üõ°Ô∏è'
                    }
                }
            }
        };

        // „Çπ„Ç≠„É´„ÅÆÁâπÊÆäÂäπÊûúÂÆöÁæ©
        const SKILL_EFFECTS = {
            product_quality_bonus: { description: 'Ë£ΩÂìÅÂìÅË≥™+10%', value: 0.1 },
            revenue_bonus: { description: 'Â£≤‰∏ä+5%', value: 0.05 },
            product_innovation_bonus: { description: 'Êñ∞Ë£ΩÂìÅÈñãÁô∫ÊôÇÈñì-20%', value: 0.2 },
            team_productivity_bonus: { description: '„ÉÅ„Éº„É†ÁîüÁî£ÊÄß+15%', value: 0.15 },
            cost_reduction: { description: 'ÈÅãÂñ∂„Ç≥„Çπ„Éà-10%', value: 0.1 },
            company_bonus: { description: 'ÂÖ®ÂæìÊ•≠Âì°„ÅÆËÉΩÂäõ+3', value: 3 }
        };

        // „Ç™„Éï„Ç£„Çπ„É¨„Éô„É´ÂÆöÁæ©Ôºà5ÊÆµÈöé„ÅÆÊàêÈï∑„Ç∑„Çπ„ÉÜ„É†Ôºâ
        const OFFICE_LEVELS = {
            1: {
                name: '„Ç¢„Éë„Éº„Éà„Ç™„Éï„Ç£„Çπ',
                emoji: 'üè†',
                maxEmployees: 6,
                description: 'Â∞è„Åï„Å™„Ç¢„Éë„Éº„Éà„ÅÆ‰∏ÄÂÆ§„Åã„Çâ„Çπ„Çø„Éº„Éà',
                unlockConditions: { employees: 1, money: 0, marketShare: 0 }
            },
            2: {
                name: '„Ç∑„Çß„Ç¢„ÉØ„Éº„Ç≠„É≥„Ç∞„Çπ„Éö„Éº„Çπ',
                emoji: '‚òï',
                maxEmployees: 12,
                description: 'ÂÖ±Áî®„Ç™„Éï„Ç£„Çπ„ÅßÊàêÈï∑„ÅÆÂÖÜ„Åó',
                unlockConditions: { employees: 6, money: 1500000, marketShare: 3 }
            },
            3: {
                name: 'Â∞èË¶èÊ®°„Ç™„Éï„Ç£„Çπ',
                emoji: 'üè¢',
                maxEmployees: 24,
                description: 'Áã¨Á´ã„Åó„ÅüÂ∞è„Åï„Å™„Ç™„Éï„Ç£„Çπ',
                unlockConditions: { employees: 12, money: 4000000, marketShare: 6 }
            },
            4: {
                name: 'Â§ßË¶èÊ®°„Ç™„Éï„Ç£„Çπ',
                emoji: 'üèõÔ∏è',
                maxEmployees: 40,
                description: '„Éï„É≠„Ç¢ÂÖ®‰Ωì„ÇíÂç†„ÇÅ„ÇãÁ´ãÊ¥æ„Å™„Ç™„Éï„Ç£„Çπ',
                unlockConditions: { employees: 24, money: 9000000, marketShare: 12 }
            },
            5: {
                name: 'Ëá™Á§æ„Éì„É´',
                emoji: 'üè∞',
                maxEmployees: 70,
                description: 'ÂøµÈ°ò„ÅÆËá™Á§æ„Éì„É´ÔºÅÊ•≠Áïå„ÅÆ„É™„Éº„ÉÄ„Éº„Å∏',
                unlockConditions: { employees: 40, money: 18000000, marketShare: 22 }
            }
        };

        const defaultGameState = {
            money: 10000000,
            employees: [],
            products: [],
            turn: 1,
            year: 2025,
            month: 1,
            week: 1,
            marketShare: 0.1,
            brandPower: 1,
            monthlyRevenue: 0,
            debt: 0,
            isBankrupt: false,
            revenueHistory: [],
            officeLevel: 1  // ÂàùÊúü„É¨„Éô„É´: „Ç¢„Éë„Éº„Éà„Ç™„Éï„Ç£„Çπ
        };

        const LOAN_AMOUNT = 5000000;
        const LOAN_INTEREST_RATE = 0.02;
        const SAVE_KEY = 'businessEmpire';

        const game = cloneDefaults();
        let activePanel = 'overview';
        let revenueChart = null;
        let marketChart = null;

        const competitors = [
            { name: '„ÉÜ„ÉÉ„ÇØ„Ç≥„Éº„Éó', share: 35, strategy: 'aggressive', power: 100 },
            { name: '„Éá„Ç∏„Çø„É´„ÉØ„Éº„ÇØ„Çπ', share: 29, strategy: 'balanced', power: 85 },
            { name: '„Çµ„Ç§„Éê„Éº„ÇΩ„Éï„Éà', share: 22, strategy: 'defensive', power: 70 }
        ];

        const newsTemplates = [
            '${company}„ÅåÊñ∞Ë£ΩÂìÅ„ÇíÁô∫Ë°®ÔºÅÊ•≠Áïå„Å´Ë°ùÊíÉ',
            '${company}„ÅÆÂ£≤‰∏ä„Åå${percent}%Â¢óÂä†',
            'ITÊ•≠Áïå„ÅÆÊàêÈï∑Áéá„Åå${percent}%„Å´',
            '${company}„ÅåÂ§ßÂûãË≤∑Âèé„ÇíÊ§úË®é‰∏≠',
            'Êñ∞ÊäÄË°ì„ÅÆÁôªÂ†¥„ÅßÂ∏ÇÂ†¥„ÅåÊ¥ªÊÄßÂåñ',
            '${company}„ÅÆCEO„Åå‰ªäÂæå„ÅÆÊà¶Áï•„ÇíË™û„Çã',
            '„Çπ„Çø„Éº„Éà„Ç¢„ÉÉ„Éó‰ºÅÊ•≠„ÅÆÂèÇÂÖ•„ÅåÁõ∏Ê¨°„Åê'
        ];

        function cloneDefaults() {
            return JSON.parse(JSON.stringify(defaultGameState));
        }

        function overwriteGameState(source) {
            Object.keys(game).forEach(key => delete game[key]);
            Object.assign(game, source);
        }

        function ensureCollections() {
            if (!Array.isArray(game.employees)) game.employees = [];
            if (!Array.isArray(game.products)) game.products = [];
            if (!Array.isArray(game.revenueHistory)) game.revenueHistory = [];
        }

        // Phase 1: Áõ∏ÊÄß„Ç∑„Çπ„ÉÜ„É†ÂÆüË£Ö
        function calculateTeamCompatibility(employees) {
            if (!employees || employees.length < 2) return 1.0;

            let compatibilityScore = 1.0;

            for (let i = 0; i < employees.length; i++) {
                for (let j = i + 1; j < employees.length; j++) {
                    const emp1 = employees[i];
                    const emp2 = employees[j];

                    if (!emp1.personalityKey || !emp2.personalityKey) continue;

                    const personality1 = PERSONALITIES[emp1.personalityKey];
                    const personality2 = PERSONALITIES[emp2.personalityKey];

                    if (!personality1 || !personality2) continue;

                    // Áõ∏ÊÄßËâØ„ÅÑ
                    if (personality1.compatible && personality1.compatible.includes(emp2.personalityKey)) {
                        compatibilityScore += 0.1;
                    }
                    // Áõ∏ÊÄßÊÇ™„ÅÑ
                    if (personality1.incompatible && personality1.incompatible.includes(emp2.personalityKey)) {
                        compatibilityScore -= 0.15;
                    }
                }
            }

            return Math.max(0.7, Math.min(1.3, compatibilityScore));
        }

        // „Ç™„Éï„Ç£„Çπ„É¨„Éô„É´Âà§ÂÆöÈñ¢Êï∞
        function determineOfficeLevel() {
            const currentEmployees = game.employees.length;
            const currentMoney = game.money;
            const currentMarketShare = game.marketShare;

            // „É¨„Éô„É´5„Åã„ÇâÈ†Ü„Å´Á¢∫Ë™çÔºàÊúÄÈ´ò„É¨„Éô„É´„Åã„ÇâÔºâ
            for (let level = 5; level >= 1; level--) {
                const conditions = OFFICE_LEVELS[level].unlockConditions;
                if (currentEmployees >= conditions.employees &&
                    currentMoney >= conditions.money &&
                    currentMarketShare >= conditions.marketShare) {
                    return level;
                }
            }
            return 1; // ÊúÄ‰Ωé„É¨„Éô„É´
        }

        // „Ç™„Éï„Ç£„Çπ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÉÅ„Çß„ÉÉ„ÇØÔºà„Çø„Éº„É≥ÁµÇ‰∫ÜÊôÇ„Å´Âëº„Å∞„Çå„ÇãÔºâ
        function checkOfficeUpgrade() {
            const newLevel = determineOfficeLevel();
            if (newLevel > game.officeLevel) {
                const oldOffice = OFFICE_LEVELS[game.officeLevel];
                const newOffice = OFFICE_LEVELS[newLevel];
                game.officeLevel = newLevel;

                // „Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„ÉâÈÄöÁü•„ÇíË°®Á§∫
                setTimeout(() => {
                    showModal(
                        'üéâ „Ç™„Éï„Ç£„Çπ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„ÉâÔºÅ',
                        `<div style="text-align: center; padding: 20px;">
                            <div style="font-size: 48px; margin-bottom: 16px;">
                                ${oldOffice.emoji} ‚Üí ${newOffice.emoji}
                            </div>
                            <div style="font-size: 20px; font-weight: bold; margin-bottom: 12px; color: #667eea;">
                                ${newOffice.name}
                            </div>
                            <div style="color: #666; margin-bottom: 20px;">
                                ${newOffice.description}
                            </div>
                            <div style="background: rgba(102, 126, 234, 0.1); padding: 12px; border-radius: 12px;">
                                <div style="font-weight: 600; margin-bottom: 8px;">üìä Êñ∞„Åó„ÅÑ‰∏äÈôê</div>
                                <div>ÊúÄÂ§ßÂæìÊ•≠Âì°Êï∞: <strong>${newOffice.maxEmployees}Âêç</strong></div>
                            </div>
                        </div>`
                    );
                }, 800);
                return true;
            }
            return false;
        }

        function normalizeGameState() {
            ensureCollections();
            game.money = Number(game.money) || 0;
            game.turn = Number(game.turn) || 1;
            game.year = Number(game.year) || 2025;
            game.month = Number(game.month) || 1;
            game.week = Number(game.week) || 1;
            game.marketShare = Number(game.marketShare) || 0;
            game.brandPower = Number(game.brandPower) || 0;
            game.monthlyRevenue = Number(game.monthlyRevenue) || 0;
            game.debt = Math.max(0, Number(game.debt) || 0);
            game.isBankrupt = Boolean(game.isBankrupt);
            game.officeLevel = Math.max(1, Math.min(5, Number(game.officeLevel) || 1));
            game.employees.forEach(emp => {
                emp.salary = Number(emp.salary) || 0;
                if (typeof emp.abilities !== 'object' || emp.abilities === null) {
                    emp.abilities = { technical: 0, sales: 0, planning: 0, management: 0 };
                }
                Object.keys(emp.abilities).forEach(key => {
                    emp.abilities[key] = Number(emp.abilities[key]) || 0;
                });
                // Phase 2: Êñ∞„Åó„ÅÑ„Éï„Ç£„Éº„É´„Éâ„ÅÆÊ§úË®º
                if (!emp.personalityKey || !PERSONALITIES[emp.personalityKey]) {
                    emp.personalityKey = 'logical';
                }
                if (!Array.isArray(emp.subTraits)) {
                    emp.subTraits = [];
                }
                if (!emp.hiddenTrait || !HIDDEN_TRAITS[emp.hiddenTrait]) {
                    const hiddenKeys = Object.keys(HIDDEN_TRAITS);
                    emp.hiddenTrait = hiddenKeys[Math.floor(Math.random() * hiddenKeys.length)];
                }
                if (typeof emp.hiddenTraitRevealed !== 'boolean') {
                    emp.hiddenTraitRevealed = false;
                }
                if (typeof emp.joinedTurn !== 'number') {
                    emp.joinedTurn = game.turn || 1;
                }
                if (!Array.isArray(emp.growthHistory)) {
                    emp.growthHistory = [
                        { turn: emp.joinedTurn, event: 'ÂÖ•Á§æ', description: '‰ºöÁ§æ„Å´ÂèÇÂä†„Åó„Åæ„Åó„Åü' }
                    ];
                }
                // üÜï ÈÉ®ÁΩ≤„Å®ÂΩπËÅ∑„ÅÆ„Éê„É™„Éá„Éº„Ç∑„Éß„É≥ (Êó¢Â≠ò„Çª„Éº„Éñ„Éá„Éº„Çø‰∫íÊèõÊÄß)
                if (!emp.department || !DEPARTMENTS[emp.department]) {
                    emp.department = 'development';  // „Éá„Éï„Ç©„É´„Éà„ÅØÈñãÁô∫ÈÉ®
                }
                if (!emp.position || !POSITIONS[emp.position]) {
                    emp.position = 'staff';  // „Éá„Éï„Ç©„É´„Éà„ÅØ„Çπ„Çø„ÉÉ„Éï
                }
                // üå≥ „Çπ„Ç≠„É´„ÉÑ„É™„ÉºÈñ¢ÈÄ£„Éï„Ç£„Éº„É´„Éâ„ÅÆ„Éê„É™„Éá„Éº„Ç∑„Éß„É≥
                if (typeof emp.skillPoints !== 'number') {
                    emp.skillPoints = 0;  // „Éá„Éï„Ç©„É´„Éà„ÅØ0„Éù„Ç§„É≥„Éà
                }
                if (!Array.isArray(emp.unlockedSkills)) {
                    emp.unlockedSkills = [];  // „Éá„Éï„Ç©„É´„Éà„ÅØÊú™Áç≤Âæó
                }
                // üéì 30Ë≥áÊ†º„Ç∑„Çπ„ÉÜ„É†„ÅÆ„Éê„É™„Éá„Éº„Ç∑„Éß„É≥ (Êó¢Â≠ò„Çª„Éº„Éñ„Éá„Éº„Çø‰∫íÊèõÊÄß)
                if (typeof emp.qualification !== 'string' && emp.qualification !== null) {
                    emp.qualification = null;  // „Éá„Éï„Ç©„É´„Éà„ÅØË≥áÊ†º„Å™„Åó
                }
            });
            game.products.forEach(product => {
                product.sales = Number(product.sales) || 0;
                product.quality = Number(product.quality) || 0;
            });
        }

        function resetGameState() {
            overwriteGameState(cloneDefaults());
            normalizeGameState();
            activePanel = 'overview';
        }

        function addInitialEmployee() {
            ensureCollections();
            if (game.employees.length > 0) return;
            const initialEmployee = {
                id: 1,
                name: 'Â±±Áî∞ Â§™ÈÉé',
                personalityKey: 'logical',
                abilities: { technical: 65, sales: 45, planning: 55, management: 50 },
                subTraits: ['fast_learner', 'code_reviewer'],
                hiddenTrait: 'late_bloomer',
                hiddenTraitRevealed: false,
                joinedTurn: 1,
                motivation: 75,
                salary: 400000,
                department: 'development',
                position: 'staff',
                qualification: null,  // üéì ÂàùÊúüÂæìÊ•≠Âì°„ÅØÁÑ°Ë≥áÊ†º
                growthHistory: [
                    { turn: 1, event: 'ÂÖ•Á§æ', description: '‰ºöÁ§æ„Å´ÂèÇÂä†„Åó„Åæ„Åó„Åü' }
                ]
            };
            game.employees.push(initialEmployee);
        }

        function loadGameFromStorage() {
            try {
                const saved = localStorage.getItem(SAVE_KEY);
                if (!saved) return false;
                const parsed = JSON.parse(saved);
                const merged = Object.assign(cloneDefaults(), parsed);
                overwriteGameState(merged);
                normalizeGameState();
                activePanel = typeof parsed.activePanel === 'string' ? parsed.activePanel : 'overview';
                delete game.activePanel;
                return true;
            } catch (error) {
                console.error('Failed to load save data', error);
                return false;
            }
        }

        function init() {
            const loaded = loadGameFromStorage();
            if (!loaded) {
                resetGameState();
                addInitialEmployee();
            } else {
                normalizeGameState();
                if (game.employees.length === 0) addInitialEmployee();
            }
            generateNews();
            updateDisplay();
            updateRanking();
            initCharts();
            showPanel(null, activePanel);
        }

        function initCharts() {
            // Â£≤‰∏ä„ÉÅ„É£„Éº„Éà
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                revenueChart = new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: game.revenueHistory.map((_, i) => `${i + 1}Êúà`),
                        datasets: [{
                            label: 'Â£≤‰∏äÔºà‰∏áÂÜÜÔºâ',
                            data: game.revenueHistory.map(r => r / 10000),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }

            // Â∏ÇÂ†¥„Ç∑„Çß„Ç¢„ÉÅ„É£„Éº„Éà
            const marketCtx = document.getElementById('marketChart');
            if (marketCtx) {
                updateMarketChart();
            }
        }

        function updateCharts() {
            if (revenueChart) {
                revenueChart.data.labels = game.revenueHistory.map((_, i) => `${i + 1}Êúà`);
                revenueChart.data.datasets[0].data = game.revenueHistory.map(r => r / 10000);
                revenueChart.update();
            }

            if (activePanel === 'market') {
                updateMarketChart();
            }
        }

        function updateMarketChart() {
            const marketCtx = document.getElementById('marketChart');
            if (!marketCtx) return;

            if (marketChart) {
                marketChart.destroy();
            }

            const allCompanies = [
                ...competitors.map(c => ({ name: c.name, share: c.share })),
                { name: '„ÅÇ„Å™„Åü', share: game.marketShare }
            ];

            marketChart = new Chart(marketCtx, {
                type: 'doughnut',
                data: {
                    labels: allCompanies.map(c => c.name),
                    datasets: [{
                        data: allCompanies.map(c => c.share),
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#f093fb',
                            '#ffd700'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function generateNews() {
            const template = newsTemplates[Math.floor(Math.random() * newsTemplates.length)];
            const company = competitors[Math.floor(Math.random() * competitors.length)].name;
            const percent = Math.floor(Math.random() * 30) + 10;
            const news = template.replace('${company}', company).replace('${percent}', percent);
            document.getElementById('newsText').textContent = 'üì∞ ' + news;
        }

        function updateCompetitors() {
            competitors.forEach(comp => {
                if (game.marketShare > 5) {
                    if (comp.strategy === 'aggressive') {
                        comp.power += 5;
                        generateNews();
                    }
                }
                if (comp.strategy === 'aggressive') {
                    comp.share += Math.random() * 2;
                } else if (comp.strategy === 'defensive') {
                    comp.share -= Math.random();
                }
                comp.share = Math.max(5, Math.min(60, comp.share));
                if (comp.share > 40) {
                    game.marketShare = Math.max(0.1, game.marketShare - 0.2);
                    if (game.brandPower > 1) {
                        game.brandPower--;
                    }
                }
            });
        }

        function updateRanking() {
            const allCompanies = [
                ...competitors.map(c => ({ name: c.name, share: c.share })),
                { name: '„ÅÇ„Å™„Åü', share: game.marketShare, isPlayer: true }
            ].sort((a, b) => b.share - a.share);

            const medals = ['ü•á', 'ü•à', 'ü•â', '4'];
            const rankingHtml = allCompanies.slice(0, 4).map((company, index) =>
                `<div class="rank-item ${company.isPlayer ? 'player' : ''}">
                    <span class="rank-medal">${medals[index]}</span>
                    ${company.name}<br>(${company.share.toFixed(1)}%)
                </div>`
            ).join('');

            document.getElementById('rankingBar').innerHTML = rankingHtml;
        }

        function showPanel(tabButton, panelId) {
            const targetPanelId = panelId || 'overview';
            const targetTab = tabButton || document.querySelector(`.tab[data-panel="${targetPanelId}"]`);
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            if (targetTab) {
                targetTab.classList.add('active');
            }
            document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
            const panelElement = document.getElementById(targetPanelId);
            if (panelElement) {
                panelElement.classList.add('active');
            }
            activePanel = targetPanelId;
            renderActivePanel();
        }

        function renderOfficeDisplay() {
            const office = OFFICE_LEVELS[game.officeLevel];
            const nextOffice = OFFICE_LEVELS[game.officeLevel + 1];

            let progressPercent = 0;
            if (nextOffice) {
                // Ê¨°„ÅÆ„É¨„Éô„É´„Åæ„Åß„ÅÆÈÄ≤Êçó„ÇíË®àÁÆóÔºà3„Å§„ÅÆÊù°‰ª∂„ÅÆÂπ≥ÂùáÔºâ
                const employeeProgress = Math.min(100, (game.employees.length / nextOffice.unlockConditions.employees) * 100);
                const moneyProgress = Math.min(100, (game.money / nextOffice.unlockConditions.money) * 100);
                const shareProgress = Math.min(100, (game.marketShare / nextOffice.unlockConditions.marketShare) * 100);
                progressPercent = (employeeProgress + moneyProgress + shareProgress) / 3;
            } else {
                progressPercent = 100; // ÊúÄÈ´ò„É¨„Éô„É´ÈÅîÊàê
            }

            const html = `
                <div class="office-display">
                    <div class="office-level-badge">„É¨„Éô„É´ ${game.officeLevel}/5</div>
                    <div class="office-icon">${office.emoji}</div>
                    <div class="office-name">${office.name}</div>
                    <div class="office-description">${office.description}</div>

                    ${nextOffice ? `
                        <div style="margin-top: 12px; font-size: 13px; color: #666;">
                            üìà Ê¨°„ÅÆ„É¨„Éô„É´: ${nextOffice.emoji} ${nextOffice.name}
                        </div>
                        <div class="office-progress">
                            <div class="office-progress-fill" style="width: ${progressPercent}%"></div>
                        </div>
                        <div style="font-size: 12px; color: #999; margin-top: 4px;">
                            ÈÄ≤Êçó: ${Math.floor(progressPercent)}%
                        </div>
                    ` : `
                        <div style="margin-top: 12px; padding: 12px; background: linear-gradient(135deg, #ffd700, #ffed4e); border-radius: 12px;">
                            <strong>üéâ ÊúÄÈ´ò„É¨„Éô„É´ÈÅîÊàêÔºÅ</strong>
                        </div>
                    `}

                    <div class="office-stats">
                        <div class="office-stat">
                            ÁèæÂú®„ÅÆÂæìÊ•≠Âì°<br>
                            <strong>${game.employees.length} / ${office.maxEmployees}</strong>
                        </div>
                        <div class="office-stat">
                            ${nextOffice ? `
                                Ê¨°„ÅÆÊù°‰ª∂<br>
                                <strong style="font-size: 13px;">
                                    ${nextOffice.unlockConditions.employees}Âêç / ${Math.floor(nextOffice.unlockConditions.money/10000)}‰∏á / ${nextOffice.unlockConditions.marketShare}%
                                </strong>
                            ` : `
                                „Çπ„ÉÜ„Éº„Çø„Çπ<br>
                                <strong>ÂÆåÂÖ®Âà∂Ë¶á!</strong>
                            `}
                        </div>
                    </div>
                </div>
            `;

            const officeDisplayEl = document.getElementById('officeDisplay');
            if (officeDisplayEl) {
                officeDisplayEl.innerHTML = html;
            }
        }

        function renderActivePanel() {
            if (activePanel === 'overview') {
                renderOfficeDisplay();
            } else if (activePanel === 'employees') {
                renderEmployees();
            } else if (activePanel === 'departments') {
                renderDepartments();
            } else if (activePanel === 'products') {
                renderProducts();
            } else if (activePanel === 'market') {
                renderMarket();
                updateMarketChart();
            } else if (activePanel === 'finance') {
                renderFinance();
            }
        }

        function updateDisplay() {
            document.getElementById('money').textContent = `${Math.floor(game.money / 10000)}‰∏á`;
            document.getElementById('employeeCount').textContent = game.employees.length;
            document.getElementById('revenue').textContent = `${Math.floor(game.monthlyRevenue / 10000)}‰∏á`;
            document.getElementById('gameDate').textContent = `${game.year}Âπ¥${game.month}Êúà Á¨¨${game.week}ÈÄ±`;
            document.getElementById('marketShare').textContent = `${game.marketShare.toFixed(1)}%`;
            const brandCount = Math.max(0, Math.min(5, Math.floor(game.brandPower)));
            document.getElementById('brand').textContent = brandCount > 0 ? '‚≠ê'.repeat(brandCount) : '‚Äï';

            // „Éó„É≠„Ç∞„É¨„Çπ„Éê„ÉºÊõ¥Êñ∞
            const moneyPercent = Math.min(100, (game.money / 20000000) * 100);
            document.getElementById('moneyProgress').style.width = moneyPercent + '%';

            const revenuePercent = Math.min(100, (game.monthlyRevenue / 10000000) * 100);
            document.getElementById('revenueProgress').style.width = revenuePercent + '%';

            updateControls();
            updateCharts();
        }

        function updateControls() {
            const disabled = game.isBankrupt;
            document.querySelectorAll('[data-requires-active="true"]').forEach(btn => {
                btn.disabled = disabled;
            });
            const restartBtn = document.getElementById('restartButton');
            if (restartBtn) {
                restartBtn.style.display = disabled ? 'block' : 'none';
            }
        }

        function renderEmployees() {
            const list = document.getElementById('employeeList');
            if (game.employees.length === 0) {
                list.innerHTML = '<div class="empty">ÂæìÊ•≠Âì°„Åå„ÅÑ„Åæ„Åõ„Çì</div>';
                return;
            }

            // „ÉÅ„Éº„É†Áõ∏ÊÄß„Çπ„Ç≥„Ç¢Ë®àÁÆó
            const teamCompatibility = calculateTeamCompatibility(game.employees);

            list.innerHTML = `
                ${game.employees.length > 1 ? `
                    <div class="info-box" style="margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600;">ü§ù „ÉÅ„Éº„É†Áõ∏ÊÄß</span>
                            <span style="font-weight: bold; color: ${teamCompatibility >= 1.0 ? '#4caf50' : '#ff9800'};">
                                ${(teamCompatibility * 100).toFixed(0)}%
                            </span>
                        </div>
                    </div>
                ` : ''}
                ${game.employees.map((emp, empIndex) => {
                    const personality = PERSONALITIES[emp.personalityKey] || PERSONALITIES.logical;
                    return `
                        <div class="employee" onclick="showEmployeeDetail(game.employees[${empIndex}])">
                            <div class="employee-header">
                                <div class="employee-name">
                                    <span class="icon-badge">üë§</span>
                                    ${emp.name}
                                </div>
                                <span class="personality">${personality.emoji} ${personality.name}</span>
                            </div>
                            <div style="margin: 8px 0; display: flex; gap: 6px; flex-wrap: wrap;">
                                <span class="department-badge">${DEPARTMENTS[emp.department]?.emoji || 'üíª'} ${DEPARTMENTS[emp.department]?.name || 'ÈñãÁô∫ÈÉ®'}</span>
                                <span class="position-badge">${POSITIONS[emp.position]?.emoji || 'üë§'} ${POSITIONS[emp.position]?.name || '„Çπ„Çø„ÉÉ„Éï'}</span>
                            </div>
                            ${emp.subTraits && emp.subTraits.length > 0 ? `
                                <div style="margin: 12px 0; display: flex; flex-wrap: wrap; gap: 6px;">
                                    ${emp.subTraits.map(traitKey => {
                                        const trait = SUB_TRAITS[traitKey];
                                        if (!trait) return '';
                                        return `<span style="background: ${trait.negative ? 'rgba(244, 67, 54, 0.15)' : 'rgba(76, 175, 80, 0.15)'};
                                                       color: ${trait.negative ? '#f44336' : '#4caf50'};
                                                       padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;">
                                            ${trait.emoji} ${trait.name}
                                        </span>`;
                                    }).join('')}
                                </div>
                            ` : ''}
                            ${emp.hiddenTraitRevealed ? `
                                <div style="margin: 8px 0;">
                                    <span style="background: linear-gradient(135deg, #ffd700, #ffed4e);
                                           padding: 6px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; color: #333;">
                                        ‚ú® ${HIDDEN_TRAITS[emp.hiddenTrait].emoji} ${HIDDEN_TRAITS[emp.hiddenTrait].name}
                                    </span>
                                </div>
                            ` : ''}
                            <div class="abilities">
                                <div class="ability">
                                    <span class="ability-name">‚öôÔ∏è ÊäÄË°ì: ${emp.abilities.technical}</span>
                                    <div class="ability-bar">
                                        <div class="ability-bar-fill" style="width: ${emp.abilities.technical}%"></div>
                                    </div>
                                </div>
                                <div class="ability">
                                    <span class="ability-name">üíº Âñ∂Ê•≠: ${emp.abilities.sales}</span>
                                    <div class="ability-bar">
                                        <div class="ability-bar-fill" style="width: ${emp.abilities.sales}%"></div>
                                    </div>
                                </div>
                                <div class="ability">
                                    <span class="ability-name">üìã ‰ºÅÁîª: ${emp.abilities.planning}</span>
                                    <div class="ability-bar">
                                        <div class="ability-bar-fill" style="width: ${emp.abilities.planning}%"></div>
                                    </div>
                                </div>
                                <div class="ability">
                                    <span class="ability-name">üëî ÁÆ°ÁêÜ: ${emp.abilities.management}</span>
                                    <div class="ability-bar">
                                        <div class="ability-bar-fill" style="width: ${emp.abilities.management}%"></div>
                                    </div>
                                </div>
                            </div>
                            <div style="margin-top: 8px; color: #667eea; font-weight: 600;">üí∞ ÊúàÁµ¶: ${Math.floor(emp.salary / 10000)}‰∏áÂÜÜ</div>
                        </div>
                    `;
                }).join('')}
            `;
        }

        function renderProducts() {
            const list = document.getElementById('productList');
            if (game.products.length === 0) {
                list.innerHTML = '<div class="empty">Ë£ΩÂìÅ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì<br>üí° Êñ∞Ë£ΩÂìÅ„ÇíÈñãÁô∫„Åó„Åæ„Åó„Çá„ÅÜ!</div>';
                return;
            }
            list.innerHTML = game.products.map(product => `
                <div class="product">
                    <div style="font-weight: bold; font-size: 16px; margin-bottom: 8px;">üì¶ ${product.name}</div>
                    <div class="product-quality">‚≠ê ÂìÅË≥™: ${product.quality}%</div>
                    <div style="margin-top: 8px; font-weight: 600;">üíµ Á¥ØË®àÂ£≤‰∏ä: ${Math.floor(product.sales / 10000)}‰∏áÂÜÜ</div>
                </div>
            `).join('');
        }

        function renderMarket() {
            const info = document.getElementById('marketInfo');
            info.innerHTML = `
                <h4 style="margin-top: 20px; margin-bottom: 12px; color: #667eea;">üèÜ Á´∂Âêà‰ºÅÊ•≠</h4>
                ${competitors.map(comp => `
                    <div class="competitor">
                        <strong style="font-size: 15px;">üè¢ ${comp.name}</strong>
                        <div style="margin-top: 6px;">Â∏ÇÂ†¥„Ç∑„Çß„Ç¢: <strong>${comp.share.toFixed(1)}%</strong></div>
                        <div style="margin-top: 4px; font-size: 12px; color: #666;">
                            Êà¶Áï•: ${comp.strategy === 'aggressive' ? '‚öîÔ∏è ÊîªÊíÉÁöÑ' :
                                   comp.strategy === 'balanced' ? '‚öñÔ∏è „Éê„É©„É≥„ÇπÂûã' : 'üõ°Ô∏è ÂÆàÂÇôÁöÑ'}
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function renderFinance() {
            const info = document.getElementById('financeInfo');
            const salaryTotal = game.employees.reduce((sum, emp) => sum + emp.salary, 0);
            const interestPreview = game.debt > 0 ? Math.floor(game.debt * LOAN_INTEREST_RATE) : 0;
            info.innerHTML = `
                <div class="info-box">
                    <div>
                        <span>üìä Â£≤‰∏äÈ´ò</span>
                        <strong>${Math.floor(game.monthlyRevenue / 10000)}‰∏áÂÜÜ</strong>
                    </div>
                    <div>
                        <span>üë• ‰∫∫‰ª∂Ë≤ª</span>
                        <strong>${Math.floor(salaryTotal / 10000)}‰∏áÂÜÜ</strong>
                    </div>
                    <div style="border-top: 2px solid #667eea; padding-top: 8px; margin-top: 8px;">
                        <span>üí∞ Á¥îÂà©Áõä</span>
                        <strong style="color: ${(game.monthlyRevenue - salaryTotal - interestPreview) >= 0 ? '#4caf50' : '#f44336'}">
                            ${Math.floor((game.monthlyRevenue - salaryTotal - interestPreview) / 10000)}‰∏áÂÜÜ
                        </strong>
                    </div>
                    ${game.debt ? `<div style="margin-top: 8px;">
                        <span>üè¶ ÂÄüÈáëÊÆãÈ´ò</span>
                        <strong style="color: #ff9800;">${Math.floor(game.debt / 10000)}‰∏áÂÜÜ</strong>
                    </div>` : ''}
                    ${interestPreview ? `<div>
                        <span>üìà Ê¨°ÊúàÂà©ÊÅØË¶ãËæº</span>
                        <strong>${Math.floor(interestPreview / 10000)}‰∏áÂÜÜ</strong>
                    </div>` : ''}
                </div>
            `;
        }

        // üÜï ÈÉ®ÁΩ≤ÊÉÖÂ†±„ÇíË°®Á§∫„Åô„ÇãÈñ¢Êï∞
        function renderDepartments() {
            const grid = document.getElementById('departmentsGrid');

            if (game.employees.length === 0) {
                grid.innerHTML = '<div class="empty">ÂæìÊ•≠Âì°„Åå„Åæ„Å†„ÅÑ„Åæ„Åõ„Çì</div>';
                return;
            }

            // ÈÉ®ÁΩ≤„Åî„Å®„ÅÆÂæìÊ•≠Âì°„ÇíÈõÜË®à
            const departmentStats = {};
            Object.keys(DEPARTMENTS).forEach(deptKey => {
                departmentStats[deptKey] = {
                    employees: [],
                    totalAbility: 0,
                    manager: null
                };
            });

            // ÂæìÊ•≠Âì°„ÇíÈÉ®ÁΩ≤„Åî„Å®„Å´ÊåØ„ÇäÂàÜ„Åë
            game.employees.forEach(emp => {
                const deptKey = emp.department || 'development';
                if (departmentStats[deptKey]) {
                    departmentStats[deptKey].employees.push(emp);

                    // Âπ≥ÂùáËÉΩÂäõÂÄ§„ÇíË®àÁÆó
                    const avgAbility = (emp.abilities.technical + emp.abilities.sales +
                                       emp.abilities.planning + emp.abilities.management) / 4;
                    departmentStats[deptKey].totalAbility += avgAbility;

                    // ÁÆ°ÁêÜËÅ∑„ÇíÊé¢„ÅôÔºàÈÉ®Èï∑ > Ë™≤Èï∑ > „Ç∑„Éã„Ç¢Ôºâ
                    const empPosition = POSITIONS[emp.position];
                    const currentManager = departmentStats[deptKey].manager;
                    if (!currentManager ||
                        (empPosition && empPosition.requiredAbility > (POSITIONS[currentManager.position]?.requiredAbility || 0))) {
                        departmentStats[deptKey].manager = emp;
                    }
                }
            });

            // ÈÉ®ÁΩ≤„Ç´„Éº„Éâ„ÇíÁîüÊàê
            const departmentCardsHtml = Object.keys(DEPARTMENTS).map(deptKey => {
                const dept = DEPARTMENTS[deptKey];
                const stats = departmentStats[deptKey];
                const empCount = stats.employees.length;
                const avgAbility = empCount > 0 ? Math.round(stats.totalAbility / empCount) : 0;

                // ÂäπÁéáÊÄßË®àÁÆóÔºàÂπ≥ÂùáËÉΩÂäõÂÄ§„Å´Âü∫„Å•„ÅèÔºâ
                const efficiency = Math.min(100, avgAbility * 1.2);
                const efficiencyColor = efficiency >= 80 ? '#4caf50' : efficiency >= 50 ? '#ff9800' : '#f44336';

                return `
                    <div class="department-card">
                        <div class="department-card-header">
                            <div style="font-size: 32px; margin-bottom: 8px;">${dept.emoji}</div>
                            <div style="font-size: 18px; font-weight: 700; color: #333;">${dept.name}</div>
                            <div style="font-size: 12px; color: #999; margin-top: 4px;">${dept.description}</div>
                        </div>

                        <div class="department-stats">
                            <div class="stat-item">
                                <div class="department-stat-label">üë• ‰∫∫Êï∞</div>
                                <div class="department-stat-value">${empCount}Âêç</div>
                            </div>
                            <div class="stat-item">
                                <div class="department-stat-label">üí™ Âπ≥ÂùáËÉΩÂäõ</div>
                                <div class="department-stat-value">${avgAbility}</div>
                            </div>
                        </div>

                        <div class="department-manager">
                            <div style="font-size: 12px; font-weight: 600; color: #667eea; margin-bottom: 6px;">üëî Ë≤¨‰ªªËÄÖ</div>
                            ${stats.manager ? `
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 20px;">${PERSONALITIES[stats.manager.personalityKey]?.emoji || 'üë§'}</span>
                                    <div>
                                        <div style="font-size: 13px; font-weight: 600;">${escapeHtml(stats.manager.name)}</div>
                                        <div style="font-size: 11px; color: #999;">
                                            ${POSITIONS[stats.manager.position]?.emoji || 'üë§'} ${POSITIONS[stats.manager.position]?.name || '„Çπ„Çø„ÉÉ„Éï'}
                                        </div>
                                    </div>
                                </div>
                            ` : '<div style="font-size: 12px; color: #999;">Êú™ÈÖçÁΩÆ</div>'}
                        </div>

                        <div class="department-efficiency">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                                <span style="font-size: 12px; font-weight: 600; color: #667eea;">üìä ÂäπÁéáÊÄß</span>
                                <span style="font-size: 14px; font-weight: 700; color: ${efficiencyColor};">${Math.round(efficiency)}%</span>
                            </div>
                            <div style="background: rgba(0,0,0,0.05); height: 8px; border-radius: 4px; overflow: hidden;">
                                <div style="background: ${efficiencyColor}; height: 100%; width: ${efficiency}%;
                                           transition: width 0.3s ease; border-radius: 4px;"></div>
                            </div>
                        </div>

                        ${empCount > 0 ? `
                            <div class="department-employees">
                                <div style="font-size: 11px; color: #999; margin-bottom: 6px;">ÊâÄÂ±û„É°„É≥„Éê„Éº</div>
                                <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                                    ${stats.employees.slice(0, 8).map(emp =>
                                        `<span style="font-size: 16px;" title="${escapeHtml(emp.name)}">
                                            ${PERSONALITIES[emp.personalityKey]?.emoji || 'üë§'}
                                        </span>`
                                    ).join('')}
                                    ${empCount > 8 ? `<span style="font-size: 11px; color: #999; align-self: center;">+${empCount - 8}</span>` : ''}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');

            grid.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
                    ${departmentCardsHtml}
                </div>
            `;
        }

        function requireCompanyActive() {
            if (!game.isBankrupt) return true;
            showModal('Êìç‰Ωú‰∏çÂèØ', 'ÂÄíÁî£Áä∂ÊÖã„ÅÆ„Åü„ÇÅÊìç‰Ωú„Åß„Åç„Åæ„Åõ„Çì„ÄÇÂÜç„Çπ„Çø„Éº„Éà„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            return false;
        }

        // ÂæìÊ•≠Âì°ÂÄôË£ú„ÇíÁîüÊàê„Åô„Çã„Éò„É´„Éë„ÉºÈñ¢Êï∞
        function generateCandidate() {
            const names = ['‰ΩêËó§', 'Èà¥Êú®', 'È´òÊ©ã', 'Áî∞‰∏≠', '‰ºäËó§', 'Ê∏°Ëæ∫', 'Â±±Êú¨', '‰∏≠Êùë', 'Â∞èÊûó', 'Âä†Ëó§'];
            const firstNames = ['Â§™ÈÉé', 'Ëä±Â≠ê', '‰∏ÄÈÉé', 'ÁæéÂí≤', 'ÂÅ•Â§™', 'ÂÑ™Â≠ê', 'ÁøîÂ§™', 'ÊÑõ', 'Â§ßËºî', 'Á∂æ‰πÉ'];

            const personalityKeys = Object.keys(PERSONALITIES);
            const selectedPersonalityKey = personalityKeys[Math.floor(Math.random() * personalityKeys.length)];

            const subTraitKeys = Object.keys(SUB_TRAITS);
            const numSubTraits = 2 + Math.floor(Math.random() * 2);
            const selectedSubTraits = [];
            const shuffledSubTraits = [...subTraitKeys].sort(() => Math.random() - 0.5);
            for (let i = 0; i < numSubTraits && i < shuffledSubTraits.length; i++) {
                selectedSubTraits.push(shuffledSubTraits[i]);
            }

            const hiddenTraitKeys = Object.keys(HIDDEN_TRAITS);
            const selectedHiddenTrait = hiddenTraitKeys[Math.floor(Math.random() * hiddenTraitKeys.length)];

            const departmentKeys = Object.keys(DEPARTMENTS);
            const selectedDepartmentKey = departmentKeys[Math.floor(Math.random() * departmentKeys.length)];
            const selectedDepartment = DEPARTMENTS[selectedDepartmentKey];

            // === üÜï 30Ë≥áÊ†º„Ç∑„Çπ„ÉÜ„É†Áµ±Âêà ===
            const candidate = {
                id: Date.now() + Math.random(),
                name: names[Math.floor(Math.random() * names.length)] + ' ' +
                      firstNames[Math.floor(Math.random() * firstNames.length)],
                age: 22 + Math.floor(Math.random() * 18), // 22-40Ê≠≥
                personalityKey: selectedPersonalityKey,
                abilities: {
                    technical: 30 + Math.floor(Math.random() * 50),
                    sales: 30 + Math.floor(Math.random() * 50),
                    planning: 30 + Math.floor(Math.random() * 50),
                    management: 30 + Math.floor(Math.random() * 50)
                },
                subTraits: selectedSubTraits,
                hiddenTrait: selectedHiddenTrait,
                hiddenTraitRevealed: false,
                joinedTurn: game.turn,
                motivation: 70,
                department: selectedDepartmentKey,
                position: 'staff',
                skillPoints: 0,
                unlockedSkills: [],
                growthHistory: [
                    { turn: game.turn, event: 'ÂÖ•Á§æ', description: `${selectedDepartment.emoji} ${selectedDepartment.name}„Å´ÈÖçÂ±û„Åï„Çå„Åæ„Åó„Åü` }
                ]
            };

            // Ë≥áÊ†ºÈÅ∏ÊäûÔºàÂÖ®‰Ωì„ÅßÁ¥Ñ5%„Åå‰øùÊúâ„ÄÅÈõ£Èñ¢Ë≥áÊ†º„ÅØ0.5%‰ª•‰∏ãÔºâ
            if (typeof selectQualificationForCandidate === 'function') {
                candidate.qualification = selectQualificationForCandidate(candidate);
            } else {
                candidate.qualification = null;
            }

            // Ë≥áÊ†º„ÇíËÄÉÊÖÆ„Åó„ÅüÁµ¶‰∏éË®àÁÆó
            if (typeof calculateCandidateSalaryWithQualification === 'function') {
                candidate.salary = calculateCandidateSalaryWithQualification(candidate, candidate.qualification);
            } else {
                candidate.salary = 300000 + Math.floor(Math.random() * 200000);
            }

            return candidate;
        }

        function showHiring() {
            if (!requireCompanyActive()) return;

            // „Ç™„Éï„Ç£„Çπ„É¨„Éô„É´„Å´„Çà„ÇãÂæìÊ•≠Âì°‰∏äÈôê„ÉÅ„Çß„ÉÉ„ÇØ
            const currentOffice = OFFICE_LEVELS[game.officeLevel];
            if (game.employees.length >= currentOffice.maxEmployees) {
                const nextOffice = OFFICE_LEVELS[game.officeLevel + 1];
                const upgradeInfo = nextOffice ?
                    `<div style="margin-top: 12px; padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 6px;">üìà Ê¨°„ÅÆ„É¨„Éô„É´Êù°‰ª∂</div>
                        <div style="font-size: 13px;">
                            ${nextOffice.emoji} ${nextOffice.name}<br>
                            ÂøÖË¶Å: ÂæìÊ•≠Âì°${nextOffice.unlockConditions.employees}Âêç„ÄÅË≥áÈáë${Math.floor(nextOffice.unlockConditions.money/10000)}‰∏áÂÜÜ„ÄÅ„Ç∑„Çß„Ç¢${nextOffice.unlockConditions.marketShare}%
                        </div>
                    </div>` : '';
                showModal(
                    'üè¢ Êé°Áî®‰∏äÈôê„Å´ÈÅî„Åó„Åæ„Åó„Åü',
                    `ÁèæÂú®„ÅÆ„Ç™„Éï„Ç£„ÇπÔºà${currentOffice.emoji} ${currentOffice.name}Ôºâ„Åß„ÅØ„ÄÅ„Åì„Çå‰ª•‰∏äÂæìÊ•≠Âì°„ÇíÊé°Áî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ<br>
                    <br>ÊúÄÂ§ßÂæìÊ•≠Âì°Êï∞: <strong>${currentOffice.maxEmployees}Âêç</strong>${upgradeInfo}`
                );
                return;
            }

            // üìã Êé°Áî®ÂãüÈõÜ„Ç≥„Çπ„ÉàÔºàÊ±Ç‰∫∫Â∫ÉÂëäË≤ªÔºâ
            const recruitmentCost = 100000; // 10‰∏áÂÜÜ

            if (game.money < recruitmentCost) {
                showModal('Êé°Áî®Â§±Êïó', `Ë≥áÈáë‰∏çË∂≥„Åß„ÅôÔºàÊé°Áî®ÂãüÈõÜË≤ª: ${recruitmentCost / 10000}‰∏áÂÜÜÂøÖË¶ÅÔºâ`);
                return;
            }

            // Êé°Áî®ÂãüÈõÜË≤ª„ÇíÊîØÊâï„ÅÜ
            game.money -= recruitmentCost;
            updateDisplay();

            // üÜï 3Âêç„ÅÆÂÄôË£úËÄÖ„ÇíÁîüÊàê
            const candidates = [generateCandidate(), generateCandidate(), generateCandidate()];
            window.hireCandidates = candidates; // „Ç∞„É≠„Éº„Éê„É´„Å´‰øùÂ≠ò

            // ÂÄôË£úËÄÖ„Ç´„Éº„Éâ„ÅÆHTMLÁîüÊàê
            const candidateCardsHtml = candidates.map((candidate, index) => {
                const personality = PERSONALITIES[candidate.personalityKey];
                const avgAbility = Math.round((candidate.abilities.technical + candidate.abilities.sales +
                                                candidate.abilities.planning + candidate.abilities.management) / 4);

                // === üÜï Ë≥áÊ†º„Éê„ÉÉ„Ç∏„ÅÆË°®Á§∫ ===
                const qualificationBadge = (typeof renderQualificationBadge === 'function' && candidate.qualification) ?
                    renderQualificationBadge(candidate.qualification) : '';
                const qualificationDetails = (typeof renderQualificationDetails === 'function' && candidate.qualification) ?
                    renderQualificationDetails(candidate.qualification) : '';

                return `
                    <div class="candidate-card-hiring ${candidate.qualification ? 'has-qualification' : ''}" data-index="${index}">
                        <div class="candidate-header">
                            <div style="font-size: 28px; margin-bottom: 6px;">${personality.emoji}</div>
                            <div class="candidate-name">${escapeHtml(candidate.name)} (${candidate.age}Ê≠≥)</div>
                            <div class="candidate-personality"
                                 onclick="showPersonalityDetail('${candidate.personalityKey}')"
                                 style="cursor: pointer; text-decoration: underline; text-decoration-style: dotted;"
                                 title="„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞„ÇíË°®Á§∫">
                                ${personality.name}
                            </div>
                            ${qualificationBadge}
                        </div>

                        <div class="candidate-abilities">
                            <div style="font-weight: 600; margin-bottom: 6px; font-size: 12px;">üí™ ËÉΩÂäõÂÄ§ (Âπ≥Âùá: ${avgAbility})</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 11px;">
                                <div>‚öôÔ∏è ÊäÄË°ì: <strong>${candidate.abilities.technical}</strong></div>
                                <div>üíº Âñ∂Ê•≠: <strong>${candidate.abilities.sales}</strong></div>
                                <div>üìã ‰ºÅÁîª: <strong>${candidate.abilities.planning}</strong></div>
                                <div>üëî ÁÆ°ÁêÜ: <strong>${candidate.abilities.management}</strong></div>
                            </div>
                        </div>

                        <div class="candidate-traits">
                            <div style="font-weight: 600; margin-bottom: 5px; font-size: 12px;">
                                üåü ÁâπÊÄß
                                <span style="font-size: 10px; color: #999; font-weight: normal;">Ôºà„Çø„ÉÉ„Éó„ÅßË©≥Á¥∞Ôºâ</span>
                            </div>
                            <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                                ${candidate.subTraits.map(traitKey => {
                                    const trait = SUB_TRAITS[traitKey];
                                    return `<span class="trait-badge-small ${trait.negative ? 'negative' : 'positive'}"
                                                  onclick="showTraitDetail('${traitKey}')"
                                                  style="cursor: pointer; transition: transform 0.2s;"
                                                  onmouseover="this.style.transform='scale(1.1)'"
                                                  onmouseout="this.style.transform='scale(1)'"
                                                  title="„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞: ${trait.name}">${trait.emoji}</span>`;
                                }).join('')}
                            </div>
                            <div style="font-size: 10px; color: #999; margin-top: 3px;">‚Äª Èö†„ÇåÁâπÊÄß„ÅÇ„Çä</div>
                        </div>

                        ${qualificationDetails}

                        <div class="candidate-salary" style="margin: 8px 0;">
                            üí∞ ${Math.floor(candidate.salary / 10000)}‰∏áÂÜÜ/Êúà
                        </div>

                        <button class="btn-primary candidate-hire-btn" onclick="hireSelectedCandidate(${index})"
                                style="width: 100%; margin-top: 8px;">
                            ‚úÖ Êé°Áî®„Åô„Çã
                        </button>
                    </div>
                `;
            }).join('');

            const html = `
                <div style="padding: 16px;">
                    <div style="margin-bottom: 16px; text-align: center; padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 12px;">
                        <div style="font-size: 14px; color: #333; font-weight: 600;">üíº 3Âêç„ÅÆÂÄôË£úËÄÖ„Åã„ÇâÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</div>
                        <div style="font-size: 12px; color: #666; margin-top: 6px;">
                            üìã Êé°Áî®ÂãüÈõÜË≤ª: ${recruitmentCost / 10000}‰∏áÂÜÜ <span style="color: #4caf50;">‚úì ÊîØÊâïÊ∏à</span>
                        </div>
                        <div style="font-size: 11px; color: #999; margin-top: 4px;">
                            ‚Äª Êé°Áî®ÊôÇ„Å´ËøΩÂä†„ÅßÁµ¶‰∏é3„É∂ÊúàÂàÜ„ÅåÂøÖË¶Å„Åß„Åô
                        </div>
                    </div>
                    <div class="candidates-grid">
                        ${candidateCardsHtml}
                    </div>
                </div>
            `;

            showModal('üìã Êé°Áî®Ê¥ªÂãï', html, true);
        }

        // üÜï ÈÅ∏Êäû„Åó„ÅüÂÄôË£úËÄÖ„ÇíÊé°Áî®„Åô„Çã
        function hireSelectedCandidate(index) {
            const candidate = window.hireCandidates[index];
            if (!candidate) {
                showModal('„Ç®„É©„Éº', 'ÂÄôË£úËÄÖ„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            hireEmployee(candidate);
        }

        // üÜï Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Å¶Êé°Áî®„É¢„Éº„ÉÄ„É´„ÇíÂæ©ÂÖÉ
        function closeDetailModal() {
            if (window.hireCandidates && window.hireCandidates.length > 0) {
                // Êé°Áî®„É¢„Éº„ÉÄ„É´„ÇíÂÜçË°®Á§∫
                restoreHiringModal();
            } else {
                // ÈÄöÂ∏∏„ÅÆ„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
                closeModal();
            }
        }

        // üÜï Êé°Áî®„É¢„Éº„ÉÄ„É´„ÇíÂæ©ÂÖÉÔºàÂÄôË£úËÄÖ„Éá„Éº„Çø„Åã„ÇâÂÜçÊßãÁØâÔºâ
        function restoreHiringModal() {
            const candidates = window.hireCandidates;
            if (!candidates || candidates.length === 0) {
                closeModal();
                return;
            }

            const recruitmentCost = 100000; // Êé°Áî®ÂãüÈõÜË≤ª

            // ÂÄôË£úËÄÖ„Ç´„Éº„Éâ„ÅÆHTMLÁîüÊàêÔºàshowHiringÈñ¢Êï∞„Å®Âêå„Åò„É≠„Ç∏„ÉÉ„ÇØÔºâ
            const candidateCardsHtml = candidates.map((candidate, index) => {
                const personality = PERSONALITIES[candidate.personalityKey];
                const avgAbility = Math.round((candidate.abilities.technical + candidate.abilities.sales +
                                                candidate.abilities.planning + candidate.abilities.management) / 4);

                const qualificationBadge = (typeof renderQualificationBadge === 'function' && candidate.qualification) ?
                    renderQualificationBadge(candidate.qualification) : '';
                const qualificationDetails = (typeof renderQualificationDetails === 'function' && candidate.qualification) ?
                    renderQualificationDetails(candidate.qualification) : '';

                return `
                    <div class="candidate-card-hiring ${candidate.qualification ? 'has-qualification' : ''}" data-index="${index}">
                        <div class="candidate-header">
                            <div style="font-size: 28px; margin-bottom: 6px;">${personality.emoji}</div>
                            <div class="candidate-name">${escapeHtml(candidate.name)} (${candidate.age}Ê≠≥)</div>
                            <div class="candidate-personality"
                                 onclick="showPersonalityDetail('${candidate.personalityKey}')"
                                 style="cursor: pointer; text-decoration: underline; text-decoration-style: dotted;"
                                 title="„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞„ÇíË°®Á§∫">
                                ${personality.name}
                            </div>
                            ${qualificationBadge}
                        </div>

                        <div class="candidate-abilities">
                            <div style="font-weight: 600; margin-bottom: 6px; font-size: 12px;">üí™ ËÉΩÂäõÂÄ§ (Âπ≥Âùá: ${avgAbility})</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 11px;">
                                <div>‚öôÔ∏è ÊäÄË°ì: <strong>${candidate.abilities.technical}</strong></div>
                                <div>üíº Âñ∂Ê•≠: <strong>${candidate.abilities.sales}</strong></div>
                                <div>üìã ‰ºÅÁîª: <strong>${candidate.abilities.planning}</strong></div>
                                <div>üëî ÁÆ°ÁêÜ: <strong>${candidate.abilities.management}</strong></div>
                            </div>
                        </div>

                        <div class="candidate-traits">
                            <div style="font-weight: 600; margin-bottom: 5px; font-size: 12px;">
                                üåü ÁâπÊÄß
                                <span style="font-size: 10px; color: #999; font-weight: normal;">Ôºà„Çø„ÉÉ„Éó„ÅßË©≥Á¥∞Ôºâ</span>
                            </div>
                            <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                                ${candidate.subTraits.map(traitKey => {
                                    const trait = SUB_TRAITS[traitKey];
                                    return `<span class="trait-badge-small ${trait.negative ? 'negative' : 'positive'}"
                                                  onclick="showTraitDetail('${traitKey}')"
                                                  style="cursor: pointer; transition: transform 0.2s;"
                                                  onmouseover="this.style.transform='scale(1.1)'"
                                                  onmouseout="this.style.transform='scale(1)'"
                                                  title="„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞: ${trait.name}">${trait.emoji}</span>`;
                                }).join('')}
                            </div>
                            <div style="font-size: 10px; color: #999; margin-top: 3px;">‚Äª Èö†„ÇåÁâπÊÄß„ÅÇ„Çä</div>
                        </div>

                        ${qualificationDetails}

                        <div class="candidate-salary" style="margin: 8px 0;">
                            üí∞ ${Math.floor(candidate.salary / 10000)}‰∏áÂÜÜ/Êúà
                        </div>

                        <button class="btn-primary candidate-hire-btn" onclick="hireSelectedCandidate(${index})"
                                style="width: 100%; margin-top: 8px;">
                            ‚úÖ Êé°Áî®„Åô„Çã
                        </button>
                    </div>
                `;
            }).join('');

            const html = `
                <div style="padding: 16px;">
                    <div style="margin-bottom: 16px; text-align: center; padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 12px;">
                        <div style="font-size: 14px; color: #333; font-weight: 600;">üíº 3Âêç„ÅÆÂÄôË£úËÄÖ„Åã„ÇâÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</div>
                        <div style="font-size: 12px; color: #666; margin-top: 6px;">
                            üìã Êé°Áî®ÂãüÈõÜË≤ª: ${recruitmentCost / 10000}‰∏áÂÜÜ <span style="color: #4caf50;">‚úì ÊîØÊâïÊ∏à</span>
                        </div>
                        <div style="font-size: 11px; color: #999; margin-top: 4px;">
                            ‚Äª Êé°Áî®ÊôÇ„Å´ËøΩÂä†„ÅßÁµ¶‰∏é3„É∂ÊúàÂàÜ„ÅåÂøÖË¶Å„Åß„Åô
                        </div>
                    </div>
                    <div class="candidates-grid">
                        ${candidateCardsHtml}
                    </div>
                </div>
            `;

            showModal('üìã Êé°Áî®Ê¥ªÂãï', html, true);
        }

        // üÜï ÁâπÊÄß„ÅÆË©≥Á¥∞„ÇíË°®Á§∫
        function showTraitDetail(traitKey, fromHiring = false) {
            const trait = SUB_TRAITS[traitKey];
            if (!trait) return;

            const effectList = Object.entries(trait.impact || {})
                .map(([key, value]) => `<li>${key}: ${value > 0 ? '+' : ''}${value}%</li>`)
                .join('');

            // Êé°Áî®ÁîªÈù¢„Åã„ÇâÈñã„Åã„Çå„ÅüÂ†¥Âêà„ÅØ„ÄÅÈñâ„Åò„Çã„Éú„Çø„É≥„ÅßÊé°Áî®ÁîªÈù¢„Å´Êàª„Çã
            const closeAction = (fromHiring || window.hireCandidates) ? 'closeDetailModal()' : 'closeModal()';

            const html = `
                <div style="padding: 20px; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 12px;">${trait.emoji}</div>
                    <h3 style="margin: 0 0 8px 0; color: ${trait.negative ? '#f44336' : '#4caf50'};">
                        ${trait.name}
                    </h3>
                    <div style="display: inline-block; padding: 4px 12px; background: ${trait.negative ? 'rgba(244, 67, 54, 0.1)' : 'rgba(76, 175, 80, 0.1)'}; border-radius: 12px; font-size: 11px; margin-bottom: 16px;">
                        ${trait.negative ? '‚ö†Ô∏è „Éç„Ç¨„ÉÜ„Ç£„Éñ' : '‚ú® „Éù„Ç∏„ÉÜ„Ç£„Éñ'}
                    </div>
                    <div style="font-size: 14px; color: #666; line-height: 1.6; margin-bottom: 12px;">
                        ${trait.effect}
                    </div>
                    ${effectList ? `
                        <div style="background: rgba(240, 240, 240, 0.5); padding: 12px; border-radius: 8px; margin-top: 12px; text-align: left;">
                            <div style="font-weight: 600; margin-bottom: 6px; font-size: 12px;">üìä ÂäπÊûú:</div>
                            <ul style="margin: 0; padding-left: 20px; font-size: 12px;">
                                ${effectList}
                            </ul>
                        </div>
                    ` : ''}
                    <button class="btn-primary" onclick="${closeAction}" style="margin-top: 16px; width: 100%;">
                        Èñâ„Åò„Çã
                    </button>
                </div>
            `;

            showModal('', html, true);
        }

        // üÜï ÊÄßÊ†º„ÅÆË©≥Á¥∞„ÇíË°®Á§∫
        function showPersonalityDetail(personalityKey, fromHiring = false) {
            const personality = PERSONALITIES[personalityKey];
            if (!personality) return;

            const effectList = Object.entries(personality.effects || {})
                .map(([key, value]) => {
                    const effectNames = {
                        developmentSpeed: 'ÈñãÁô∫ÈÄüÂ∫¶',
                        bugRate: '„Éê„Ç∞Áô∫ÁîüÁéá',
                        teamEfficiency: '„ÉÅ„Éº„É†ÂäπÁéá',
                        salesBonus: 'Âñ∂Ê•≠„Éú„Éº„Éä„Çπ',
                        planningBonus: '‰ºÅÁîª„Éú„Éº„Éä„Çπ',
                        managementBonus: 'ÁÆ°ÁêÜ„Éú„Éº„Éä„Çπ',
                        learningSpeed: 'Â≠¶ÁøíÈÄüÂ∫¶',
                        creativity: 'ÂâµÈÄ†ÊÄß'
                    };
                    return `<li>${effectNames[key] || key}: ${value > 0 ? '+' : ''}${value}%</li>`;
                })
                .join('');

            const compatibleList = personality.compatible?.map(k => PERSONALITIES[k]?.name).filter(Boolean).join('„ÄÅ') || '„Å™„Åó';
            const incompatibleList = personality.incompatible?.map(k => PERSONALITIES[k]?.name).filter(Boolean).join('„ÄÅ') || '„Å™„Åó';

            // Êé°Áî®ÁîªÈù¢„Åã„ÇâÈñã„Åã„Çå„ÅüÂ†¥Âêà„ÅØ„ÄÅÈñâ„Åò„Çã„Éú„Çø„É≥„ÅßÊé°Áî®ÁîªÈù¢„Å´Êàª„Çã
            const closeAction = (fromHiring || window.hireCandidates) ? 'closeDetailModal()' : 'closeModal()';

            const html = `
                <div style="padding: 20px; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 12px;">${personality.emoji}</div>
                    <h3 style="margin: 0 0 16px 0; color: #667eea;">
                        ${personality.name}
                    </h3>
                    <div style="font-size: 14px; color: #666; line-height: 1.6; margin-bottom: 16px; text-align: left;">
                        ${personality.description}
                    </div>
                    ${effectList ? `
                        <div style="background: rgba(102, 126, 234, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 12px; text-align: left;">
                            <div style="font-weight: 600; margin-bottom: 6px; font-size: 12px;">üìä ÂäπÊûú:</div>
                            <ul style="margin: 0; padding-left: 20px; font-size: 12px;">
                                ${effectList}
                            </ul>
                        </div>
                    ` : ''}
                    <div style="background: rgba(76, 175, 80, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 8px; text-align: left;">
                        <div style="font-weight: 600; font-size: 11px; color: #4caf50; margin-bottom: 4px;">‚úÖ Áõ∏ÊÄßËâØ„ÅÑ:</div>
                        <div style="font-size: 12px;">${compatibleList}</div>
                    </div>
                    <div style="background: rgba(244, 67, 54, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 16px; text-align: left;">
                        <div style="font-weight: 600; font-size: 11px; color: #f44336; margin-bottom: 4px;">‚ùå Áõ∏ÊÄßÊÇ™„ÅÑ:</div>
                        <div style="font-size: 12px;">${incompatibleList}</div>
                    </div>
                    <button class="btn-primary" onclick="${closeAction}" style="width: 100%;">
                        Èñâ„Åò„Çã
                    </button>
                </div>
            `;

            showModal('', html, true);
        }

        // Êé°Áî®Âá¶ÁêÜ (ÊóßhireCurrentCandidate + hireEmployeeÁµ±Âêà)
        function hireCurrentCandidate() {
            if (!window.currentCandidate) {
                showModal('„Ç®„É©„Éº', 'ÂÄôË£úËÄÖ„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            hireEmployee(window.currentCandidate);
        }

        function hireEmployee(candidate) {
            if (!requireCompanyActive()) return;
            if (game.money < candidate.salary * 3) {
                showModal('Êé°Áî®Â§±Êïó', 'Ë≥áÈáë‰∏çË∂≥„Åß„ÅôÔºà3„É∂ÊúàÂàÜ„ÅÆÁµ¶‰∏é„ÅåÂøÖË¶ÅÔºâ');
                return;
            }
            game.money -= candidate.salary * 3;
            game.employees.push(candidate);

            // ‰∏ÄÊôÇ„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢
            window.currentCandidate = null;

            updateDisplay();
            renderActivePanel();
            closeModal();
            showModal('üéâ Êé°Áî®ÊàêÂäü', `${escapeHtml(candidate.name)}„Åï„Çì„ÇíÊé°Áî®„Åó„Åæ„Åó„ÅüÔºÅ`);
        }

        // üéØ ËÉΩÂäõÂÄ§„Å´Âøú„Åò„ÅüÊàêÈï∑ÂÄçÁéá„ÇíË®àÁÆó (ÈÄìÊ∏õÂûãÊàêÈï∑Êõ≤Á∑ö)
        function calculateGrowthMultiplier(currentAbility) {
            if (currentAbility >= 90) return 0.2;  // 90+: 20% („Åª„ÅºÊàêÈï∑„Åó„Å™„ÅÑ)
            if (currentAbility >= 80) return 0.4;  // 80-89: 40% („Åã„Å™„ÇäÈàçÂåñ)
            if (currentAbility >= 70) return 0.6;  // 70-79: 60% (ÊàêÈï∑ÈàçÂåñ)
            return 1.0;  // 0-69: 100% (ÈÄöÂ∏∏ÊàêÈï∑)
        }

        // üè¢ ÈÉ®ÁΩ≤Áï∞Âãï„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
        function showDepartmentChangeModal(employee) {
            if (!requireCompanyActive()) return;

            const currentDept = DEPARTMENTS[employee.department];
            const departmentOptions = Object.keys(DEPARTMENTS).map(deptKey => {
                const dept = DEPARTMENTS[deptKey];
                const isCurrent = deptKey === employee.department;
                return `
                    <button onclick="changeDepartment(${employee.id}, '${deptKey}')"
                            class="dept-option ${isCurrent ? 'current' : ''}"
                            ${isCurrent ? 'disabled' : ''}>
                        <div class="dept-emoji">${dept.emoji}</div>
                        <div class="dept-name">${dept.name}</div>
                        <div class="dept-desc">${dept.description}</div>
                        ${isCurrent ? '<div class="current-badge">ÁèæÂú®„ÅÆÈÉ®ÁΩ≤</div>' : ''}
                    </button>
                `;
            }).join('');

            const html = `
                <div style="margin: 16px 0;">
                    <p style="margin-bottom: 16px; color: #666;">
                        ${escapeHtml(employee.name)}„ÅÆÈÖçÂ±ûÂÖà„ÇíÂ§âÊõ¥„Åó„Åæ„Åô
                    </p>
                    <div class="dept-options-grid">
                        ${departmentOptions}
                    </div>
                </div>
            `;

            showModal('üè¢ ÈÉ®ÁΩ≤Áï∞Âãï', html);
        }

        // üè¢ ÈÉ®ÁΩ≤„ÇíÂ§âÊõ¥
        function changeDepartment(employeeId, newDepartmentKey) {
            if (!requireCompanyActive()) return;

            const employee = game.employees.find(e => e.id === employeeId);
            if (!employee) {
                showModal('„Ç®„É©„Éº', 'ÂæìÊ•≠Âì°„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            if (employee.department === newDepartmentKey) {
                showModal('Áï∞ÂãïÂ§±Êïó', '„Åô„Åß„Å´„Åù„ÅÆÈÉ®ÁΩ≤„Å´ÊâÄÂ±û„Åó„Å¶„ÅÑ„Åæ„Åô');
                return;
            }

            const oldDept = DEPARTMENTS[employee.department];
            const newDept = DEPARTMENTS[newDepartmentKey];

            employee.department = newDepartmentKey;

            // ÊàêÈï∑Â±•Ê≠¥„Å´Ë®òÈå≤
            if (!employee.growthHistory) employee.growthHistory = [];
            employee.growthHistory.push({
                turn: game.turn,
                event: 'ÈÉ®ÁΩ≤Áï∞Âãï',
                description: `${oldDept.emoji} ${oldDept.name} „Åã„Çâ ${newDept.emoji} ${newDept.name} „Å∏Áï∞Âãï`
            });

            updateDisplay();
            renderActivePanel();

            closeModal();
            showModal('üéâ Áï∞ÂãïÂÆå‰∫Ü', `${escapeHtml(employee.name)}„Çí${newDept.emoji} ${newDept.name}„Å´Áï∞Âãï„Åï„Åõ„Åæ„Åó„ÅüÔºÅ`);
        }

        // üëî ÊòáÈÄ≤ÂèØËÉΩ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        function canPromote(employee) {
            const positionOrder = ['staff', 'senior', 'manager', 'director'];
            const currentIndex = positionOrder.indexOf(employee.position);

            if (currentIndex === -1 || currentIndex >= positionOrder.length - 1) {
                return false; // Êó¢„Å´ÊúÄÈ´ò‰Ωç
            }

            const nextPositionKey = positionOrder[currentIndex + 1];
            const nextPosition = POSITIONS[nextPositionKey];

            // ÂÖ®ËÉΩÂäõ„ÅÆÂπ≥Âùá„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            const avgAbility = (employee.abilities.technical + employee.abilities.sales +
                                employee.abilities.planning + employee.abilities.management) / 4;

            return avgAbility >= nextPosition.requiredAbility;
        }

        // üëî ÊòáÈÄ≤„Åï„Åõ„Çã
        function promoteEmployee(employeeId) {
            if (!requireCompanyActive()) return;

            const employee = game.employees.find(e => e.id === employeeId);
            if (!employee) {
                showModal('„Ç®„É©„Éº', 'ÂæìÊ•≠Âì°„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            if (!canPromote(employee)) {
                showModal('ÊòáÈÄ≤‰∏çÂèØ', 'ÊòáÈÄ≤„Å´ÂøÖË¶Å„Å™ËÉΩÂäõÂÄ§„ÇíÊ∫Ä„Åü„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                return;
            }

            const positionOrder = ['staff', 'senior', 'manager', 'director'];
            const currentIndex = positionOrder.indexOf(employee.position);
            const nextPositionKey = positionOrder[currentIndex + 1];

            const oldPosition = POSITIONS[employee.position];
            const newPosition = POSITIONS[nextPositionKey];

            // ÂΩπËÅ∑„Çí‰∏ä„Åí„Çã
            employee.position = nextPositionKey;

            // Áµ¶‰∏é„ÇíË™øÊï¥ (ÂΩπËÅ∑„ÅÆÁµ¶‰∏éÂÄçÁéá„ÇíÈÅ©Áî®)
            const baseSalary = employee.salary / oldPosition.salaryMultiplier;
            employee.salary = Math.floor(baseSalary * newPosition.salaryMultiplier);

            // üå≥ ÊòáÈÄ≤„Éú„Éº„Éä„Çπ: „Çπ„Ç≠„É´„Éù„Ç§„É≥„Éà‰ªò‰∏é (ÂΩπËÅ∑„Å´Âøú„Åò„Å¶)
            const promotionBonus = {
                senior: 3,
                manager: 5,
                director: 10
            };
            const bonusPoints = promotionBonus[nextPositionKey] || 0;
            employee.skillPoints = (employee.skillPoints || 0) + bonusPoints;

            // ÊàêÈï∑Â±•Ê≠¥„Å´Ë®òÈå≤
            if (!employee.growthHistory) employee.growthHistory = [];
            employee.growthHistory.push({
                turn: game.turn,
                event: 'ÊòáÈÄ≤',
                description: `${oldPosition.emoji} ${oldPosition.name} „Åã„Çâ ${newPosition.emoji} ${newPosition.name} „Å∏ÊòáÈÄ≤ÔºÅ | „Çπ„Ç≠„É´„Éù„Ç§„É≥„Éà+${bonusPoints}`
            });

            updateDisplay();
            renderActivePanel();

            closeModal();

            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰ªò„ÅçÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏
            const html = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 64px; margin-bottom: 16px;">üéâ</div>
                    <h2 style="color: #667eea; margin-bottom: 12px;">ÊòáÈÄ≤„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô!</h2>
                    <p style="font-size: 18px; margin-bottom: 8px;">${escapeHtml(employee.name)}</p>
                    <p style="font-size: 14px; color: #666; margin-bottom: 16px;">
                        ${oldPosition.emoji} ${oldPosition.name} ‚Üí ${newPosition.emoji} ${newPosition.name}
                    </p>
                    <div style="background: rgba(102, 126, 234, 0.1); padding: 12px; border-radius: 12px; margin-top: 16px;">
                        <div>üí∞ Êñ∞„Åó„ÅÑÁµ¶‰∏é: ${Math.floor(employee.salary / 10000)}‰∏áÂÜÜ</div>
                        ${newPosition.canManage ? `<div style="margin-top: 8px;">üë• ÁÆ°ÁêÜÂèØËÉΩ‰∫∫Êï∞: ${newPosition.canManage}Âêç</div>` : ''}
                        ${bonusPoints > 0 ? `<div style="margin-top: 8px; color: #667eea; font-weight: 600;">üå≥ „Çπ„Ç≠„É´„Éù„Ç§„É≥„Éà+${bonusPoints}Áç≤Âæó!</div>` : ''}
                    </div>
                </div>
            `;

            showModal('', html, true);
        }

        // üå≥ „Çπ„Ç≠„É´„ÉÑ„É™„ÉºÈñ¢ÈÄ£Èñ¢Êï∞Áæ§

        // „Çπ„Ç≠„É´„ÅåÁç≤ÂæóÂèØËÉΩ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        function canUnlockSkill(employee, category, skillId) {
            const skill = SKILL_TREE[category]?.skills[skillId];
            if (!skill) return false;

            // Êó¢„Å´Áç≤ÂæóÊ∏à„Åø
            if (employee.unlockedSkills.includes(skillId)) return false;

            // „Çπ„Ç≠„É´„Éù„Ç§„É≥„Éà‰∏çË∂≥
            if (employee.skillPoints < skill.cost) return false;

            // ÂâçÊèê„Çπ„Ç≠„É´Êú™Áç≤Âæó
            if (skill.prerequisites && skill.prerequisites.length > 0) {
                for (const prereq of skill.prerequisites) {
                    if (!employee.unlockedSkills.includes(prereq)) {
                        return false;
                    }
                }
            }

            return true;
        }

        // „Çπ„Ç≠„É´„ÇíÁç≤Âæó
        function unlockSkill(employeeId, category, skillId) {
            if (!requireCompanyActive()) return;

            const employee = game.employees.find(e => e.id === employeeId);
            if (!employee) {
                showModal('„Ç®„É©„Éº', 'ÂæìÊ•≠Âì°„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            const skill = SKILL_TREE[category]?.skills[skillId];
            if (!skill) {
                showModal('„Ç®„É©„Éº', '„Çπ„Ç≠„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            // Áç≤ÂæóÂèØËÉΩ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            if (!canUnlockSkill(employee, category, skillId)) {
                let reason = '';
                if (employee.unlockedSkills.includes(skillId)) {
                    reason = 'Êó¢„Å´Áç≤ÂæóÊ∏à„Åø„Åß„Åô';
                } else if (employee.skillPoints < skill.cost) {
                    reason = `„Çπ„Ç≠„É´„Éù„Ç§„É≥„Éà„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô (ÂøÖË¶Å: ${skill.cost}, ÁèæÂú®: ${employee.skillPoints})`;
                } else {
                    reason = 'ÂâçÊèê„Çπ„Ç≠„É´„ÇíÂÖà„Å´Áç≤Âæó„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                }
                showModal('„Çπ„Ç≠„É´Áç≤Âæó‰∏çÂèØ', reason);
                return;
            }

            // „Çπ„Ç≠„É´„Éù„Ç§„É≥„ÉàÊ∂àË≤ª
            employee.skillPoints -= skill.cost;

            // „Çπ„Ç≠„É´Áç≤Âæó
            employee.unlockedSkills.push(skillId);

            // ËÉΩÂäõÂÄ§„Éú„Éº„Éä„ÇπÈÅ©Áî®
            if (skill.effect) {
                Object.keys(skill.effect).forEach(abilityKey => {
                    if (employee.abilities[abilityKey] !== undefined) {
                        employee.abilities[abilityKey] = Math.min(100, employee.abilities[abilityKey] + skill.effect[abilityKey]);
                    }
                });
            }

            // ÊàêÈï∑Â±•Ê≠¥„Å´Ë®òÈå≤
            if (!employee.growthHistory) employee.growthHistory = [];
            const effectText = Object.entries(skill.effect || {})
                .map(([key, value]) => `${key}+${value}`)
                .join(', ');
            employee.growthHistory.push({
                turn: game.turn,
                event: '„Çπ„Ç≠„É´Áç≤Âæó',
                description: `${skill.icon} ${skill.name} „ÇíÁøíÂæóÔºÅ (${effectText})`
            });

            updateDisplay();
            renderActivePanel();

            // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏
            const specialEffect = skill.special ? SKILL_EFFECTS[skill.special] : null;
            const html = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 64px; margin-bottom: 16px;">${skill.icon}</div>
                    <h2 style="color: #667eea; margin-bottom: 12px;">„Çπ„Ç≠„É´ÁøíÂæó!</h2>
                    <p style="font-size: 18px; margin-bottom: 8px;">${escapeHtml(employee.name)}</p>
                    <p style="font-size: 16px; font-weight: 600; color: #667eea; margin-bottom: 12px;">
                        ${skill.name}
                    </p>
                    <p style="font-size: 14px; color: #666; margin-bottom: 16px;">
                        ${skill.description}
                    </p>
                    <div style="background: rgba(102, 126, 234, 0.1); padding: 12px; border-radius: 12px; margin-top: 16px;">
                        <div style="font-weight: 600; margin-bottom: 8px;">üìà ÂäπÊûú</div>
                        ${Object.entries(skill.effect || {}).map(([key, value]) =>
                            `<div>${key}: +${value}</div>`
                        ).join('')}
                        ${specialEffect ? `<div style="margin-top: 8px; color: #f093fb; font-weight: 600;">‚ú® ${specialEffect.description}</div>` : ''}
                    </div>
                    <div style="margin-top: 12px; font-size: 14px; color: #999;">
                        ÊÆã„Çä„Çπ„Ç≠„É´„Éù„Ç§„É≥„Éà: ${employee.skillPoints}
                    </div>
                </div>
            `;

            showModal('', html, true);

            // „Çπ„Ç≠„É´„ÉÑ„É™„ÉºUI„ÇíÂÜçË°®Á§∫ („É¢„Éº„ÉÄ„É´„ÅåÈñâ„Åò„ÅüÂæå)
            setTimeout(() => {
                showSkillTreeModal(employee);
            }, 100);
        }

        // „Çπ„Ç≠„É´„ÉÑ„É™„Éº„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
        function showSkillTreeModal(employee) {
            const categories = Object.keys(SKILL_TREE);

            // „Ç´„ÉÜ„Ç¥„É™„Çø„Éñ„ÇíÁîüÊàê
            const tabsHtml = categories.map((catKey, index) => {
                const cat = SKILL_TREE[catKey];
                return `
                    <button
                        class="skill-tab ${index === 0 ? 'active' : ''}"
                        onclick="switchSkillCategory('${catKey}')"
                        data-category="${catKey}"
                        style="background: ${index === 0 ? cat.color : 'rgba(255,255,255,0.1)'};">
                        ${cat.emoji} ${cat.name}
                    </button>
                `;
            }).join('');

            // ÂêÑ„Ç´„ÉÜ„Ç¥„É™„ÅÆ„Çπ„Ç≠„É´„Ç´„Éº„Éâ„ÇíÁîüÊàê
            const skillPanelsHtml = categories.map((catKey, index) => {
                const cat = SKILL_TREE[catKey];
                const skillsHtml = Object.keys(cat.skills).map(skillId => {
                    const skill = cat.skills[skillId];
                    const isUnlocked = employee.unlockedSkills.includes(skillId);
                    const canUnlock = canUnlockSkill(employee, catKey, skillId);
                    const isLocked = !isUnlocked && !canUnlock;

                    // ÂâçÊèê„Çπ„Ç≠„É´Ë°®Á§∫
                    let prereqHtml = '';
                    if (skill.prerequisites && skill.prerequisites.length > 0) {
                        const prereqNames = skill.prerequisites.map(prereqId => {
                            const prereqCat = Object.keys(SKILL_TREE).find(ck => SKILL_TREE[ck].skills[prereqId]);
                            const prereqSkill = prereqCat ? SKILL_TREE[prereqCat].skills[prereqId] : null;
                            const prereqUnlocked = employee.unlockedSkills.includes(prereqId);
                            return prereqSkill ?
                                `<span style="color: ${prereqUnlocked ? '#4caf50' : '#f44336'};">${prereqSkill.icon} ${prereqSkill.name}</span>`
                                : prereqId;
                        }).join(', ');
                        prereqHtml = `
                            <div style="font-size: 11px; color: #999; margin-top: 8px;">
                                ÂâçÊèê: ${prereqNames}
                            </div>
                        `;
                    }

                    // ÁâπÊÆäÂäπÊûúË°®Á§∫
                    const specialEffect = skill.special ? SKILL_EFFECTS[skill.special] : null;
                    const specialHtml = specialEffect ?
                        `<div style="font-size: 11px; color: #f093fb; margin-top: 6px;">‚ú® ${specialEffect.description}</div>`
                        : '';

                    return `
                        <div class="skill-card ${isUnlocked ? 'unlocked' : ''} ${isLocked ? 'locked' : ''} ${canUnlock ? 'can-unlock' : ''}"
                             onclick="${canUnlock ? `unlockSkill(${employee.id}, '${catKey}', '${skillId}')` : ''}"
                             style="cursor: ${canUnlock ? 'pointer' : 'default'}; opacity: ${isLocked ? '0.4' : '1'};">
                            <div style="font-size: 32px; margin-bottom: 8px;">${skill.icon}</div>
                            <div style="font-weight: 600; margin-bottom: 4px; color: ${isUnlocked ? '#4caf50' : (canUnlock ? cat.color : '#666')};">
                                ${skill.name}
                                ${isUnlocked ? ' ‚úì' : ''}
                            </div>
                            <div style="font-size: 12px; color: #666; margin-bottom: 8px;">
                                ${skill.description}
                            </div>
                            <div style="font-size: 12px; margin-bottom: 4px;">
                                ${Object.entries(skill.effect || {}).map(([key, value]) =>
                                    `<span style="color: ${cat.color};">${key}+${value}</span>`
                                ).join(' ')}
                            </div>
                            ${specialHtml}
                            ${prereqHtml}
                            <div style="margin-top: 8px; font-size: 12px; font-weight: 600; color: ${canUnlock ? cat.color : '#999'};">
                                ${isUnlocked ? 'ÁøíÂæóÊ∏à„Åø' : `„Ç≥„Çπ„Éà: ${skill.cost}SP`}
                            </div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="skill-panel ${index === 0 ? 'active' : ''}" data-category="${catKey}">
                        <div class="skill-grid">
                            ${skillsHtml}
                        </div>
                    </div>
                `;
            }).join('');

            const html = `
                <div style="padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="margin: 0; color: #667eea;">üå≥ ${escapeHtml(employee.name)} „ÅÆ„Çπ„Ç≠„É´„ÉÑ„É™„Éº</h3>
                        <div style="background: rgba(102, 126, 234, 0.15); padding: 8px 16px; border-radius: 20px; font-weight: 600; color: #667eea;">
                            üíé ${employee.skillPoints} SP
                        </div>
                    </div>

                    <div class="skill-tabs">
                        ${tabsHtml}
                    </div>

                    ${skillPanelsHtml}

                    <div style="margin-top: 16px; padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 12px; font-size: 13px; color: #666;">
                        üí° „Éí„É≥„Éà: Á†î‰øÆ„ÇÑÊòáÈÄ≤„Åß„Çπ„Ç≠„É´„Éù„Ç§„É≥„Éà„ÇíÁç≤Âæó„Åß„Åç„Åæ„Åô„ÄÇ„Çπ„Ç≠„É´„ÇíÁøíÂæó„Åô„Çã„Å®ËÉΩÂäõÂÄ§„Åå„Ç¢„ÉÉ„Éó„Åó„Åæ„ÅôÔºÅ
                    </div>
                </div>
            `;

            showModal('', html, true);
        }

        // „Çπ„Ç≠„É´„Ç´„ÉÜ„Ç¥„É™Âàá„ÇäÊõø„Åà
        function switchSkillCategory(category) {
            // „Çø„Éñ„ÅÆÂàá„ÇäÊõø„Åà
            document.querySelectorAll('.skill-tab').forEach(tab => {
                const isActive = tab.dataset.category === category;
                tab.classList.toggle('active', isActive);
                if (isActive) {
                    const color = SKILL_TREE[category]?.color || '#667eea';
                    tab.style.background = color;
                } else {
                    tab.style.background = 'rgba(255,255,255,0.1)';
                }
            });

            // „Éë„Éç„É´„ÅÆÂàá„ÇäÊõø„Åà
            document.querySelectorAll('.skill-panel').forEach(panel => {
                panel.classList.toggle('active', panel.dataset.category === category);
            });
        }

        function trainEmployees() {
            if (!requireCompanyActive()) return;
            if (game.employees.length === 0) {
                showModal('Á†î‰øÆÂ§±Êïó', 'ÂæìÊ•≠Âì°„Åå„ÅÑ„Åæ„Åõ„Çì');
                return;
            }
            const cost = 300000 * game.employees.length;
            if (game.money < cost) {
                showModal('Á†î‰øÆÂ§±Êïó', `Ë≥áÈáë‰∏çË∂≥„Åß„ÅôÔºàÂøÖË¶Å: ${cost / 10000}‰∏áÂÜÜÔºâ`);
                return;
            }

            // üÜï Á†î‰øÆÊñπÂêëÊÄßÈÅ∏Êäû„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
            const modalHtml = `
                <div style="padding: 20px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 10px;">
                            Á†î‰øÆ„ÅÆÊñπÂêëÊÄß„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                        </div>
                        <div style="font-size: 12px; color: #999;">
                            üí∞ Ë≤ªÁî®: ${cost / 10000}‰∏áÂÜÜ | üë• ÂØæË±°: ${game.employees.length}Âêç
                        </div>
                    </div>

                    <div style="display: grid; gap: 12px;">
                        <button class="btn-primary" onclick="executeTraining('balanced')"
                                style="padding: 15px; text-align: left; display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 24px;">‚öñÔ∏è</span>
                            <div>
                                <div style="font-weight: 700; margin-bottom: 4px;">„Éê„É©„É≥„ÇπÂûãÁ†î‰øÆ</div>
                                <div style="font-size: 11px; opacity: 0.8;">ÂÖ®ËÉΩÂäõ„Çí„Åæ„Çì„Åπ„Çì„Å™„ÅèÂêë‰∏äÔºàÂü∫Êú¨+10Ôºâ</div>
                            </div>
                        </button>

                        <button class="btn-primary" onclick="executeTraining('technical')"
                                style="padding: 15px; text-align: left; display: flex; align-items: center; gap: 12px; background: linear-gradient(135deg, #667eea, #764ba2);">
                            <span style="font-size: 24px;">‚öôÔ∏è</span>
                            <div>
                                <div style="font-weight: 700; margin-bottom: 4px;">ÊäÄË°ìÂäõÁâπÂåñÁ†î‰øÆ</div>
                                <div style="font-size: 11px; opacity: 0.8;">ÊäÄË°ìÂäõ+15„ÄÅ„Åù„ÅÆ‰ªñ+5</div>
                            </div>
                        </button>

                        <button class="btn-primary" onclick="executeTraining('sales')"
                                style="padding: 15px; text-align: left; display: flex; align-items: center; gap: 12px; background: linear-gradient(135deg, #f093fb, #f5576c);">
                            <span style="font-size: 24px;">üíº</span>
                            <div>
                                <div style="font-weight: 700; margin-bottom: 4px;">Âñ∂Ê•≠ÂäõÁâπÂåñÁ†î‰øÆ</div>
                                <div style="font-size: 11px; opacity: 0.8;">Âñ∂Ê•≠Âäõ+15„ÄÅ„Åù„ÅÆ‰ªñ+5</div>
                            </div>
                        </button>

                        <button class="btn-primary" onclick="executeTraining('planning')"
                                style="padding: 15px; text-align: left; display: flex; align-items: center; gap: 12px; background: linear-gradient(135deg, #4facfe, #00f2fe);">
                            <span style="font-size: 24px;">üìã</span>
                            <div>
                                <div style="font-weight: 700; margin-bottom: 4px;">‰ºÅÁîªÂäõÁâπÂåñÁ†î‰øÆ</div>
                                <div style="font-size: 11px; opacity: 0.8;">‰ºÅÁîªÂäõ+15„ÄÅ„Åù„ÅÆ‰ªñ+5</div>
                            </div>
                        </button>

                        <button class="btn-primary" onclick="executeTraining('management')"
                                style="padding: 15px; text-align: left; display: flex; align-items: center; gap: 12px; background: linear-gradient(135deg, #43e97b, #38f9d7);">
                            <span style="font-size: 24px;">üëî</span>
                            <div>
                                <div style="font-weight: 700; margin-bottom: 4px;">ÁÆ°ÁêÜÂäõÁâπÂåñÁ†î‰øÆ</div>
                                <div style="font-size: 11px; opacity: 0.8;">ÁÆ°ÁêÜÂäõ+15„ÄÅ„Åù„ÅÆ‰ªñ+5</div>
                            </div>
                        </button>

                        <button class="btn-secondary" onclick="closeModal()"
                                style="padding: 12px; margin-top: 8px;">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                    </div>
                </div>
            `;

            showModal('üìö Á†î‰øÆ„Éó„É≠„Ç∞„É©„É†ÈÅ∏Êäû', modalHtml, true);
        }

        // üÜï ÂÆüÈöõ„ÅÆÁ†î‰øÆ„ÇíÂÆüË°å
        function executeTraining(focusType) {
            closeModal();

            const cost = 300000 * game.employees.length;
            game.money -= cost;

            let bonusMessages = [];
            let growthDetails = []; // ÂêÑÂæìÊ•≠Âì°„ÅÆÊàêÈï∑Ë©≥Á¥∞„ÇíË®òÈå≤

            game.employees.forEach(emp => {
                let baseIncrease = 10;

                // Phase 2: fast_learnerÁâπÊÄß„ÅßÁ†î‰øÆÂäπÊûú+50%
                if (emp.subTraits && emp.subTraits.includes('fast_learner')) {
                    baseIncrease = Math.floor(baseIncrease * 1.5);
                    bonusMessages.push(`${emp.name}„ÅØÊó©ÁøíÂæó„ÅßÂäπÊûú„Ç¢„ÉÉ„ÉóÔºÅ`);
                }

                // Phase 1: researcherÊÄßÊ†º„ÅßÂ≠¶ÁøíÈÄüÂ∫¶+30%
                if (emp.personalityKey === 'researcher') {
                    baseIncrease = Math.floor(baseIncrease * 1.3);
                    bonusMessages.push(`${emp.name}„ÅØÁ†îÁ©∂ËÄÖÊ∞óË≥™„ÅßÂäπÊûú„Ç¢„ÉÉ„ÉóÔºÅ`);
                }

                // üÜï Á†î‰øÆÊñπÂêëÊÄß„Å´Âøú„Åò„ÅüÊàêÈï∑Èáè„ÇíË®≠ÂÆö
                const focusMap = {
                    'balanced': { technical: 1.0, sales: 1.0, planning: 1.0, management: 1.0 },
                    'technical': { technical: 1.5, sales: 0.5, planning: 0.5, management: 0.5 },
                    'sales': { technical: 0.5, sales: 1.5, planning: 0.5, management: 0.5 },
                    'planning': { technical: 0.5, sales: 0.5, planning: 1.5, management: 0.5 },
                    'management': { technical: 0.5, sales: 0.5, planning: 0.5, management: 1.5 }
                };

                const focusMultipliers = focusMap[focusType] || focusMap['balanced'];

                // üÜï ËÉΩÂäõÂà•„Å´ÈÄìÊ∏õÊàêÈï∑„ÇíÈÅ©Áî®
                let totalGrowth = 0;
                Object.keys(emp.abilities).forEach(key => {
                    const currentAbility = emp.abilities[key];
                    const growthMultiplier = calculateGrowthMultiplier(currentAbility);
                    const focusMultiplier = focusMultipliers[key] || 1.0;
                    const actualIncrease = Math.max(1, Math.floor(baseIncrease * growthMultiplier * focusMultiplier));

                    emp.abilities[key] = Math.min(100, currentAbility + actualIncrease);
                    totalGrowth += actualIncrease;
                });

                const avgGrowth = Math.floor(totalGrowth / 4);

                // üå≥ Á†î‰øÆ„Å´„Çà„Çã„Çπ„Ç≠„É´„Éù„Ç§„É≥„ÉàÁç≤Âæó (ÊàêÈï∑Èáè„Å´Âøú„Åò„Å¶‰ªò‰∏é)
                const earnedPoints = Math.max(1, Math.floor(avgGrowth / 3));  // Âπ≥ÂùáÊàêÈï∑3„Åî„Å®„Å´1„Éù„Ç§„É≥„Éà
                emp.skillPoints = (emp.skillPoints || 0) + earnedPoints;

                // ÊàêÈï∑Â±•Ê≠¥„Å´Ë®òÈå≤
                const focusNames = {
                    'balanced': '„Éê„É©„É≥„ÇπÂûã',
                    'technical': 'ÊäÄË°ìÂäõÁâπÂåñ',
                    'sales': 'Âñ∂Ê•≠ÂäõÁâπÂåñ',
                    'planning': '‰ºÅÁîªÂäõÁâπÂåñ',
                    'management': 'ÁÆ°ÁêÜÂäõÁâπÂåñ'
                };
                if (!emp.growthHistory) emp.growthHistory = [];
                emp.growthHistory.push({
                    turn: game.turn,
                    event: `Á†î‰øÆÔºà${focusNames[focusType] || '„Éê„É©„É≥„ÇπÂûã'}Ôºâ`,
                    description: `Á†î‰øÆ„ÇíÂèó„Åë„Å¶Âπ≥Âùá+${avgGrowth}‰∏äÊòá | „Çπ„Ç≠„É´„Éù„Ç§„É≥„Éà+${earnedPoints}`
                });

                // „Çπ„Ç≠„É´„Éù„Ç§„É≥„ÉàÁç≤Âæó„É°„ÉÉ„Çª„Éº„Ç∏„ÇíËøΩÂä†
                if (earnedPoints > 0) {
                    bonusMessages.push(`${emp.name}„ÅØ„Çπ„Ç≠„É´„Éù„Ç§„É≥„Éà+${earnedPoints}„ÇíÁç≤ÂæóÔºÅ`);
                }

                growthDetails.push({name: emp.name, growth: avgGrowth});
            });

            updateDisplay();
            renderActivePanel();

            // üÜï ÊàêÈï∑Ë©≥Á¥∞„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÁîüÊàê
            const focusNames = {
                'balanced': '„Éê„É©„É≥„ÇπÂûã',
                'technical': 'ÊäÄË°ìÂäõÁâπÂåñ',
                'sales': 'Âñ∂Ê•≠ÂäõÁâπÂåñ',
                'planning': '‰ºÅÁîªÂäõÁâπÂåñ',
                'management': 'ÁÆ°ÁêÜÂäõÁâπÂåñ'
            };
            let message = `üìö ${focusNames[focusType] || '„Éê„É©„É≥„ÇπÂûã'}Á†î‰øÆ„ÇíÂÆüÊñΩ„Åó„Åæ„Åó„ÅüÔºÅ<br><br>`;
            message += '<div style="font-size: 13px; line-height: 1.6;">';
            growthDetails.forEach(detail => {
                message += `<div>‚ú® ${escapeHtml(detail.name)}: Âπ≥Âùá +${detail.growth}</div>`;
            });
            message += '</div>';

            if (bonusMessages.length > 0) {
                message += '<br><strong>üåü „Éú„Éº„Éä„ÇπÂäπÊûú:</strong><br>' + bonusMessages.join('<br>');
            }

            message += '<br><br><small style="color: #666;">üí° È´òËÉΩÂäõËÄÖ„ÅØÊàêÈï∑„ÅåÈàçÂåñ„Åó„Åæ„Åô (70+: 60%, 80+: 40%, 90+: 20%)</small>';

            showModal('üìö Á†î‰øÆÂÆå‰∫Ü', message);
        }

        function developProduct() {
            if (!requireCompanyActive()) return;
            if (game.employees.length < 2) {
                showModal('ÈñãÁô∫Â§±Êïó', 'ÊúÄ‰Ωé2Âêç„ÅÆÂæìÊ•≠Âì°„ÅåÂøÖË¶Å„Åß„Åô');
                return;
            }
            if (game.money < 2000000) {
                showModal('ÈñãÁô∫Â§±Êïó', 'Ë≥áÈáë‰∏çË∂≥„Åß„ÅôÔºà200‰∏áÂÜÜÂøÖË¶ÅÔºâ');
                return;
            }
            game.money -= 2000000;

            // Phase 1 & 2: „ÉÅ„Éº„É†Áõ∏ÊÄß„Å®ÁâπÊÄß„ÉªÊÄßÊ†º„ÇíËÄÉÊÖÆ„Åó„ÅüÂìÅË≥™Ë®àÁÆó
            const teamCompatibility = calculateTeamCompatibility(game.employees);
            const avgTech = game.employees.reduce((sum, emp) => sum + emp.abilities.technical, 0) / game.employees.length;

            let qualityMultiplier = 1.0;
            let bonusMessages = [];

            // Phase 1: ÂÆåÁíß‰∏ªÁæ©ËÄÖ„ÅßÂìÅË≥™+20%
            const perfectionists = game.employees.filter(emp => emp.personalityKey === 'perfectionist');
            if (perfectionists.length > 0) {
                qualityMultiplier *= 1.2;
                bonusMessages.push(`ÂÆåÁíß‰∏ªÁæ©ËÄÖ„Åå„ÅÑ„Å¶ÂìÅË≥™„Ç¢„ÉÉ„ÉóÔºÅ`);
            }

            // Phase 1: Â≠§È´ò„ÅÆÂ§©Êâç„ÅßËÉΩÂäõ+40%
            const geniuses = game.employees.filter(emp => emp.personalityKey === 'lone_genius');
            if (geniuses.length > 0) {
                qualityMultiplier *= 1.4;
                bonusMessages.push(`Â≠§È´ò„ÅÆÂ§©Êâç„ÅÆÂäõ„ÅßÂ§ßÂπÖÂìÅË≥™„Ç¢„ÉÉ„ÉóÔºÅ`);
            }

            // Phase 2: „Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉàÁâπÊÄß
            const architects = game.employees.filter(emp => emp.subTraits && emp.subTraits.includes('architect'));
            if (architects.length > 0) {
                qualityMultiplier *= 1.5;
                bonusMessages.push(`„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„Éà„ÅÆË®≠Ë®àÂäõ„ÅßÂìÅË≥™Âêë‰∏äÔºÅ`);
            }

            // „ÉÅ„Éº„É†Áõ∏ÊÄß„ÇíÂìÅË≥™„Å´ÂèçÊò†
            qualityMultiplier *= teamCompatibility;

            const baseQuality = Math.floor(50 + (avgTech / 2) + Math.random() * 20);
            const quality = Math.min(100, Math.floor(baseQuality * qualityMultiplier));

            const product = {
                id: Date.now(),
                name: `Ë£ΩÂìÅ${game.products.length + 1}`,
                quality: quality,
                sales: 0
            };
            game.products.push(product);
            updateDisplay();
            renderActivePanel();

            let message = `${product.name}„ÇíÈñãÁô∫„Åó„Åæ„Åó„ÅüÔºÅ<br>ÂìÅË≥™: ${quality}%`;
            if (bonusMessages.length > 0) {
                message += '<br><br><strong>„Éú„Éº„Éä„ÇπÂäπÊûú:</strong><br>' + bonusMessages.join('<br>');
            }
            if (teamCompatibility !== 1.0) {
                message += `<br>„ÉÅ„Éº„É†Áõ∏ÊÄß: ${(teamCompatibility * 100).toFixed(0)}%`;
            }
            showModal('üîß ÈñãÁô∫ÊàêÂäü', message);
        }

        function doMarketing() {
            if (!requireCompanyActive()) return;
            const cost = 1000000;
            if (game.money < cost) {
                showModal('ÂÆüÊñΩÂ§±Êïó', `Ë≥áÈáë‰∏çË∂≥„Åß„ÅôÔºà${cost / 10000}‰∏áÂÜÜÂøÖË¶ÅÔºâ`);
                return;
            }

            // üÜï „Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞Êà¶Áï•ÈÅ∏Êäû„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
            const modalHtml = `
                <div style="padding: 20px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 10px;">
                            „Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞Êà¶Áï•„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                        </div>
                        <div style="font-size: 12px; color: #999;">
                            üí∞ Ë≤ªÁî®: ${cost / 10000}‰∏áÂÜÜ
                        </div>
                    </div>

                    <div style="display: grid; gap: 12px;">
                        <button class="btn-primary" onclick="executeMarketing('balanced')"
                                style="padding: 15px; text-align: left; display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 24px;">‚öñÔ∏è</span>
                            <div>
                                <div style="font-weight: 700; margin-bottom: 4px;">„Éê„É©„É≥„ÇπÂûã„Ç≠„É£„É≥„Éö„Éº„É≥</div>
                                <div style="font-size: 11px; opacity: 0.8;">„Ç∑„Çß„Ç¢+0.3%„ÄÅ„Éñ„É©„É≥„ÉâÂäõ+1.0</div>
                            </div>
                        </button>

                        <button class="btn-primary" onclick="executeMarketing('brand')"
                                style="padding: 15px; text-align: left; display: flex; align-items: center; gap: 12px; background: linear-gradient(135deg, #667eea, #764ba2);">
                            <span style="font-size: 24px;">üåü</span>
                            <div>
                                <div style="font-weight: 700; margin-bottom: 4px;">„Éñ„É©„É≥„ÉâÈáçË¶ñ</div>
                                <div style="font-size: 11px; opacity: 0.8;">„Ç∑„Çß„Ç¢+0.2%„ÄÅ„Éñ„É©„É≥„ÉâÂäõ+2.0</div>
                            </div>
                        </button>

                        <button class="btn-primary" onclick="executeMarketing('share')"
                                style="padding: 15px; text-align: left; display: flex; align-items: center; gap: 12px; background: linear-gradient(135deg, #f093fb, #f5576c);">
                            <span style="font-size: 24px;">üìà</span>
                            <div>
                                <div style="font-weight: 700; margin-bottom: 4px;">„Ç∑„Çß„Ç¢Êã°Â§ßÈáçË¶ñ</div>
                                <div style="font-size: 11px; opacity: 0.8;">„Ç∑„Çß„Ç¢+0.5%„ÄÅ„Éñ„É©„É≥„ÉâÂäõ+0.5</div>
                            </div>
                        </button>

                        <button class="btn-primary" onclick="executeMarketing('niche')"
                                style="padding: 15px; text-align: left; display: flex; align-items: center; gap: 12px; background: linear-gradient(135deg, #4facfe, #00f2fe);">
                            <span style="font-size: 24px;">üéØ</span>
                            <div>
                                <div style="font-weight: 700; margin-bottom: 4px;">„Éã„ÉÉ„ÉÅÊà¶Áï•</div>
                                <div style="font-size: 11px; opacity: 0.8;">„Ç∑„Çß„Ç¢+0.1%„ÄÅ„Éñ„É©„É≥„ÉâÂäõ+1.5</div>
                            </div>
                        </button>

                        <button class="btn-primary" onclick="executeMarketing('lowprice')"
                                style="padding: 15px; text-align: left; display: flex; align-items: center; gap: 12px; background: linear-gradient(135deg, #43e97b, #38f9d7);">
                            <span style="font-size: 24px;">üí∞</span>
                            <div>
                                <div style="font-weight: 700; margin-bottom: 4px;">‰Ωé‰æ°Ê†ºÊà¶Áï•</div>
                                <div style="font-size: 11px; opacity: 0.8;">„Ç∑„Çß„Ç¢+0.6%„ÄÅ„Éñ„É©„É≥„ÉâÂäõ-0.3</div>
                            </div>
                        </button>

                        <button class="btn-secondary" onclick="closeModal()"
                                style="padding: 12px; margin-top: 8px;">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                    </div>
                </div>
            `;

            showModal('üì¢ „Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞Êà¶Áï•ÈÅ∏Êäû', modalHtml, true);
        }

        // üÜï ÂÆüÈöõ„ÅÆ„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞„ÇíÂÆüË°å
        function executeMarketing(strategy) {
            closeModal();

            const cost = 1000000;
            game.money -= cost;

            const strategies = {
                'balanced': { share: 0.3, brand: 1.0, name: '„Éê„É©„É≥„ÇπÂûã' },
                'brand': { share: 0.2, brand: 2.0, name: '„Éñ„É©„É≥„ÉâÈáçË¶ñ' },
                'share': { share: 0.5, brand: 0.5, name: '„Ç∑„Çß„Ç¢Êã°Â§ßÈáçË¶ñ' },
                'niche': { share: 0.1, brand: 1.5, name: '„Éã„ÉÉ„ÉÅÊà¶Áï•' },
                'lowprice': { share: 0.6, brand: -0.3, name: '‰Ωé‰æ°Ê†ºÊà¶Áï•' }
            };

            const selected = strategies[strategy] || strategies['balanced'];

            game.marketShare = Math.min(15, game.marketShare + selected.share);
            game.brandPower = Math.max(0, Math.min(5, game.brandPower + selected.brand));

            updateDisplay();
            renderActivePanel();
            updateRanking();

            let message = `üì¢ ${selected.name}„Ç≠„É£„É≥„Éö„Éº„É≥„ÇíÂÆüÊñΩ„Åó„Åæ„Åó„ÅüÔºÅ<br><br>`;
            message += `üìä Â∏ÇÂ†¥„Ç∑„Çß„Ç¢: +${selected.share}% ‚Üí ${game.marketShare.toFixed(2)}%<br>`;
            message += `‚ú® „Éñ„É©„É≥„ÉâÂäõ: ${selected.brand >= 0 ? '+' : ''}${selected.brand} ‚Üí ${game.brandPower.toFixed(1)}`;

            showModal('üì¢ „Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞ÂÆå‰∫Ü', message);
        }

        function getLoan() {
            if (!requireCompanyActive()) return;
            game.money += LOAN_AMOUNT;
            game.debt += LOAN_AMOUNT;
            updateDisplay();
            renderActivePanel();
            showModal('üè¶ ËûçË≥áÂÆüË°å', `500‰∏áÂÜÜ„ÅÆËûçË≥á„ÇíÂèó„Åë„Åæ„Åó„Åü<br>Âà©Áéá: ${(LOAN_INTEREST_RATE * 100).toFixed(1)}%/Êúà`);
        }

        function repayLoan() {
            if (!requireCompanyActive()) return;
            if (game.debt <= 0) {
                showModal('ËøîÊ∏à‰∏çË¶Å', 'ÁèæÂú®„ÅÆÂÄüÂÖ•„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            const maxRepay = Math.min(game.debt, game.money);
            if (maxRepay <= 0) {
                showModal('ËøîÊ∏àÂ§±Êïó', 'ËøîÊ∏à„Å´ÂÖÖ„Å¶„ÇãË≥áÈáë„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            game.money -= maxRepay;
            game.debt -= maxRepay;
            updateDisplay();
            renderActivePanel();
            showModal('üí∏ ËøîÊ∏àÂÆå‰∫Ü', `${Math.floor(maxRepay / 10000)}‰∏áÂÜÜ„ÇíËøîÊ∏à„Åó„Åæ„Åó„Åü`);
        }

        function nextTurn() {
            if (!requireCompanyActive()) return;
            game.turn++;
            game.week++;

            // Phase 2: Èö†„ÇåÁâπÊÄß„ÅÆÁô∫Âãï„ÉÅ„Çß„ÉÉ„ÇØÔºàÈÄ±Ê¨°Ôºâ
            let hiddenTraitMessages = [];
            game.employees.forEach(emp => {
                if (emp.hiddenTraitRevealed) return;
                if (!emp.joinedTurn) emp.joinedTurn = 1;

                const turnsSinceJoined = game.turn - emp.joinedTurn;
                const hiddenTrait = HIDDEN_TRAITS[emp.hiddenTrait];

                if (!hiddenTrait) return;

                if (turnsSinceJoined >= hiddenTrait.revealTurn) {
                    emp.hiddenTraitRevealed = true;
                    hiddenTraitMessages.push({
                        name: emp.name,
                        trait: hiddenTrait
                    });

                    // Èö†„ÇåÁâπÊÄß„ÅÆÂäπÊûú„ÇíÈÅ©Áî®
                    if (emp.hiddenTrait === 'latent_leader') {
                        emp.abilities.management = Math.min(100, emp.abilities.management + 30);
                    } else if (emp.hiddenTrait === 'late_bloomer') {
                        Object.keys(emp.abilities).forEach(key => {
                            emp.abilities[key] = Math.min(100, Math.floor(emp.abilities[key] * 1.5));
                        });
                    } else if (emp.hiddenTrait === 'self_taught') {
                        Object.keys(emp.abilities).forEach(key => {
                            emp.abilities[key] = Math.min(100, emp.abilities[key] + 15);
                        });
                    }

                    // ÊàêÈï∑Â±•Ê≠¥„Å´Ë®òÈå≤
                    if (!emp.growthHistory) emp.growthHistory = [];
                    emp.growthHistory.push({
                        turn: game.turn,
                        event: 'Èö†„ÇåÁâπÊÄßÂà§Êòé',
                        description: `${hiddenTrait.emoji} ${hiddenTrait.name}„ÅåÂà§Êòé - ${hiddenTrait.effect}`
                    });
                }
            });

            if (game.week > 4) {
                game.week = 1;
                game.month++;
                if (game.month > 12) {
                    game.month = 1;
                    game.year++;
                }

                // Phase 2: self_taughtÁâπÊÄß„ÅßÊØéÊúàËá™Âãï„Çπ„Ç≠„É´„Ç¢„ÉÉ„Éó
                game.employees.forEach(emp => {
                    if (emp.hiddenTraitRevealed && emp.hiddenTrait === 'self_taught') {
                        const randomAbility = ['technical', 'sales', 'planning', 'management'][Math.floor(Math.random() * 4)];
                        emp.abilities[randomAbility] = Math.min(100, emp.abilities[randomAbility] + 5);
                    }
                });

                let revenue = 0;
                game.products.forEach(product => {
                    // Phase 1: „Ç´„É™„Çπ„ÉûÊÄßÊ†º„ÅßÂ£≤‰∏ä+25%
                    let salesMultiplier = 1.0;
                    const charismaticCount = game.employees.filter(emp => emp.personalityKey === 'charismatic').length;
                    if (charismaticCount > 0) {
                        salesMultiplier *= (1 + charismaticCount * 0.25);
                    }

                    const productRevenue = Math.floor(product.quality * 10000 * salesMultiplier);
                    product.sales += productRevenue;
                    revenue += productRevenue;
                });

                const salaryTotal = game.employees.reduce((sum, emp) => sum + emp.salary, 0);
                const interest = game.debt > 0 ? Math.floor(game.debt * LOAN_INTEREST_RATE) : 0;
                game.monthlyRevenue = revenue;
                game.revenueHistory.push(revenue);
                const profit = revenue - salaryTotal - interest;
                game.money += profit;

                if (game.money < 0) {
                    game.isBankrupt = true;
                    updateDisplay();
                    renderActivePanel();
                    updateRanking();
                    showModal('üíî „Ç≤„Éº„É†„Ç™„Éº„Éê„Éº', 'Ë≥áÈáë‰∏çË∂≥„ÅßÂÄíÁî£„Åó„Åæ„Åó„Åü...<br>ÂÜç„Çπ„Çø„Éº„Éà„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }

                const summaryLines = [
                    `üìä Â£≤‰∏ä: ${Math.floor(revenue / 10000)}‰∏áÂÜÜ`,
                    `üë• ‰∫∫‰ª∂Ë≤ª: ${Math.floor(salaryTotal / 10000)}‰∏áÂÜÜ`
                ];
                if (interest > 0) {
                    summaryLines.push(`üìà Âà©ÊÅØ: ${Math.floor(interest / 10000)}‰∏áÂÜÜ`);
                }
                const profitColor = profit >= 0 ? '#4caf50' : '#f44336';
                summaryLines.push(`<div style="margin-top: 8px; padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 8px;">
                    üí∞ ÊúÄÁµÇÂà©Áõä: <strong style="color: ${profitColor}">${Math.floor(profit / 10000)}‰∏áÂÜÜ</strong>
                </div>`);
                showModal('üìÖ ÊúàÊ¨°Ê±∫ÁÆó', summaryLines.join('<br>'));
                updateCompetitors();
                generateNews();
            }

            // Phase 2: Èö†„ÇåÁâπÊÄß„ÅåÂà§Êòé„Åó„ÅüÂ†¥Âêà„ÄÅÈÄöÁü•„ÇíË°®Á§∫
            if (hiddenTraitMessages.length > 0) {
                setTimeout(() => {
                    const messages = hiddenTraitMessages.map(msg => {
                        return `<div style="margin: 12px 0; padding: 12px; background: linear-gradient(135deg, #ffd700, #ffed4e); border-radius: 12px;">
                            <strong>${msg.name}</strong>„ÅÆÈö†„Çå„ÅüÊâçËÉΩ„ÅåÈñãËä±ÔºÅ<br>
                            <span style="font-size: 18px;">${msg.trait.emoji} ${msg.trait.name}</span><br>
                            <span style="font-size: 13px; color: #666;">${msg.trait.effect}</span>
                        </div>`;
                    }).join('');
                    showModal('‚ú® Èö†„Çå„ÅüÁâπÊÄß„ÅåÂà§ÊòéÔºÅ', messages);
                    renderActivePanel();
                }, 500);
            }

            // „Ç™„Éï„Ç£„Çπ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÉÅ„Çß„ÉÉ„ÇØ
            checkOfficeUpgrade();

            updateDisplay();
            renderActivePanel();
            updateRanking();
        }

        function saveGame() {
            if (!requireCompanyActive()) return;
            try {
                const saveData = Object.assign({}, game, { activePanel });
                localStorage.setItem(SAVE_KEY, JSON.stringify(saveData));
                showModal('üíæ ‰øùÂ≠òÂÆå‰∫Ü', '„Ç≤„Éº„É†„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
            } catch (error) {
                console.error('Failed to save game', error);
                showModal('‰øùÂ≠òÂ§±Êïó', '‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function restartGame() {
            closeModal();
            resetGameState();
            addInitialEmployee();
            updateDisplay();
            renderEmployees();
            renderProducts();
            renderMarket();
            renderFinance();
            updateRanking();
            initCharts();
            showPanel(null, 'overview');
            generateNews();
            localStorage.removeItem(SAVE_KEY);
            showModal('üîÑ ÂÜç„Çπ„Çø„Éº„Éà', 'Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü');
        }

        function showModal(title, body, isHtml = false) {
            document.getElementById('modalTitle').textContent = title;
            // isHtml„Ååtrue„ÅÆÂ†¥Âêà„ÅØÊîπË°åÁΩÆÊèõ„Çí„Çπ„Ç≠„ÉÉ„Éó
            document.getElementById('modalBody').innerHTML = isHtml ? body : body.replace(/\n/g, '<br>');
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            const modalEl = document.getElementById('modal');
            modalEl.classList.remove('active', 'employee-detail-modal');

            // „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà„ÅÆÁ†¥Ê£Ñ
            if (employeeRadarChart) {
                employeeRadarChart.destroy();
                employeeRadarChart = null;
            }
        }

        // ÂæìÊ•≠Âì°Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´Ë°®Á§∫Èñ¢Êï∞
        let employeeRadarChart = null;

        function showEmployeeDetail(employee) {
            const personality = PERSONALITIES[employee.personalityKey] || PERSONALITIES.logical;

            // „Éò„ÉÉ„ÉÄ„ÉºÊÉÖÂ†±
            let headerHtml = `
                <div class="employee-detail-header">
                    <div class="employee-detail-icon">${personality.emoji}</div>
                    <div class="employee-detail-info">
                        <div class="employee-detail-name">${escapeHtml(employee.name)}</div>
                        <div class="employee-detail-meta">
                            ${personality.name} | üí∞ ÊúàÁµ¶ ${Math.floor(employee.salary / 10000)}‰∏áÂÜÜ
                        </div>
                    </div>
                </div>
            `;

            // üÜï ÊÄßÊ†º„ÅÆÂäπÊûúË™¨Êòé
            const personalityEffectsHtml = `
                <div style="margin-bottom: 16px; padding: 12px; background: rgba(102, 126, 234, 0.05); border-radius: 12px;">
                    <div style="font-weight: 600; margin-bottom: 8px; color: #667eea; cursor: pointer; text-decoration: underline; text-decoration-style: dotted;"
                         onclick="showPersonalityDetail('${employee.personalityKey}')"
                         title="„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞„ÇíË°®Á§∫">
                        ${personality.emoji} ${personality.name}
                    </div>
                    <div style="font-size: 13px; color: #666; margin-bottom: 8px;">
                        ${Object.entries(personality.effects || {}).map(([key, value]) => {
                            const effectName = {
                                developmentSpeed: 'ÈñãÁô∫ÈÄüÂ∫¶',
                                bugRate: '„Éê„Ç∞Áô∫ÁîüÁéá',
                                teamEfficiency: '„ÉÅ„Éº„É†ÂäπÁéá',
                                salesBonus: 'Âñ∂Ê•≠„Éú„Éº„Éä„Çπ',
                                planningBonus: '‰ºÅÁîª„Éú„Éº„Éä„Çπ',
                                managementBonus: 'ÁÆ°ÁêÜ„Éú„Éº„Éä„Çπ',
                                learningSpeed: 'Â≠¶ÁøíÈÄüÂ∫¶',
                                creativity: 'ÂâµÈÄ†ÊÄß',
                                motivation: '„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥'
                            }[key] || key;
                            const isNegative = (key === 'bugRate' && value > 1) || value < 1;
                            const displayValue = value > 1 ? `+${Math.round((value - 1) * 100)}%` : `${Math.round((1 - value) * 100)}%Ê∏õ`;
                            return `<div style="display: flex; justify-content: space-between; margin: 4px 0;">
                                <span>üìä ${effectName}</span>
                                <span style="font-weight: 600; color: ${isNegative ? '#f44336' : '#4caf50'};">${displayValue}</span>
                            </div>`;
                        }).join('')}
                    </div>
                    ${personality.compatible ? `
                        <div style="font-size: 12px; color: #4caf50; margin-top: 8px;">
                            ‚úÖ Áõ∏ÊÄßËâØÂ•Ω: ${personality.compatible.map(k => PERSONALITIES[k]?.name || k).join(', ')}
                        </div>
                    ` : ''}
                    ${personality.incompatible ? `
                        <div style="font-size: 12px; color: #f44336; margin-top: 4px;">
                            ‚ùå Áõ∏ÊÄßÊÇ™„ÅÑ: ${personality.incompatible.map(k => PERSONALITIES[k]?.name || k).join(', ')}
                        </div>
                    ` : ''}
                </div>
            `;

            // === üÜï Ë≥áÊ†ºÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥ ===
            let qualificationSectionHtml = '';
            if (employee.qualification && typeof QUALIFICATIONS_30 !== 'undefined') {
                const qual = QUALIFICATIONS_30[employee.qualification];
                if (qual) {
                    const qualBadge = typeof renderQualificationBadge === 'function' ?
                        renderQualificationBadge(employee.qualification) : '';
                    const qualDetails = typeof renderQualificationDetails === 'function' ?
                        renderQualificationDetails(employee.qualification) : '';

                    qualificationSectionHtml = `
                        <div style="margin-bottom: 16px; padding: 12px; background: rgba(255, 215, 0, 0.05); border-radius: 12px; border: 2px solid rgba(255, 215, 0, 0.3);">
                            <div style="font-weight: 600; margin-bottom: 8px; color: #FFD700;">üéì ‰øùÊúâË≥áÊ†º</div>
                            ${qualBadge}
                            ${qualDetails}
                        </div>
                    `;
                }
            }

            // ÁâπÊÄßË°®Á§∫ (ÂäπÊûúË™¨Êòé‰ªò„Åç)
            let traitsHtml = '';
            if (employee.subTraits && employee.subTraits.length > 0) {
                traitsHtml = `
                    <div style="margin-bottom: 16px;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #667eea;">
                            üåü ÁâπÊÄß
                            <span style="font-size: 10px; color: #999; font-weight: normal;">Ôºà„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞Ôºâ</span>
                        </div>
                        <div style="display: grid; gap: 8px;">
                            ${employee.subTraits.map(traitKey => {
                                const trait = SUB_TRAITS[traitKey];
                                if (!trait) return '';
                                return `
                                    <div style="padding: 10px; background: ${trait.negative ? 'rgba(244, 67, 54, 0.05)' : 'rgba(76, 175, 80, 0.05)'}; border-radius: 8px; border-left: 3px solid ${trait.negative ? '#f44336' : '#4caf50'}; cursor: pointer; transition: transform 0.2s;"
                                         onclick="showTraitDetail('${traitKey}')"
                                         onmouseover="this.style.transform='scale(1.02)'"
                                         onmouseout="this.style.transform='scale(1)'"
                                         title="„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞„ÇíË°®Á§∫">
                                        <div style="display: flex; align-items: center; margin-bottom: 4px;">
                                            <span class="trait-badge ${trait.negative ? 'negative' : 'positive'}" style="margin: 0;">
                                                ${trait.emoji} ${trait.name}
                                            </span>
                                        </div>
                                        <div style="font-size: 12px; color: #666; margin-top: 4px;">
                                            ${trait.effect}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }

            if (employee.hiddenTraitRevealed) {
                const hiddenTrait = HIDDEN_TRAITS[employee.hiddenTrait];
                traitsHtml += `
                    <div style="margin-bottom: 16px;">
                        <span class="trait-badge hidden">
                            ‚ú® ${hiddenTrait.emoji} ${hiddenTrait.name}
                        </span>
                        <div style="font-size: 12px; color: #666; margin-top: 4px;">
                            ${hiddenTrait.effect}
                        </div>
                    </div>
                `;
            }

            // „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà„Ç≥„É≥„ÉÜ„Éä
            const radarHtml = `
                <div style="margin-bottom: 16px;">
                    <div style="font-weight: 600; margin-bottom: 8px; color: #667eea;">üìä ËÉΩÂäõÂÄ§</div>
                    <div class="radar-chart-container">
                        <canvas id="employeeRadarChart"></canvas>
                    </div>
                </div>
            `;

            // üÜï ÈÉ®ÁΩ≤„ÉªÂΩπËÅ∑ÊÉÖÂ†±„Å®Êìç‰Ωú„Éú„Çø„É≥
            const dept = DEPARTMENTS[employee.department];
            const position = POSITIONS[employee.position];
            const canPromoteNow = canPromote(employee);

            const deptPositionHtml = `
                <div style="margin-bottom: 16px; padding: 16px; background: rgba(102, 126, 234, 0.05); border-radius: 12px;">
                    <div style="font-weight: 600; margin-bottom: 12px; color: #667eea;">üíº ÊâÄÂ±û„ÉªÂΩπËÅ∑</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                        <div>
                            <div style="font-size: 11px; color: #999; margin-bottom: 4px;">ÈÉ®ÁΩ≤</div>
                            <div style="font-weight: 600;">${dept.emoji} ${dept.name}</div>
                            <div style="font-size: 11px; color: #666; margin-top: 2px;">${dept.description}</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #999; margin-bottom: 4px;">ÂΩπËÅ∑</div>
                            <div style="font-weight: 600;">${position.emoji} ${position.name}</div>
                            <div style="font-size: 11px; color: #666; margin-top: 2px;">${position.description}</div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px;">
                        <button onclick="showDepartmentChangeModal(game.employees.find(e => e.id === ${employee.id}))"
                                class="btn-secondary">
                            üè¢ ÈÉ®ÁΩ≤Áï∞Âãï
                        </button>
                        <button onclick="showSkillTreeModal(game.employees.find(e => e.id === ${employee.id}))"
                                class="btn-secondary" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)); border-color: rgba(102, 126, 234, 0.5);">
                            üå≥ „Çπ„Ç≠„É´„ÉÑ„É™„Éº ${(employee.skillPoints || 0) > 0 ? `<strong style="color: #667eea;">(${employee.skillPoints}SP)</strong>` : ''}
                        </button>
                        ${canPromoteNow ? `
                            <button onclick="promoteEmployee(${employee.id})"
                                    class="btn-primary" style="grid-column: 1 / -1;">
                                ‚≠ê ÊòáÈÄ≤„Åï„Åõ„Çã
                            </button>
                        ` : `
                            <button disabled class="btn-secondary" style="grid-column: 1 / -1; opacity: 0.5;">
                                üîí ÊòáÈÄ≤‰∏çÂèØ
                            </button>
                        `}
                    </div>
                    ${!canPromoteNow && employee.position !== 'director' ? `
                        <div style="font-size: 11px; color: #999; margin-top: 8px; text-align: center;">
                            üí° Âπ≥ÂùáËÉΩÂäõ${POSITIONS[['senior', 'manager', 'director'][['staff', 'senior', 'manager'].indexOf(employee.position) + 1]]?.requiredAbility || 100}‰ª•‰∏ä„ÅßÊòáÈÄ≤ÂèØËÉΩ
                        </div>
                    ` : ''}
                </div>
            `;

            // ÊàêÈï∑Â±•Ê≠¥„Çø„Ç§„É†„É©„Ç§„É≥
            const historyHtml = `
                <div class="growth-timeline">
                    <div class="timeline-title">
                        üìà ÊàêÈï∑Â±•Ê≠¥
                    </div>
                    ${(employee.growthHistory || []).map(history => `
                        <div class="timeline-item">
                            <div class="timeline-turn">Á¨¨${history.turn}ÈÄ±</div>
                            <div class="timeline-event">${escapeHtml(history.event)}</div>
                            <div class="timeline-description">${escapeHtml(history.description)}</div>
                        </div>
                    `).join('')}
                </div>
            `;

            const modalBody = headerHtml + personalityEffectsHtml + qualificationSectionHtml + traitsHtml + radarHtml + deptPositionHtml + historyHtml;

            // „É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
            document.getElementById('modalTitle').textContent = 'üë§ ÂæìÊ•≠Âì°Ë©≥Á¥∞';
            document.getElementById('modalBody').innerHTML = modalBody;
            const modalEl = document.getElementById('modal');
            modalEl.classList.add('active', 'employee-detail-modal');

            // „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà„ÇíÊèèÁîªÔºàDOM„ÅåÊõ¥Êñ∞„Åï„Çå„ÅüÂæåÔºâ
            setTimeout(() => {
                renderEmployeeRadarChart(employee);
            }, 50);
        }

        function renderEmployeeRadarChart(employee) {
            const canvas = document.getElementById('employeeRadarChart');
            if (!canvas) return;

            // Êó¢Â≠ò„ÅÆ„ÉÅ„É£„Éº„Éà„ÇíÁ†¥Ê£Ñ
            if (employeeRadarChart) {
                employeeRadarChart.destroy();
                employeeRadarChart = null;
            }

            employeeRadarChart = new Chart(canvas, {
                type: 'radar',
                data: {
                    labels: ['ÊäÄË°ìÂäõ', 'Âñ∂Ê•≠Âäõ', '‰ºÅÁîªÂäõ', 'ÁÆ°ÁêÜÂäõ'],
                    datasets: [{
                        label: 'ËÉΩÂäõÂÄ§',
                        data: [
                            employee.abilities.technical,
                            employee.abilities.sales,
                            employee.abilities.planning,
                            employee.abilities.management
                        ],
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: '#667eea',
                        borderWidth: 2,
                        pointBackgroundColor: '#667eea',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            angleLines: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // XSSÂØæÁ≠ñÁî®„Ç®„Çπ„Ç±„Éº„ÉóÈñ¢Êï∞
        function escapeHtml(unsafe) {
            if (unsafe === null || unsafe === undefined) return '';
            return String(unsafe)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        init();
    </script>

    <!-- Ë≥áÊ†ºÂèñÂæó„Ç∑„Çπ„ÉÜ„É† -->
    <script src="js/certification-manager.js"></script>
    <script src="js/certification-ui.js"></script>

    <!-- 30Ë≥áÊ†º„Ç∑„Çπ„ÉÜ„É† -->
    <script src="js/qualifications-30.js"></script>
    <script src="js/qualification-candidate-generator.js"></script>
</body>
</html>
