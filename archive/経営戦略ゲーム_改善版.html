<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ³ãƒ‘ã‚¤ã‚¢ - çµŒå–¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Sans', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%);
            backdrop-filter: blur(10px);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .company-name {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .date { font-size: 14px; opacity: 0.9; }

        /* è¦–è¦šçš„ãªçµ±è¨ˆã‚«ãƒ¼ãƒ‰ */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
        }

        .stat {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
            transition: transform 0.2s, background 0.2s;
        }

        .stat:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.3);
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.9;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            background: linear-gradient(135deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 6px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            transition: width 0.5s ease;
        }

        /* ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚«ãƒ¼æ”¹å–„ */
        .news-ticker {
            background: linear-gradient(90deg, #2c3e50, #34495e);
            color: #ffd700;
            padding: 10px;
            overflow: hidden;
            white-space: nowrap;
            font-size: 12px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .news-ticker span {
            display: inline-block;
            animation: scroll 25s linear infinite;
            padding-left: 100%;
        }

        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        /* ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º - ã‚¢ã‚¤ã‚³ãƒ³è¿½åŠ  */
        .ranking-bar {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 12px;
            display: flex;
            justify-content: space-around;
            font-size: 10px;
            gap: 5px;
        }

        .rank-item {
            text-align: center;
            padding: 8px 6px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex: 1;
            transition: transform 0.2s;
        }

        .rank-item:hover {
            transform: translateY(-2px);
        }

        .rank-item.player {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(255, 215, 0, 0.3);
        }

        .rank-medal {
            font-size: 16px;
            display: block;
            margin-bottom: 2px;
        }

        /* ã‚¿ãƒ–æ”¹å–„ */
        .tabs {
            display: flex;
            padding: 15px 15px 0;
            gap: 8px;
            overflow-x: auto;
            background: white;
            scrollbar-width: none;
        }

        .tabs::-webkit-scrollbar { display: none; }

        .tab {
            padding: 12px 16px;
            background: rgba(240, 240, 240, 0.8);
            backdrop-filter: blur(5px);
            border: none;
            border-radius: 12px 12px 0 0;
            font-weight: 600;
            font-size: 13px;
            color: #666;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .content {
            padding: 20px;
            min-height: 450px;
            background: white;
        }

        .panel { display: none; }
        .panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ãƒœã‚¿ãƒ³æ”¹å–„ - è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å¼·åŒ– */
        .btn {
            width: 100%;
            padding: 16px;
            margin: 10px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.2);
            transition: left 0.3s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:disabled {
            background: linear-gradient(135deg, #b0b0b0, #888);
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.6;
        }

        .btn:disabled:active { transform: none; }

        .btn:active:not(:disabled) {
            transform: scale(0.97);
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.4);
        }

        #restartButton {
            display: none;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        /* å¾“æ¥­å“¡ã‚«ãƒ¼ãƒ‰ - ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ  */
        .employee {
            background: rgba(248, 248, 248, 0.8);
            backdrop-filter: blur(10px);
            padding: 16px;
            margin: 12px 0;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .employee:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .employee-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .employee-name {
            font-weight: bold;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .personality {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 10px;
            border-radius: 14px;
            font-size: 11px;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }

        /* ã‚¹ã‚­ãƒ«ãƒãƒ¼ */
        .abilities {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 12px 0;
        }

        .ability {
            font-size: 13px;
        }

        .ability-name {
            color: #666;
            font-size: 11px;
            margin-bottom: 4px;
            display: block;
        }

        .ability-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }

        .ability-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }

        .ability-value {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«æ”¹å–„ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.2s ease;
        }

        .modal-content {
            background: white;
            padding: 28px;
            border-radius: 20px;
            max-width: 360px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-close {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #e0e0e0, #f0f0f0);
            border: none;
            border-radius: 10px;
            font-weight: bold;
            margin-top: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-close:active {
            transform: scale(0.98);
            background: #d0d0d0;
        }

        .empty {
            text-align: center;
            color: #999;
            padding: 50px 20px;
            font-size: 14px;
        }

        /* è£½å“ã‚«ãƒ¼ãƒ‰æ”¹å–„ */
        .product {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 16px;
            margin: 12px 0;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(168, 237, 234, 0.4);
            transition: transform 0.2s;
        }

        .product:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(168, 237, 234, 0.5);
        }

        .product-quality {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(255,255,255,0.5);
            backdrop-filter: blur(5px);
            border-radius: 12px;
            margin-top: 8px;
            font-size: 13px;
        }

        /* æƒ…å ±ãƒœãƒƒã‚¯ã‚¹ - ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ  */
        .info-box {
            background: rgba(240, 240, 240, 0.6);
            backdrop-filter: blur(10px);
            padding: 16px;
            border-radius: 12px;
            margin: 12px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .info-box div {
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .competitor {
            background: linear-gradient(135deg, #fff3cd, #ffe8a1);
            padding: 12px;
            margin: 8px 0;
            border-radius: 10px;
            border-left: 4px solid #ff9800;
            box-shadow: 0 2px 6px rgba(255, 152, 0, 0.2);
            transition: transform 0.2s;
        }

        .competitor:hover {
            transform: translateX(4px);
        }

        /* ãƒãƒ£ãƒ¼ãƒˆã‚³ãƒ³ãƒ†ãƒŠ */
        .chart-container {
            margin: 20px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            position: relative;
            height: 250px;
        }

        .chart-container canvas {
            max-height: 200px !important;
        }

        .chart-title {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 12px;
        }

        /* ã‚¢ã‚¤ã‚³ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
        .icon-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            color: white;
            font-size: 12px;
            margin-right: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="company-name">ğŸ¢ æ ªå¼ä¼šç¤¾ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—</div>
            <div class="date" id="gameDate">2025å¹´1æœˆ ç¬¬1é€±</div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">ğŸ’° è³‡é‡‘</div>
                    <div class="stat-value" id="money">1000ä¸‡</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="moneyProgress" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">ğŸ‘¥ å¾“æ¥­å“¡</div>
                    <div class="stat-value" id="employeeCount">1</div>
                </div>
                <div class="stat">
                    <div class="stat-label">ğŸ“Š å£²ä¸Š</div>
                    <div class="stat-value" id="revenue">0ä¸‡</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="revenueProgress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚«ãƒ¼ -->
        <div class="news-ticker">
            <span id="newsText">ğŸ“° ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ITæ¥­ç•Œã§æˆåŠŸã‚’ç›®æŒ‡ãã†ï¼</span>
        </div>

        <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º -->
        <div class="ranking-bar" id="rankingBar">
            <div class="rank-item">
                <span class="rank-medal">ğŸ¥‡</span>
                ãƒ†ãƒƒã‚¯ã‚³ãƒ¼ãƒ—<br>(35%)
            </div>
            <div class="rank-item">
                <span class="rank-medal">ğŸ¥ˆ</span>
                ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ¯ãƒ¼ã‚¯ã‚¹<br>(29%)
            </div>
            <div class="rank-item">
                <span class="rank-medal">ğŸ¥‰</span>
                ã‚µã‚¤ãƒãƒ¼ã‚½ãƒ•ãƒˆ<br>(22%)
            </div>
            <div class="rank-item player">
                <span class="rank-medal">4</span>
                ã‚ãªãŸ<br>(0.1%)
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" data-panel="overview" onclick="showPanel(this, 'overview')">ğŸ“Š æ¦‚è¦</button>
            <button class="tab" data-panel="employees" onclick="showPanel(this, 'employees')">ğŸ‘¥ äººäº‹</button>
            <button class="tab" data-panel="products" onclick="showPanel(this, 'products')">ğŸ“¦ è£½å“</button>
            <button class="tab" data-panel="market" onclick="showPanel(this, 'market')">ğŸ¢ å¸‚å ´</button>
            <button class="tab" data-panel="finance" onclick="showPanel(this, 'finance')">ğŸ’° è²¡å‹™</button>
        </div>

        <div class="content">
            <div id="overview" class="panel active">
                <h3>ğŸ¢ ä¼šç¤¾æ¦‚è¦</h3>
                <div class="info-box">
                    <div>
                        <span>æ¥­ç•Œ</span>
                        <span>ITãƒ»ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢</span>
                    </div>
                    <div>
                        <span>å¸‚å ´ã‚·ã‚§ã‚¢</span>
                        <span id="marketShare">0.1%</span>
                    </div>
                    <div>
                        <span>ãƒ–ãƒ©ãƒ³ãƒ‰åŠ›</span>
                        <span id="brand">â­</span>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">ğŸ“ˆ å£²ä¸Šæ¨ç§»</div>
                    <canvas id="revenueChart" height="180"></canvas>
                </div>

                <button class="btn" data-requires-active="true" onclick="nextTurn()">â­ï¸ æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã¸</button>
                <button class="btn" data-requires-active="true" onclick="saveGame()">ğŸ’¾ ã‚²ãƒ¼ãƒ ä¿å­˜</button>
                <button class="btn" id="restartButton" onclick="restartGame()">ğŸ”„ ã‚²ãƒ¼ãƒ å†ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            </div>

            <div id="employees" class="panel">
                <h3>ğŸ‘¥ å¾“æ¥­å“¡ç®¡ç†</h3>
                <div id="employeeList"></div>
                <button class="btn" data-requires-active="true" onclick="showHiring()">â• æ¡ç”¨æ´»å‹•</button>
                <button class="btn" data-requires-active="true" onclick="trainEmployees()">ğŸ“š ç ”ä¿®å®Ÿæ–½</button>
            </div>

            <div id="products" class="panel">
                <h3>ğŸ“¦ è£½å“é–‹ç™º</h3>
                <div id="productList"></div>
                <button class="btn" data-requires-active="true" onclick="developProduct()">ğŸ”§ æ–°è£½å“é–‹ç™º</button>
            </div>

            <div id="market" class="panel">
                <h3>ğŸ¢ å¸‚å ´çŠ¶æ³</h3>
                <div class="chart-container">
                    <div class="chart-title">ğŸ“Š å¸‚å ´ã‚·ã‚§ã‚¢åˆ†å¸ƒ</div>
                    <canvas id="marketChart" height="200"></canvas>
                </div>
                <div id="marketInfo"></div>
                <button class="btn" data-requires-active="true" onclick="doMarketing()">ğŸ“¢ ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°</button>
            </div>

            <div id="finance" class="panel">
                <h3>ğŸ’° è²¡å‹™çŠ¶æ³</h3>
                <div id="financeInfo"></div>
                <button class="btn" data-requires-active="true" onclick="getLoan()">ğŸ¦ éŠ€è¡Œèè³‡</button>
                <button class="btn" data-requires-active="true" onclick="repayLoan()">ğŸ’¸ èè³‡è¿”æ¸ˆ</button>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle"></div>
            <div id="modalBody"></div>
            <button class="modal-close" onclick="closeModal()">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script>
        const defaultGameState = {
            money: 10000000,
            employees: [],
            products: [],
            turn: 1,
            year: 2025,
            month: 1,
            week: 1,
            marketShare: 0.1,
            brandPower: 1,
            monthlyRevenue: 0,
            debt: 0,
            isBankrupt: false,
            revenueHistory: []
        };

        const LOAN_AMOUNT = 5000000;
        const LOAN_INTEREST_RATE = 0.02;
        const SAVE_KEY = 'businessEmpire';

        const game = cloneDefaults();
        let activePanel = 'overview';
        let revenueChart = null;
        let marketChart = null;

        const competitors = [
            { name: 'ãƒ†ãƒƒã‚¯ã‚³ãƒ¼ãƒ—', share: 35, strategy: 'aggressive', power: 100 },
            { name: 'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ¯ãƒ¼ã‚¯ã‚¹', share: 29, strategy: 'balanced', power: 85 },
            { name: 'ã‚µã‚¤ãƒãƒ¼ã‚½ãƒ•ãƒˆ', share: 22, strategy: 'defensive', power: 70 }
        ];

        const newsTemplates = [
            '${company}ãŒæ–°è£½å“ã‚’ç™ºè¡¨ï¼æ¥­ç•Œã«è¡æ’ƒ',
            '${company}ã®å£²ä¸ŠãŒ${percent}%å¢—åŠ ',
            'ITæ¥­ç•Œã®æˆé•·ç‡ãŒ${percent}%ã«',
            '${company}ãŒå¤§å‹è²·åã‚’æ¤œè¨ä¸­',
            'æ–°æŠ€è¡“ã®ç™»å ´ã§å¸‚å ´ãŒæ´»æ€§åŒ–',
            '${company}ã®CEOãŒä»Šå¾Œã®æˆ¦ç•¥ã‚’èªã‚‹',
            'ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ä¼æ¥­ã®å‚å…¥ãŒç›¸æ¬¡ã'
        ];

        function cloneDefaults() {
            return JSON.parse(JSON.stringify(defaultGameState));
        }

        function overwriteGameState(source) {
            Object.keys(game).forEach(key => delete game[key]);
            Object.assign(game, source);
        }

        function ensureCollections() {
            if (!Array.isArray(game.employees)) game.employees = [];
            if (!Array.isArray(game.products)) game.products = [];
            if (!Array.isArray(game.revenueHistory)) game.revenueHistory = [];
        }

        function normalizeGameState() {
            ensureCollections();
            game.money = Number(game.money) || 0;
            game.turn = Number(game.turn) || 1;
            game.year = Number(game.year) || 2025;
            game.month = Number(game.month) || 1;
            game.week = Number(game.week) || 1;
            game.marketShare = Number(game.marketShare) || 0;
            game.brandPower = Number(game.brandPower) || 0;
            game.monthlyRevenue = Number(game.monthlyRevenue) || 0;
            game.debt = Math.max(0, Number(game.debt) || 0);
            game.isBankrupt = Boolean(game.isBankrupt);
            game.employees.forEach(emp => {
                emp.salary = Number(emp.salary) || 0;
                if (typeof emp.abilities !== 'object' || emp.abilities === null) {
                    emp.abilities = { technical: 0, sales: 0, planning: 0, management: 0 };
                }
                Object.keys(emp.abilities).forEach(key => {
                    emp.abilities[key] = Number(emp.abilities[key]) || 0;
                });
            });
            game.products.forEach(product => {
                product.sales = Number(product.sales) || 0;
                product.quality = Number(product.quality) || 0;
            });
        }

        function resetGameState() {
            overwriteGameState(cloneDefaults());
            normalizeGameState();
            activePanel = 'overview';
        }

        function addInitialEmployee() {
            ensureCollections();
            if (game.employees.length > 0) return;
            const initialEmployee = {
                id: 1,
                name: 'å±±ç”° å¤ªéƒ',
                personality: 'ã¾ã˜ã‚',
                abilities: { technical: 65, sales: 45, planning: 55, management: 50 },
                motivation: 75,
                salary: 400000,
                department: 'é–‹ç™ºéƒ¨'
            };
            game.employees.push(initialEmployee);
        }

        function loadGameFromStorage() {
            try {
                const saved = localStorage.getItem(SAVE_KEY);
                if (!saved) return false;
                const parsed = JSON.parse(saved);
                const merged = Object.assign(cloneDefaults(), parsed);
                overwriteGameState(merged);
                normalizeGameState();
                activePanel = typeof parsed.activePanel === 'string' ? parsed.activePanel : 'overview';
                delete game.activePanel;
                return true;
            } catch (error) {
                console.error('Failed to load save data', error);
                return false;
            }
        }

        function init() {
            const loaded = loadGameFromStorage();
            if (!loaded) {
                resetGameState();
                addInitialEmployee();
            } else {
                normalizeGameState();
                if (game.employees.length === 0) addInitialEmployee();
            }
            generateNews();
            updateDisplay();
            updateRanking();
            initCharts();
            showPanel(null, activePanel);
        }

        function initCharts() {
            // å£²ä¸Šãƒãƒ£ãƒ¼ãƒˆ
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                revenueChart = new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: game.revenueHistory.map((_, i) => `${i + 1}æœˆ`),
                        datasets: [{
                            label: 'å£²ä¸Šï¼ˆä¸‡å††ï¼‰',
                            data: game.revenueHistory.map(r => r / 10000),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }

            // å¸‚å ´ã‚·ã‚§ã‚¢ãƒãƒ£ãƒ¼ãƒˆ
            const marketCtx = document.getElementById('marketChart');
            if (marketCtx) {
                updateMarketChart();
            }
        }

        function updateCharts() {
            if (revenueChart) {
                revenueChart.data.labels = game.revenueHistory.map((_, i) => `${i + 1}æœˆ`);
                revenueChart.data.datasets[0].data = game.revenueHistory.map(r => r / 10000);
                revenueChart.update();
            }

            if (activePanel === 'market') {
                updateMarketChart();
            }
        }

        function updateMarketChart() {
            const marketCtx = document.getElementById('marketChart');
            if (!marketCtx) return;

            if (marketChart) {
                marketChart.destroy();
            }

            const allCompanies = [
                ...competitors.map(c => ({ name: c.name, share: c.share })),
                { name: 'ã‚ãªãŸ', share: game.marketShare }
            ];

            marketChart = new Chart(marketCtx, {
                type: 'doughnut',
                data: {
                    labels: allCompanies.map(c => c.name),
                    datasets: [{
                        data: allCompanies.map(c => c.share),
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#f093fb',
                            '#ffd700'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function generateNews() {
            const template = newsTemplates[Math.floor(Math.random() * newsTemplates.length)];
            const company = competitors[Math.floor(Math.random() * competitors.length)].name;
            const percent = Math.floor(Math.random() * 30) + 10;
            const news = template.replace('${company}', company).replace('${percent}', percent);
            document.getElementById('newsText').textContent = 'ğŸ“° ' + news;
        }

        function updateCompetitors() {
            competitors.forEach(comp => {
                if (game.marketShare > 5) {
                    if (comp.strategy === 'aggressive') {
                        comp.power += 5;
                        generateNews();
                    }
                }
                if (comp.strategy === 'aggressive') {
                    comp.share += Math.random() * 2;
                } else if (comp.strategy === 'defensive') {
                    comp.share -= Math.random();
                }
                comp.share = Math.max(5, Math.min(60, comp.share));
                if (comp.share > 40) {
                    game.marketShare = Math.max(0.1, game.marketShare - 0.2);
                    if (game.brandPower > 1) {
                        game.brandPower--;
                    }
                }
            });
        }

        function updateRanking() {
            const allCompanies = [
                ...competitors.map(c => ({ name: c.name, share: c.share })),
                { name: 'ã‚ãªãŸ', share: game.marketShare, isPlayer: true }
            ].sort((a, b) => b.share - a.share);

            const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', '4'];
            const rankingHtml = allCompanies.slice(0, 4).map((company, index) =>
                `<div class="rank-item ${company.isPlayer ? 'player' : ''}">
                    <span class="rank-medal">${medals[index]}</span>
                    ${company.name}<br>(${company.share.toFixed(1)}%)
                </div>`
            ).join('');

            document.getElementById('rankingBar').innerHTML = rankingHtml;
        }

        function showPanel(tabButton, panelId) {
            const targetPanelId = panelId || 'overview';
            const targetTab = tabButton || document.querySelector(`.tab[data-panel="${targetPanelId}"]`);
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            if (targetTab) {
                targetTab.classList.add('active');
            }
            document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
            const panelElement = document.getElementById(targetPanelId);
            if (panelElement) {
                panelElement.classList.add('active');
            }
            activePanel = targetPanelId;
            renderActivePanel();
        }

        function renderActivePanel() {
            if (activePanel === 'employees') {
                renderEmployees();
            } else if (activePanel === 'products') {
                renderProducts();
            } else if (activePanel === 'market') {
                renderMarket();
                updateMarketChart();
            } else if (activePanel === 'finance') {
                renderFinance();
            }
        }

        function updateDisplay() {
            document.getElementById('money').textContent = `${Math.floor(game.money / 10000)}ä¸‡`;
            document.getElementById('employeeCount').textContent = game.employees.length;
            document.getElementById('revenue').textContent = `${Math.floor(game.monthlyRevenue / 10000)}ä¸‡`;
            document.getElementById('gameDate').textContent = `${game.year}å¹´${game.month}æœˆ ç¬¬${game.week}é€±`;
            document.getElementById('marketShare').textContent = `${game.marketShare.toFixed(1)}%`;
            const brandCount = Math.max(0, Math.min(5, Math.floor(game.brandPower)));
            document.getElementById('brand').textContent = brandCount > 0 ? 'â­'.repeat(brandCount) : 'â€•';

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
            const moneyPercent = Math.min(100, (game.money / 20000000) * 100);
            document.getElementById('moneyProgress').style.width = moneyPercent + '%';

            const revenuePercent = Math.min(100, (game.monthlyRevenue / 10000000) * 100);
            document.getElementById('revenueProgress').style.width = revenuePercent + '%';

            updateControls();
            updateCharts();
        }

        function updateControls() {
            const disabled = game.isBankrupt;
            document.querySelectorAll('[data-requires-active="true"]').forEach(btn => {
                btn.disabled = disabled;
            });
            const restartBtn = document.getElementById('restartButton');
            if (restartBtn) {
                restartBtn.style.display = disabled ? 'block' : 'none';
            }
        }

        function renderEmployees() {
            const list = document.getElementById('employeeList');
            if (game.employees.length === 0) {
                list.innerHTML = '<div class="empty">å¾“æ¥­å“¡ãŒã„ã¾ã›ã‚“</div>';
                return;
            }
            list.innerHTML = game.employees.map(emp => `
                <div class="employee">
                    <div class="employee-header">
                        <div class="employee-name">
                            <span class="icon-badge">ğŸ‘¤</span>
                            ${emp.name}
                        </div>
                        <span class="personality">${emp.personality}</span>
                    </div>
                    <div class="abilities">
                        <div class="ability">
                            <span class="ability-name">âš™ï¸ æŠ€è¡“: ${emp.abilities.technical}</span>
                            <div class="ability-bar">
                                <div class="ability-bar-fill" style="width: ${emp.abilities.technical}%"></div>
                            </div>
                        </div>
                        <div class="ability">
                            <span class="ability-name">ğŸ’¼ å–¶æ¥­: ${emp.abilities.sales}</span>
                            <div class="ability-bar">
                                <div class="ability-bar-fill" style="width: ${emp.abilities.sales}%"></div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 8px; color: #667eea; font-weight: 600;">ğŸ’° æœˆçµ¦: ${Math.floor(emp.salary / 10000)}ä¸‡å††</div>
                </div>
            `).join('');
        }

        function renderProducts() {
            const list = document.getElementById('productList');
            if (game.products.length === 0) {
                list.innerHTML = '<div class="empty">è£½å“ãŒã‚ã‚Šã¾ã›ã‚“<br>ğŸ’¡ æ–°è£½å“ã‚’é–‹ç™ºã—ã¾ã—ã‚‡ã†!</div>';
                return;
            }
            list.innerHTML = game.products.map(product => `
                <div class="product">
                    <div style="font-weight: bold; font-size: 16px; margin-bottom: 8px;">ğŸ“¦ ${product.name}</div>
                    <div class="product-quality">â­ å“è³ª: ${product.quality}%</div>
                    <div style="margin-top: 8px; font-weight: 600;">ğŸ’µ ç´¯è¨ˆå£²ä¸Š: ${Math.floor(product.sales / 10000)}ä¸‡å††</div>
                </div>
            `).join('');
        }

        function renderMarket() {
            const info = document.getElementById('marketInfo');
            info.innerHTML = `
                <h4 style="margin-top: 20px; margin-bottom: 12px; color: #667eea;">ğŸ† ç«¶åˆä¼æ¥­</h4>
                ${competitors.map(comp => `
                    <div class="competitor">
                        <strong style="font-size: 15px;">ğŸ¢ ${comp.name}</strong>
                        <div style="margin-top: 6px;">å¸‚å ´ã‚·ã‚§ã‚¢: <strong>${comp.share.toFixed(1)}%</strong></div>
                        <div style="margin-top: 4px; font-size: 12px; color: #666;">
                            æˆ¦ç•¥: ${comp.strategy === 'aggressive' ? 'âš”ï¸ æ”»æ’ƒçš„' :
                                   comp.strategy === 'balanced' ? 'âš–ï¸ ãƒãƒ©ãƒ³ã‚¹å‹' : 'ğŸ›¡ï¸ å®ˆå‚™çš„'}
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function renderFinance() {
            const info = document.getElementById('financeInfo');
            const salaryTotal = game.employees.reduce((sum, emp) => sum + emp.salary, 0);
            const interestPreview = game.debt > 0 ? Math.floor(game.debt * LOAN_INTEREST_RATE) : 0;
            info.innerHTML = `
                <div class="info-box">
                    <div>
                        <span>ğŸ“Š å£²ä¸Šé«˜</span>
                        <strong>${Math.floor(game.monthlyRevenue / 10000)}ä¸‡å††</strong>
                    </div>
                    <div>
                        <span>ğŸ‘¥ äººä»¶è²»</span>
                        <strong>${Math.floor(salaryTotal / 10000)}ä¸‡å††</strong>
                    </div>
                    <div style="border-top: 2px solid #667eea; padding-top: 8px; margin-top: 8px;">
                        <span>ğŸ’° ç´”åˆ©ç›Š</span>
                        <strong style="color: ${(game.monthlyRevenue - salaryTotal - interestPreview) >= 0 ? '#4caf50' : '#f44336'}">
                            ${Math.floor((game.monthlyRevenue - salaryTotal - interestPreview) / 10000)}ä¸‡å††
                        </strong>
                    </div>
                    ${game.debt ? `<div style="margin-top: 8px;">
                        <span>ğŸ¦ å€Ÿé‡‘æ®‹é«˜</span>
                        <strong style="color: #ff9800;">${Math.floor(game.debt / 10000)}ä¸‡å††</strong>
                    </div>` : ''}
                    ${interestPreview ? `<div>
                        <span>ğŸ“ˆ æ¬¡æœˆåˆ©æ¯è¦‹è¾¼</span>
                        <strong>${Math.floor(interestPreview / 10000)}ä¸‡å††</strong>
                    </div>` : ''}
                </div>
            `;
        }

        function requireCompanyActive() {
            if (!game.isBankrupt) return true;
            showModal('æ“ä½œä¸å¯', 'å€’ç”£çŠ¶æ…‹ã®ãŸã‚æ“ä½œã§ãã¾ã›ã‚“ã€‚å†ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚');
            return false;
        }

        function showHiring() {
            if (!requireCompanyActive()) return;
            if (game.money < 200000) {
                showModal('æ¡ç”¨å¤±æ•—', 'è³‡é‡‘ä¸è¶³ã§ã™ï¼ˆæœ€ä½20ä¸‡å††å¿…è¦ï¼‰');
                return;
            }
            const names = ['ä½è—¤', 'éˆ´æœ¨', 'é«˜æ©‹', 'ç”°ä¸­', 'ä¼Šè—¤', 'æ¸¡è¾º'];
            const firstNames = ['å¤ªéƒ', 'èŠ±å­', 'ä¸€éƒ', 'ç¾å’²', 'å¥å¤ª', 'å„ªå­'];
            const personalities = ['ã™ãªãŠ', 'ã¾ã˜ã‚', 'ãŠèª¿å­è€…', 'é‡å¿ƒå®¶', 'å”èª¿çš„'];

            const candidate = {
                id: Date.now(),
                name: names[Math.floor(Math.random() * names.length)] + ' ' +
                      firstNames[Math.floor(Math.random() * firstNames.length)],
                personality: personalities[Math.floor(Math.random() * personalities.length)],
                abilities: {
                    technical: 30 + Math.floor(Math.random() * 50),
                    sales: 30 + Math.floor(Math.random() * 50),
                    planning: 30 + Math.floor(Math.random() * 50),
                    management: 30 + Math.floor(Math.random() * 50)
                },
                motivation: 70,
                salary: 300000 + Math.floor(Math.random() * 200000),
                department: 'é–‹ç™ºéƒ¨'
            };

            const html = `
                <div style="margin: 12px 0;">ğŸ‘¤ å€™è£œè€…: <strong>${candidate.name}</strong></div>
                <div style="margin: 8px 0;">ğŸ­ æ€§æ ¼: <strong>${candidate.personality}</strong></div>
                <div style="margin: 8px 0;">âš™ï¸ æŠ€è¡“åŠ›: <strong>${candidate.abilities.technical}</strong></div>
                <div style="margin: 8px 0;">ğŸ’¼ å–¶æ¥­åŠ›: <strong>${candidate.abilities.sales}</strong></div>
                <div style="margin: 12px 0; padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 8px;">
                    ğŸ’° å¸Œæœ›çµ¦ä¸: <strong style="color: #667eea;">${Math.floor(candidate.salary / 10000)}ä¸‡å††/æœˆ</strong>
                </div>
                <button class="btn" onclick="hireEmployee(${JSON.stringify(candidate).replace(/"/g, '&quot;')})">âœ… æ¡ç”¨ã™ã‚‹</button>
            `;
            showModal('ğŸ“‹ æ¡ç”¨é¢æ¥', html);
        }

        function hireEmployee(candidate) {
            if (!requireCompanyActive()) return;
            if (game.money < candidate.salary * 3) {
                showModal('æ¡ç”¨å¤±æ•—', 'è³‡é‡‘ä¸è¶³ã§ã™ï¼ˆ3ãƒ¶æœˆåˆ†ã®çµ¦ä¸ãŒå¿…è¦ï¼‰');
                return;
            }
            game.money -= candidate.salary * 3;
            game.employees.push(candidate);
            updateDisplay();
            renderActivePanel();
            closeModal();
            showModal('ğŸ‰ æ¡ç”¨æˆåŠŸ', `${candidate.name}ã•ã‚“ã‚’æ¡ç”¨ã—ã¾ã—ãŸï¼`);
        }

        function trainEmployees() {
            if (!requireCompanyActive()) return;
            if (game.employees.length === 0) {
                showModal('ç ”ä¿®å¤±æ•—', 'å¾“æ¥­å“¡ãŒã„ã¾ã›ã‚“');
                return;
            }
            const cost = 300000 * game.employees.length;
            if (game.money < cost) {
                showModal('ç ”ä¿®å¤±æ•—', `è³‡é‡‘ä¸è¶³ã§ã™ï¼ˆå¿…è¦: ${cost / 10000}ä¸‡å††ï¼‰`);
                return;
            }
            game.money -= cost;
            game.employees.forEach(emp => {
                Object.keys(emp.abilities).forEach(key => {
                    emp.abilities[key] = Math.min(100, emp.abilities[key] + 10);
                });
            });
            updateDisplay();
            renderActivePanel();
            showModal('ğŸ“š ç ”ä¿®å®Œäº†', 'å¾“æ¥­å“¡ã®ã‚¹ã‚­ãƒ«ãŒå‘ä¸Šã—ã¾ã—ãŸï¼<br>ã™ã¹ã¦ã®èƒ½åŠ›ãŒ +10 ä¸ŠãŒã‚Šã¾ã—ãŸ');
        }

        function developProduct() {
            if (!requireCompanyActive()) return;
            if (game.employees.length < 2) {
                showModal('é–‹ç™ºå¤±æ•—', 'æœ€ä½2åã®å¾“æ¥­å“¡ãŒå¿…è¦ã§ã™');
                return;
            }
            if (game.money < 2000000) {
                showModal('é–‹ç™ºå¤±æ•—', 'è³‡é‡‘ä¸è¶³ã§ã™ï¼ˆ200ä¸‡å††å¿…è¦ï¼‰');
                return;
            }
            game.money -= 2000000;
            const avgTech = game.employees.reduce((sum, emp) => sum + emp.abilities.technical, 0) / game.employees.length;
            const quality = Math.min(100, Math.floor(50 + (avgTech / 2) + Math.random() * 20));
            const product = {
                id: Date.now(),
                name: `è£½å“${game.products.length + 1}`,
                quality: quality,
                sales: 0
            };
            game.products.push(product);
            updateDisplay();
            renderActivePanel();
            showModal('ğŸ”§ é–‹ç™ºæˆåŠŸ', `${product.name}ã‚’é–‹ç™ºã—ã¾ã—ãŸï¼<br>å“è³ª: ${quality}%`);
        }

        function doMarketing() {
            if (!requireCompanyActive()) return;
            if (game.money < 1000000) {
                showModal('å®Ÿæ–½å¤±æ•—', 'è³‡é‡‘ä¸è¶³ã§ã™ï¼ˆ100ä¸‡å††å¿…è¦ï¼‰');
                return;
            }
            game.money -= 1000000;
            game.marketShare = Math.min(15, game.marketShare + 0.3);
            game.brandPower = Math.min(5, game.brandPower + 1);
            updateDisplay();
            renderActivePanel();
            updateRanking();
            showModal('ğŸ“¢ ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆåŠŸ', 'å¸‚å ´ã‚·ã‚§ã‚¢ã¨ãƒ–ãƒ©ãƒ³ãƒ‰åŠ›ãŒå‘ä¸Šï¼');
        }

        function getLoan() {
            if (!requireCompanyActive()) return;
            game.money += LOAN_AMOUNT;
            game.debt += LOAN_AMOUNT;
            updateDisplay();
            renderActivePanel();
            showModal('ğŸ¦ èè³‡å®Ÿè¡Œ', `500ä¸‡å††ã®èè³‡ã‚’å—ã‘ã¾ã—ãŸ<br>åˆ©ç‡: ${(LOAN_INTEREST_RATE * 100).toFixed(1)}%/æœˆ`);
        }

        function repayLoan() {
            if (!requireCompanyActive()) return;
            if (game.debt <= 0) {
                showModal('è¿”æ¸ˆä¸è¦', 'ç¾åœ¨ã®å€Ÿå…¥ã¯ã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            const maxRepay = Math.min(game.debt, game.money);
            if (maxRepay <= 0) {
                showModal('è¿”æ¸ˆå¤±æ•—', 'è¿”æ¸ˆã«å……ã¦ã‚‹è³‡é‡‘ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            game.money -= maxRepay;
            game.debt -= maxRepay;
            updateDisplay();
            renderActivePanel();
            showModal('ğŸ’¸ è¿”æ¸ˆå®Œäº†', `${Math.floor(maxRepay / 10000)}ä¸‡å††ã‚’è¿”æ¸ˆã—ã¾ã—ãŸ`);
        }

        function nextTurn() {
            if (!requireCompanyActive()) return;
            game.turn++;
            game.week++;
            if (game.week > 4) {
                game.week = 1;
                game.month++;
                if (game.month > 12) {
                    game.month = 1;
                    game.year++;
                }
                let revenue = 0;
                game.products.forEach(product => {
                    const productRevenue = product.quality * 10000;
                    product.sales += productRevenue;
                    revenue += productRevenue;
                });
                const salaryTotal = game.employees.reduce((sum, emp) => sum + emp.salary, 0);
                const interest = game.debt > 0 ? Math.floor(game.debt * LOAN_INTEREST_RATE) : 0;
                game.monthlyRevenue = revenue;
                game.revenueHistory.push(revenue);
                const profit = revenue - salaryTotal - interest;
                game.money += profit;
                if (game.money < 0) {
                    game.isBankrupt = true;
                    updateDisplay();
                    renderActivePanel();
                    updateRanking();
                    showModal('ğŸ’” ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼', 'è³‡é‡‘ä¸è¶³ã§å€’ç”£ã—ã¾ã—ãŸ...<br>å†ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                const summaryLines = [
                    `ğŸ“Š å£²ä¸Š: ${Math.floor(revenue / 10000)}ä¸‡å††`,
                    `ğŸ‘¥ äººä»¶è²»: ${Math.floor(salaryTotal / 10000)}ä¸‡å††`
                ];
                if (interest > 0) {
                    summaryLines.push(`ğŸ“ˆ åˆ©æ¯: ${Math.floor(interest / 10000)}ä¸‡å††`);
                }
                const profitColor = profit >= 0 ? '#4caf50' : '#f44336';
                summaryLines.push(`<div style="margin-top: 8px; padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 8px;">
                    ğŸ’° æœ€çµ‚åˆ©ç›Š: <strong style="color: ${profitColor}">${Math.floor(profit / 10000)}ä¸‡å††</strong>
                </div>`);
                showModal('ğŸ“… æœˆæ¬¡æ±ºç®—', summaryLines.join('<br>'));
                updateCompetitors();
                generateNews();
            }
            updateDisplay();
            renderActivePanel();
            updateRanking();
        }

        function saveGame() {
            if (!requireCompanyActive()) return;
            try {
                const saveData = Object.assign({}, game, { activePanel });
                localStorage.setItem(SAVE_KEY, JSON.stringify(saveData));
                showModal('ğŸ’¾ ä¿å­˜å®Œäº†', 'ã‚²ãƒ¼ãƒ ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Failed to save game', error);
                showModal('ä¿å­˜å¤±æ•—', 'ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function restartGame() {
            closeModal();
            resetGameState();
            addInitialEmployee();
            updateDisplay();
            renderEmployees();
            renderProducts();
            renderMarket();
            renderFinance();
            updateRanking();
            initCharts();
            showPanel(null, 'overview');
            generateNews();
            localStorage.removeItem(SAVE_KEY);
            showModal('ğŸ”„ å†ã‚¹ã‚¿ãƒ¼ãƒˆ', 'æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¾ã—ãŸ');
        }

        function showModal(title, body) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = body.replace(/\n/g, '<br>');
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        init();
    </script>
</body>
</html>
