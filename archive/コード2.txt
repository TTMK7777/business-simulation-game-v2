<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ³ãƒ‘ã‚¤ã‚¢ - çµŒå–¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Sans', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .company-name { font-size: 22px; font-weight: bold; margin-bottom: 8px; }
        .date { font-size: 14px; opacity: 0.9; }
        .stats {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: rgba(255,255,255,0.1);
        }
        .stat { text-align: center; }
        .stat-label { font-size: 12px; opacity: 0.8; margin-bottom: 4px; }
        .stat-value { font-size: 18px; font-weight: bold; }
        
        /* ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚«ãƒ¼ */
        .news-ticker {
            background: #333;
            color: #ffd700;
            padding: 8px;
            overflow: hidden;
            white-space: nowrap;
            font-size: 12px;
        }
        .news-ticker span {
            display: inline-block;
            animation: scroll 20s linear infinite;
        }
        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        /* ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º */
        .ranking-bar {
            background: #f0f0f0;
            padding: 10px;
            display: flex;
            justify-content: space-around;
            font-size: 11px;
        }
        .rank-item {
            text-align: center;
            padding: 5px;
            border-radius: 5px;
        }
        .rank-item.player { background: #ffd700; font-weight: bold; }
        
        .tabs {
            display: flex;
            padding: 15px 15px 0;
            gap: 10px;
            overflow-x: auto;
            background: white;
        }
        .tab {
            padding: 10px 15px;
            background: #f0f0f0;
            border: none;
            border-radius: 10px 10px 0 0;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .content {
            padding: 20px;
            min-height: 400px;
            background: white;
        }
        .panel { display: none; }
        .panel.active { display: block; }
        .btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        .btn:active { transform: scale(0.98); }
        .employee {
            background: #f8f8f8;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        .employee-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .employee-name { font-weight: bold; font-size: 16px; }
        .personality {
            background: #667eea;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        .abilities {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        .ability { font-size: 13px; }
        .ability-name { color: #666; }
        .ability-value { font-weight: bold; color: #333; }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 350px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-title { font-size: 20px; font-weight: bold; margin-bottom: 15px; }
        .modal-close {
            width: 100%;
            padding: 12px;
            background: #e0e0e0;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 15px;
            cursor: pointer;
        }
        .empty { text-align: center; color: #999; padding: 40px 20px; }
        .product {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
        }
        .info-box {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        .competitor {
            background: #fff3cd;
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            border-left: 3px solid #ff9800;
        }
        
        /* å®Ÿç¸¾è¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .achievement {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            border-left: 3px solid #ffa500;
        }
        
        .achievement-unlocked {
            animation: achievementPulse 2s ease-in-out;
        }
        
        @keyframes achievementPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="company-name">æ ªå¼ä¼šç¤¾ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—</div>
            <div class="date" id="gameDate">2025å¹´1æœˆ ç¬¬1é€±</div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">ğŸ’° è³‡é‡‘</div>
                    <div class="stat-value" id="money">1000ä¸‡</div>
                </div>
                <div class="stat">
                    <div class="stat-label">ğŸ‘¥ å¾“æ¥­å“¡</div>
                    <div class="stat-value" id="employeeCount">1</div>
                </div>
                <div class="stat">
                    <div class="stat-label">ğŸ“Š å£²ä¸Š</div>
                    <div class="stat-value" id="revenue">0ä¸‡</div>
                </div>
            </div>
        </div>

        <!-- ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚«ãƒ¼ -->
        <div class="news-ticker">
            <span id="newsText">ğŸ“° ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ITæ¥­ç•Œã§æˆåŠŸã‚’ç›®æŒ‡ãã†ï¼</span>
        </div>

        <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º -->
        <div class="ranking-bar" id="rankingBar">
            <div class="rank-item">1ä½: ãƒ†ãƒƒã‚¯ã‚³ãƒ¼ãƒ—(35%)</div>
            <div class="rank-item">2ä½: ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ¯ãƒ¼ã‚¯ã‚¹(29%)</div>
            <div class="rank-item">3ä½: ã‚µã‚¤ãƒãƒ¼ã‚½ãƒ•ãƒˆ(22%)</div>
            <div class="rank-item player">4ä½: ã‚ãªãŸ(0.1%)</div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showPanel('overview')">ğŸ“Š æ¦‚è¦</button>
            <button class="tab" onclick="showPanel('employees')">ğŸ‘¥ äººäº‹</button>
            <button class="tab" onclick="showPanel('products')">ğŸ“¦ è£½å“</button>
            <button class="tab" onclick="showPanel('market')">ğŸ¢ å¸‚å ´</button>
            <button class="tab" onclick="showPanel('finance')">ğŸ’° è²¡å‹™</button>
        </div>

        <div class="content">
            <div id="overview" class="panel active">
                <h3>ğŸ¢ ä¼šç¤¾æ¦‚è¦</h3>
                <div class="info-box">
                    <div>æ¥­ç•Œ: ITãƒ»ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢</div>
                    <div>å¸‚å ´ã‚·ã‚§ã‚¢: <span id="marketShare">0.1%</span></div>
                    <div>ãƒ–ãƒ©ãƒ³ãƒ‰åŠ›: <span id="brand">â­</span></div>
                    <div>è©•åˆ¤: <span id="reputation">50</span>/100</div>
                    <div>å¸‚å ´ç’°å¢ƒ: <span id="marketTrend">å®‰å®š</span></div>
                </div>
                
                <div id="achievementsList" class="info-box" style="display: none;">
                    <h4>ğŸ† ç²å¾—å®Ÿç¸¾</h4>
                    <div id="achievements"></div>
                </div>
                
                <button class="btn" onclick="nextTurn()">â­ï¸ æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã¸</button>
                <button class="btn" onclick="saveGame()">ğŸ’¾ ã‚²ãƒ¼ãƒ ä¿å­˜</button>
                <button class="btn" onclick="showAchievements()">ğŸ† å®Ÿç¸¾ç¢ºèª</button>
            </div>

            <div id="employees" class="panel">
                <h3>ğŸ‘¥ å¾“æ¥­å“¡ç®¡ç†</h3>
                <div id="employeeList"></div>
                <button class="btn" onclick="showHiring()">â• æ¡ç”¨æ´»å‹•</button>
                <button class="btn" onclick="trainEmployees()">ğŸ“š ç ”ä¿®å®Ÿæ–½</button>
            </div>

            <div id="products" class="panel">
                <h3>ğŸ“¦ è£½å“é–‹ç™º</h3>
                <div id="productList"></div>
                <button class="btn" onclick="developProduct()">ğŸ”§ æ–°è£½å“é–‹ç™º</button>
            </div>

            <div id="market" class="panel">
                <h3>ğŸ¢ å¸‚å ´çŠ¶æ³</h3>
                <div id="marketInfo"></div>
                <button class="btn" onclick="doMarketing()">ğŸ“¢ ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°</button>
            </div>

            <div id="finance" class="panel">
                <h3>ğŸ’° è²¡å‹™çŠ¶æ³</h3>
                <div id="financeInfo"></div>
                <button class="btn" onclick="getLoan()">ğŸ¦ éŠ€è¡Œèè³‡</button>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle"></div>
            <div id="modalBody"></div>
            <button class="modal-close" onclick="closeModal()">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ï¼ˆå¼·åŒ–ç‰ˆï¼‰
        const game = {
            money: 10000000,
            employees: [],
            products: [],
            turn: 1,
            year: 2025,
            month: 1,
            week: 1,
            marketShare: 0.1,
            brandPower: 1,
            monthlyRevenue: 0,
            debt: 0,
            achievements: [],
            lastPlayerAction: null,
            reputation: 50, // 0-100
            marketTrend: 'stable', // boom, stable, recession
            eventHistory: []
        };

        // ç«¶åˆAIä¼æ¥­ï¼ˆå¼·åŒ–ç‰ˆï¼‰
        const competitors = [
            { 
                name: 'ãƒ†ãƒƒã‚¯ã‚³ãƒ¼ãƒ—', 
                share: 35, 
                strategy: 'aggressive', 
                power: 100,
                ceo: 'ç”°ä¸­ å‰›',
                aggressiveness: 0.8,
                lastAction: null,
                alertLevel: 'normal' // normal, cautious, aggressive
            },
            { 
                name: 'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ¯ãƒ¼ã‚¯ã‚¹', 
                share: 29, 
                strategy: 'balanced', 
                power: 85,
                ceo: 'éˆ´æœ¨ æ™ºå­',
                aggressiveness: 0.5,
                lastAction: null,
                alertLevel: 'normal'
            },
            { 
                name: 'ã‚µã‚¤ãƒãƒ¼ã‚½ãƒ•ãƒˆ', 
                share: 22, 
                strategy: 'defensive', 
                power: 70,
                ceo: 'å±±ç”° å­å¿—',
                aggressiveness: 0.3,
                lastAction: null,
                alertLevel: 'normal'
            }
        ];

        // ãƒ‹ãƒ¥ãƒ¼ã‚¹ç”Ÿæˆï¼ˆå¼·åŒ–ç‰ˆï¼‰
        const newsTemplates = [
            '${company}ãŒæ–°è£½å“ã‚’ç™ºè¡¨ï¼æ¥­ç•Œã«è¡æ’ƒ',
            '${company}ã®å£²ä¸ŠãŒ${percent}%å¢—åŠ ',
            'ITæ¥­ç•Œã®æˆé•·ç‡ãŒ${percent}%ã«',
            '${company}ãŒå¤§å‹è²·åã‚’æ¤œè¨ä¸­',
            'æ–°æŠ€è¡“ã®ç™»å ´ã§å¸‚å ´ãŒæ´»æ€§åŒ–',
            '${company}ã®CEOãŒä»Šå¾Œã®æˆ¦ç•¥ã‚’èªã‚‹',
            'ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ä¼æ¥­ã®å‚å…¥ãŒç›¸æ¬¡ã',
            '${company}ãŒå„ªç§€äººæã®å¼•ãæŠœãã‚’é–‹å§‹',
            '${company}ãŒä¾¡æ ¼ç«¶äº‰ã‚’ä»•æ›ã‘ã‚‹',
            '${company}ãŒå¤§è¦æ¨¡ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã‚’å±•é–‹'
        ];

        // ãƒ©ãƒ³ãƒ€ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ 
        const randomEvents = [
            {
                id: 'tech_boom',
                name: 'ğŸ¤– AIæŠ€è¡“ãƒ–ãƒ¼ãƒ åˆ°æ¥',
                description: 'ç”ŸæˆAIå¸‚å ´ãŒæ€¥æ‹¡å¤§ï¼æŠ€è¡“ç³»å¾“æ¥­å“¡ã®ä¾¡å€¤ãŒä¸Šæ˜‡',
                probability: 0.15,
                effects: { marketTrend: 'boom', techSalaryMultiplier: 1.3 },
                duration: 3
            },
            {
                id: 'economic_recession',
                name: 'ğŸ“‰ æ™¯æ°—æ¸›é€Ÿã®å…†ã—',
                description: 'ITæŠ•è³‡ã«æ…é‡ãƒ ãƒ¼ãƒ‰ã€‚å£²ä¸Šã«å½±éŸ¿ã®å¯èƒ½æ€§',
                probability: 0.1,
                effects: { marketTrend: 'recession', revenueMultiplier: 0.8 },
                duration: 4
            },
            {
                id: 'talent_war',
                name: 'ğŸ’¼ äººæäº‰å¥ªæˆ¦æ¿€åŒ–',
                description: 'å¤§æ‰‹ä¼æ¥­ãŒé«˜çµ¦ã§äººæã‚’ç‹™ã£ã¦ã„ã‚‹',
                probability: 0.2,
                effects: { poachingRisk: 0.3, hiringSalaryMultiplier: 1.2 },
                duration: 2
            },
            {
                id: 'big_contract',
                name: 'ğŸ¯ å¤§å£å¥‘ç´„ã®ãƒãƒ£ãƒ³ã‚¹',
                description: 'æ”¿åºœç³»ã®å¤§å‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¥æœ­ãŒé–‹å§‹',
                probability: 0.12,
                effects: { contractOpportunity: true },
                duration: 1
            },
            {
                id: 'tech_revolution',
                name: 'âš¡ æŠ€è¡“é©æ–°ã®æ³¢',
                description: 'æ–°æŠ€è¡“ã®ç™»å ´ã§å¸‚å ´ãŒæ´»æ€§åŒ–',
                probability: 0.08,
                effects: { innovationBonus: 1.5 },
                duration: 2
            }
        ];

        // å®Ÿç¸¾ã‚·ã‚¹ãƒ†ãƒ 
        const achievements = [
            {
                id: 'first_profit',
                name: 'ğŸ’° åˆå›é»’å­—é”æˆ',
                description: 'åˆã‚ã¦æœˆæ¬¡ã§é»’å­—ã‚’é”æˆã—ãŸ',
                condition: (game) => game.monthlyRevenue > 0 && !game.achievements.includes('first_profit'),
                reward: { money: 500000, brandPower: 1 }
            },
            {
                id: 'big_company',
                name: 'ğŸ‘¥ å¤§ä¼æ¥­ã¸ã®é“',
                description: 'å¾“æ¥­å“¡æ•°ãŒ10äººã«åˆ°é”ã—ãŸ',
                condition: (game) => game.employees.length >= 10 && !game.achievements.includes('big_company'),
                reward: { reputation: 20, brandPower: 1 }
            },
            {
                id: 'market_leader',
                name: 'ğŸ† å¸‚å ´ãƒªãƒ¼ãƒ€ãƒ¼',
                description: 'å¸‚å ´ã‚·ã‚§ã‚¢15%ä»¥ä¸Šã‚’ç²å¾—ã—ãŸ',
                condition: (game) => game.marketShare >= 15 && !game.achievements.includes('market_leader'),
                reward: { money: 2000000, reputation: 30 }
            },
            {
                id: 'debt_free',
                name: 'ğŸ’ ç„¡å€Ÿé‡‘çµŒå–¶',
                description: 'å€Ÿé‡‘ã‚’å®Œæ¸ˆã—ã¦å¥å…¨çµŒå–¶ã‚’é”æˆ',
                condition: (game) => game.debt === 0 && game.money > 5000000 && !game.achievements.includes('debt_free'),
                reward: { reputation: 25, brandPower: 2 }
            },
            {
                id: 'innovation_master',
                name: 'ğŸš€ ã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼',
                description: '5ã¤ä»¥ä¸Šã®è£½å“ã‚’é–‹ç™ºã—ãŸ',
                condition: (game) => game.products.length >= 5 && !game.achievements.includes('innovation_master'),
                reward: { money: 1000000, reputation: 15 }
            }
        ];

        // åˆæœŸåŒ–
        function init() {
            const initialEmployee = {
                id: 1,
                name: 'å±±ç”° å¤ªéƒ',
                personality: 'ã¾ã˜ã‚',
                abilities: { technical: 65, sales: 45, planning: 55, management: 50 },
                motivation: 75,
                salary: 400000,
                department: 'é–‹ç™ºéƒ¨'
            };
            game.employees.push(initialEmployee);
            updateDisplay();
            generateNews();
        }

        // ãƒ‹ãƒ¥ãƒ¼ã‚¹ç”Ÿæˆ
        function generateNews() {
            const template = newsTemplates[Math.floor(Math.random() * newsTemplates.length)];
            const company = competitors[Math.floor(Math.random() * competitors.length)].name;
            const percent = Math.floor(Math.random() * 30) + 10;
            const news = template.replace('${company}', company).replace('${percent}', percent);
            document.getElementById('newsText').textContent = 'ğŸ“° ' + news;
        }

        // å‹•çš„ç«¶åˆAIè¡Œå‹•ã‚·ã‚¹ãƒ†ãƒ 
        function updateCompetitors() {
            competitors.forEach(comp => {
                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¡Œå‹•ã«å¯¾ã™ã‚‹åå¿œ
                if (game.lastPlayerAction) {
                    reactToPlayerAction(comp, game.lastPlayerAction);
                }
                
                // è­¦æˆ’ãƒ¬ãƒ™ãƒ«ã®èª¿æ•´
                if (game.marketShare > comp.share * 0.3) {
                    comp.alertLevel = 'aggressive';
                    comp.aggressiveness = Math.min(1.0, comp.aggressiveness + 0.1);
                } else if (game.marketShare < comp.share * 0.1) {
                    comp.alertLevel = 'normal';
                    comp.aggressiveness = Math.max(0.2, comp.aggressiveness - 0.05);
                }
                
                // AIä¼æ¥­ã®ç‹¬è‡ªè¡Œå‹•
                performAIAction(comp);
                
                // ã‚·ã‚§ã‚¢å¤‰å‹•ï¼ˆæˆ¦ç•¥ã¨ãƒ‘ãƒ¯ãƒ¼ã«å¿œã˜ã¦ï¼‰
                let change = (Math.random() - 0.5) * comp.aggressiveness * 3;
                if (comp.alertLevel === 'aggressive') change *= 1.5;
                
                comp.share = Math.max(5, Math.min(60, comp.share + change));
                
                // å¸‚å ´ã‚·ã‚§ã‚¢ã®æ­£è¦åŒ–
                normalizeMarketShares();
            });
            
            game.lastPlayerAction = null;
            updateRanking();
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¡Œå‹•ã¸ã®åå¿œ
        function reactToPlayerAction(competitor, action) {
            switch(action) {
                case 'hiring':
                    if (competitor.strategy === 'aggressive' && Math.random() < 0.4) {
                        competitor.lastAction = 'counter_hiring';
                        showModal('æ¥­ç•Œãƒ‹ãƒ¥ãƒ¼ã‚¹', `${competitor.name}ã®${competitor.ceo}CEOãŒã€Œå„ªç§€ãªäººæç¢ºä¿ã‚’å¼·åŒ–ã™ã‚‹ã€ã¨ç™ºè¡¨`);
                    }
                    break;
                case 'marketing':
                    if (Math.random() < competitor.aggressiveness * 0.6) {
                        competitor.lastAction = 'counter_marketing';
                        showModal('å¸‚å ´å‹•å‘', `${competitor.name}ãŒå¤§è¦æ¨¡ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ”»å‹¢ã‚’é–‹å§‹ï¼`);
                        competitor.share += 0.5;
                    }
                    break;
                case 'product_development':
                    if (competitor.strategy !== 'defensive' && Math.random() < 0.3) {
                        competitor.lastAction = 'product_rush';
                        showModal('æŠ€è¡“ç«¶äº‰', `${competitor.name}ãŒå¯¾æŠ—è£½å“ã®é–‹ç™ºã‚’æ€¥ã„ã§ã„ã‚‹æ¨¡æ§˜`);
                    }
                    break;
            }
        }

        // AIä¼æ¥­ã®ç‹¬è‡ªè¡Œå‹•
        function performAIAction(competitor) {
            const actionChance = competitor.aggressiveness * 0.3;
            
            if (Math.random() < actionChance) {
                const actions = ['innovation', 'expansion', 'acquisition'];
                const action = actions[Math.floor(Math.random() * actions.length)];
                
                switch(action) {
                    case 'innovation':
                        competitor.power += 5;
                        showModal('ç«¶åˆå‹•å‘', `${competitor.name}ãŒé©æ–°çš„ãªæŠ€è¡“ã‚’ç™ºè¡¨ï¼`);
                        break;
                    case 'expansion':
                        competitor.share += 1;
                        showModal('å¸‚å ´æ‹¡å¤§', `${competitor.name}ãŒäº‹æ¥­ã‚’æ‹¡å¤§ä¸­`);
                        break;
                    case 'acquisition':
                        competitor.power += 10;
                        competitor.share += 2;
                        showModal('æ¥­ç•Œå†ç·¨', `${competitor.name}ãŒä»–ç¤¾ã‚’è²·åï¼`);
                        break;
                }
            }
        }

        // å¸‚å ´ã‚·ã‚§ã‚¢æ­£è¦åŒ–
        function normalizeMarketShares() {
            const totalCompetitorShare = competitors.reduce((sum, comp) => sum + comp.share, 0);
            const availableShare = 100 - game.marketShare;
            
            if (totalCompetitorShare > availableShare) {
                const ratio = availableShare / totalCompetitorShare;
                competitors.forEach(comp => {
                    comp.share *= ratio;
                });
            }
        }

        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ›´æ–°
        function updateRanking() {
            const allCompanies = [
                ...competitors.map(c => ({ name: c.name, share: c.share })),
                { name: 'ã‚ãªãŸ', share: game.marketShare, isPlayer: true }
            ].sort((a, b) => b.share - a.share);

            const rankingHtml = allCompanies.slice(0, 4).map((company, index) => 
                `<div class="rank-item ${company.isPlayer ? 'player' : ''}">
                    ${index + 1}ä½: ${company.name}(${company.share.toFixed(1)}%)
                </div>`
            ).join('');
            
            document.getElementById('rankingBar').innerHTML = rankingHtml;
        }

        // ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆ
        function showPanel(panelId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(panelId).classList.add('active');
            
            if (panelId === 'employees') renderEmployees();
            if (panelId === 'products') renderProducts();
            if (panelId === 'market') renderMarket();
            if (panelId === 'finance') renderFinance();
        }

        // è¡¨ç¤ºæ›´æ–°
        function updateDisplay() {
            document.getElementById('money').textContent = `${Math.floor(game.money / 10000)}ä¸‡`;
            document.getElementById('employeeCount').textContent = game.employees.length;
            document.getElementById('revenue').textContent = `${Math.floor(game.monthlyRevenue / 10000)}ä¸‡`;
            document.getElementById('gameDate').textContent = `${game.year}å¹´${game.month}æœˆ ç¬¬${game.week}é€±`;
            document.getElementById('marketShare').textContent = `${game.marketShare.toFixed(1)}%`;
            document.getElementById('brand').textContent = 'â­'.repeat(Math.min(5, game.brandPower));
            document.getElementById('reputation').textContent = game.reputation;
            
            // å¸‚å ´ç’°å¢ƒã®è¡¨ç¤º
            const trendText = game.marketTrend === 'boom' ? 'ğŸ“ˆ ãƒ–ãƒ¼ãƒ ' : 
                             game.marketTrend === 'recession' ? 'ğŸ“‰ ä¸æ³' : 'ğŸ“Š å®‰å®š';
            document.getElementById('marketTrend').textContent = trendText;
            
            // å®Ÿç¸¾è¡¨ç¤ºã®æ›´æ–°
            if (game.achievements.length > 0) {
                document.getElementById('achievementsList').style.display = 'block';
            }
        }

        // å®Ÿç¸¾è¡¨ç¤º
        function showAchievements() {
            if (game.achievements.length === 0) {
                showModal('ğŸ† å®Ÿç¸¾', 'å®Ÿç¸¾ãŒã¾ã è§£é™¤ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚é ‘å¼µã£ã¦çµŒå–¶ã‚’æˆåŠŸã•ã›ã¾ã—ã‚‡ã†ï¼');
                return;
            }
            
            const achievedList = achievements
                .filter(a => game.achievements.includes(a.id))
                .map(a => `<div style="margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 5px;">
                    <div style="font-weight: bold;">${a.name}</div>
                    <div style="color: #666; font-size: 14px;">${a.description}</div>
                </div>`)
                .join('');
                
            const unachievedList = achievements
                .filter(a => !game.achievements.includes(a.id))
                .map(a => `<div style="margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 5px; opacity: 0.6;">
                    <div style="font-weight: bold;">ğŸ”’ ${a.name}</div>
                    <div style="color: #999; font-size: 14px;">${a.description}</div>
                </div>`)
                .join('');
            
            showModal('ğŸ† å®Ÿç¸¾ä¸€è¦§', 
                `<div style="max-height: 300px; overflow-y: auto;">
                    <h4>âœ… ç²å¾—æ¸ˆã¿ (${game.achievements.length}/${achievements.length})</h4>
                    ${achievedList}
                    <h4 style="margin-top: 20px;">ğŸ¯ æœªç²å¾—</h4>
                    ${unachievedList}
                </div>`
            );
        }

        // å¾“æ¥­å“¡è¡¨ç¤º
        function renderEmployees() {
            const list = document.getElementById('employeeList');
            if (game.employees.length === 0) {
                list.innerHTML = '<div class="empty">å¾“æ¥­å“¡ãŒã„ã¾ã›ã‚“</div>';
                return;
            }
            list.innerHTML = game.employees.map(emp => `
                <div class="employee">
                    <div class="employee-header">
                        <div class="employee-name">${emp.name}</div>
                        <span class="personality">${emp.personality}</span>
                    </div>
                    <div class="abilities">
                        <div class="ability">
                            <span class="ability-name">æŠ€è¡“:</span>
                            <span class="ability-value">${emp.abilities.technical}</span>
                        </div>
                        <div class="ability">
                            <span class="ability-name">å–¶æ¥­:</span>
                            <span class="ability-value">${emp.abilities.sales}</span>
                        </div>
                    </div>
                    <div>æœˆçµ¦: ${Math.floor(emp.salary / 10000)}ä¸‡å††</div>
                </div>
            `).join('');
        }

        // è£½å“è¡¨ç¤º
        function renderProducts() {
            const list = document.getElementById('productList');
            if (game.products.length === 0) {
                list.innerHTML = '<div class="empty">è£½å“ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            list.innerHTML = game.products.map(product => `
                <div class="product">
                    <div style="font-weight: bold;">${product.name}</div>
                    <div>å“è³ª: ${product.quality}%</div>
                    <div>å£²ä¸Š: ${Math.floor(product.sales / 10000)}ä¸‡å††</div>
                </div>
            `).join('');
        }

        // å¸‚å ´æƒ…å ±è¡¨ç¤º
        function renderMarket() {
            const info = document.getElementById('marketInfo');
            const activeEvents = game.eventHistory.filter(e => e.remainingTurns > 0);
            
            info.innerHTML = `
                <h4>ğŸ† ç«¶åˆä¼æ¥­</h4>
                ${competitors.map(comp => `
                    <div class="competitor">
                        <strong>${comp.name}</strong>
                        <div>CEO: ${comp.ceo}</div>
                        <div>å¸‚å ´ã‚·ã‚§ã‚¢: ${comp.share.toFixed(1)}%</div>
                        <div>æˆ¦ç•¥: ${comp.strategy === 'aggressive' ? 'æ”»æ’ƒçš„' : 
                                   comp.strategy === 'balanced' ? 'ãƒãƒ©ãƒ³ã‚¹å‹' : 'å®ˆå‚™çš„'}</div>
                        <div>è­¦æˆ’åº¦: ${comp.alertLevel === 'aggressive' ? 'ğŸ”´ é«˜' : 
                                     comp.alertLevel === 'cautious' ? 'ğŸŸ¡ ä¸­' : 'ğŸŸ¢ ä½'}</div>
                    </div>
                `).join('')}
                
                ${activeEvents.length > 0 ? `
                    <h4 style="margin-top: 20px;">ğŸ“Š é€²è¡Œä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆ</h4>
                    ${activeEvents.map(event => `
                        <div class="info-box" style="background: #fff3cd; border-left: 3px solid #ff9800;">
                            <div style="font-weight: bold;">${event.name}</div>
                            <div style="font-size: 14px; color: #666;">${event.description}</div>
                            <div style="font-size: 12px; color: #999;">æ®‹ã‚Š${event.remainingTurns}ã‚¿ãƒ¼ãƒ³</div>
                        </div>
                    `).join('')}
                ` : ''}
            `;
        }

        // è²¡å‹™æƒ…å ±è¡¨ç¤º
        function renderFinance() {
            const info = document.getElementById('financeInfo');
            const salaryTotal = game.employees.reduce((sum, emp) => sum + emp.salary, 0);
            info.innerHTML = `
                <div class="info-box">
                    <div>å£²ä¸Šé«˜: ${Math.floor(game.monthlyRevenue / 10000)}ä¸‡å††</div>
                    <div>äººä»¶è²»: ${Math.floor(salaryTotal / 10000)}ä¸‡å††</div>
                    <div>ç´”åˆ©ç›Š: ${Math.floor((game.monthlyRevenue - salaryTotal) / 10000)}ä¸‡å††</div>
                    ${game.debt ? `<div>å€Ÿé‡‘: ${Math.floor(game.debt / 10000)}ä¸‡å††</div>` : ''}
                </div>
            `;
        }

        // æ¡ç”¨
        function showHiring() {
            if (game.money < 200000) {
                showModal('æ¡ç”¨å¤±æ•—', 'è³‡é‡‘ä¸è¶³ã§ã™ï¼ˆæœ€ä½20ä¸‡å††å¿…è¦ï¼‰');
                return;
            }
            const names = ['ä½è—¤', 'éˆ´æœ¨', 'é«˜æ©‹', 'ç”°ä¸­'];
            const firstNames = ['å¤ªéƒ', 'èŠ±å­', 'ä¸€éƒ', 'ç¾å’²'];
            const personalities = ['ã™ãªãŠ', 'ã¾ã˜ã‚', 'ãŠèª¿å­è€…', 'é‡å¿ƒå®¶', 'å”èª¿çš„'];
            
            const candidate = {
                id: Date.now(),
                name: names[Math.floor(Math.random() * names.length)] + ' ' + 
                      firstNames[Math.floor(Math.random() * firstNames.length)],
                personality: personalities[Math.floor(Math.random() * personalities.length)],
                abilities: {
                    technical: 30 + Math.floor(Math.random() * 50),
                    sales: 30 + Math.floor(Math.random() * 50),
                    planning: 30 + Math.floor(Math.random() * 50),
                    management: 30 + Math.floor(Math.random() * 50)
                },
                motivation: 70,
                salary: 300000 + Math.floor(Math.random() * 200000),
                department: 'é–‹ç™ºéƒ¨'
            };
            
            const html = `
                <div>å€™è£œè€…: ${candidate.name}</div>
                <div>æ€§æ ¼: ${candidate.personality}</div>
                <div>æŠ€è¡“: ${candidate.abilities.technical}</div>
                <div>å–¶æ¥­: ${candidate.abilities.sales}</div>
                <div>å¸Œæœ›çµ¦ä¸: ${Math.floor(candidate.salary / 10000)}ä¸‡å††/æœˆ</div>
                <button class="btn" onclick="hireEmployee(${JSON.stringify(candidate).replace(/"/g, '&quot;')})">æ¡ç”¨ã™ã‚‹</button>
            `;
            showModal('æ¡ç”¨é¢æ¥', html);
        }

        // æ¡ç”¨å®Ÿè¡Œ
        function hireEmployee(candidate) {
            if (game.money < candidate.salary * 3) {
                showModal('æ¡ç”¨å¤±æ•—', 'è³‡é‡‘ä¸è¶³ã§ã™');
                return;
            }
            game.money -= candidate.salary * 3;
            game.employees.push(candidate);
            game.lastPlayerAction = 'hiring'; // AIåå¿œç”¨
            updateDisplay();
            closeModal();
            showModal('æ¡ç”¨æˆåŠŸ', `${candidate.name}ã•ã‚“ã‚’æ¡ç”¨ã—ã¾ã—ãŸï¼`);
        }

        // ç ”ä¿®
        function trainEmployees() {
            if (game.employees.length === 0) {
                showModal('ç ”ä¿®å¤±æ•—', 'å¾“æ¥­å“¡ãŒã„ã¾ã›ã‚“');
                return;
            }
            const cost = 300000 * game.employees.length;
            if (game.money < cost) {
                showModal('ç ”ä¿®å¤±æ•—', `è³‡é‡‘ä¸è¶³ã§ã™ï¼ˆå¿…è¦: ${cost / 10000}ä¸‡å††ï¼‰`);
                return;
            }
            game.money -= cost;
            game.employees.forEach(emp => {
                Object.keys(emp.abilities).forEach(key => {
                    emp.abilities[key] = Math.min(100, emp.abilities[key] + 10);
                });
            });
            showModal('ç ”ä¿®å®Œäº†', 'å¾“æ¥­å“¡ã®ã‚¹ã‚­ãƒ«ãŒå‘ä¸Šã—ã¾ã—ãŸï¼');
            updateDisplay();
        }

        // è£½å“é–‹ç™º
        function developProduct() {
            if (game.employees.length < 2) {
                showModal('é–‹ç™ºå¤±æ•—', 'æœ€ä½2åã®å¾“æ¥­å“¡ãŒå¿…è¦ã§ã™');
                return;
            }
            if (game.money < 2000000) {
                showModal('é–‹ç™ºå¤±æ•—', 'è³‡é‡‘ä¸è¶³ã§ã™ï¼ˆ200ä¸‡å††å¿…è¦ï¼‰');
                return;
            }
            game.money -= 2000000;
            const product = {
                id: Date.now(),
                name: `è£½å“${game.products.length + 1}`,
                quality: 50 + Math.floor(Math.random() * 30),
                sales: 0
            };
            game.products.push(product);
            game.lastPlayerAction = 'product_development'; // AIåå¿œç”¨
            showModal('é–‹ç™ºæˆåŠŸ', `${product.name}ã‚’é–‹ç™ºã—ã¾ã—ãŸï¼`);
            updateDisplay();
        }

        // ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°
        function doMarketing() {
            if (game.money < 1000000) {
                showModal('å®Ÿæ–½å¤±æ•—', 'è³‡é‡‘ä¸è¶³ã§ã™ï¼ˆ100ä¸‡å††å¿…è¦ï¼‰');
                return;
            }
            game.money -= 1000000;
            game.marketShare = Math.min(15, game.marketShare + 0.3);
            game.brandPower = Math.min(5, game.brandPower + 1);
            game.lastPlayerAction = 'marketing'; // AIåå¿œç”¨
            showModal('ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆåŠŸ', 'å¸‚å ´ã‚·ã‚§ã‚¢ã¨ãƒ–ãƒ©ãƒ³ãƒ‰åŠ›ãŒå‘ä¸Šï¼');
            updateDisplay();
            updateRanking();
        }

        // èè³‡
        function getLoan() {
            game.money += 5000000;
            game.debt += 5500000;
            showModal('èè³‡å®Ÿè¡Œ', '500ä¸‡å††ã®èè³‡ã‚’å—ã‘ã¾ã—ãŸï¼ˆåˆ©æ¯è¾¼ã¿è¿”æ¸ˆé¡: 550ä¸‡å††ï¼‰');
            updateDisplay();
        }

        // ãƒ©ãƒ³ãƒ€ãƒ ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
        function processRandomEvents() {
            // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆåŠ¹æœã®ç¶™ç¶šæ™‚é–“ã‚’æ¸›ã‚‰ã™
            game.eventHistory = game.eventHistory.filter(event => {
                event.remainingTurns--;
                return event.remainingTurns > 0;
            });
            
            // æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºç”Ÿåˆ¤å®š
            randomEvents.forEach(eventTemplate => {
                if (Math.random() < eventTemplate.probability) {
                    const activeEvent = {
                        ...eventTemplate,
                        remainingTurns: eventTemplate.duration,
                        triggeredTurn: game.turn
                    };
                    
                    game.eventHistory.push(activeEvent);
                    
                    // ç‰¹åˆ¥ãªå‡¦ç†ãŒã‚ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ
                    if (eventTemplate.id === 'big_contract') {
                        handleBigContractEvent();
                    } else {
                        showModal(eventTemplate.name, eventTemplate.description);
                    }
                }
            });
        }

        // å¤§å£å¥‘ç´„ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†
        function handleBigContractEvent() {
            const contractValue = 5000000 + Math.random() * 10000000;
            const requirements = Math.floor(3 + Math.random() * 5);
            
            showModal('ğŸ¯ å¤§å£å¥‘ç´„ã®ãƒãƒ£ãƒ³ã‚¹', 
                `æ”¿åºœç³»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ${Math.floor(contractValue/10000)}ä¸‡å††ï¼‰ã®å…¥æœ­æ©Ÿä¼šï¼\n` +
                `å¿…è¦äººå“¡: ${requirements}åä»¥ä¸Š\n` +
                `<button class="btn" onclick="bidForContract(${contractValue}, ${requirements})">å…¥æœ­ã™ã‚‹</button>`
            );
        }

        // å¥‘ç´„å…¥æœ­
        function bidForContract(value, requiredEmployees) {
            if (game.employees.length < requiredEmployees) {
                showModal('å…¥æœ­å¤±æ•—', `äººå“¡ä¸è¶³ã§ã™ï¼ˆå¿…è¦: ${requiredEmployees}åï¼‰`);
                return;
            }
            
            const successChance = Math.min(0.8, game.employees.length / requiredEmployees * 0.4 + game.brandPower * 0.1);
            
            if (Math.random() < successChance) {
                game.money += value;
                game.reputation += 20;
                game.marketShare = Math.min(50, game.marketShare + 2);
                showModal('å¥‘ç´„ç²å¾—', `ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼${Math.floor(value/10000)}ä¸‡å††ã®å¥‘ç´„ã‚’ç²å¾—ã—ã¾ã—ãŸï¼`);
            } else {
                showModal('å…¥æœ­å¤±æ•—', 'æ®‹å¿µãªãŒã‚‰ä»–ç¤¾ãŒå¥‘ç´„ã‚’ç²å¾—ã—ã¾ã—ãŸ...');
            }
            
            closeModal();
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆåŠ¹æœã®é©ç”¨
        function applyEventEffects() {
            let revenueMultiplier = 1;
            let salaryMultiplier = 1;
            
            game.eventHistory.forEach(event => {
                if (event.effects.revenueMultiplier) {
                    revenueMultiplier *= event.effects.revenueMultiplier;
                }
                if (event.effects.techSalaryMultiplier) {
                    salaryMultiplier *= event.effects.techSalaryMultiplier;
                }
                if (event.effects.marketTrend) {
                    game.marketTrend = event.effects.marketTrend;
                }
            });
            
            return { revenueMultiplier, salaryMultiplier };
        }

        // å®Ÿç¸¾ãƒã‚§ãƒƒã‚¯
        function checkAchievements() {
            achievements.forEach(achievement => {
                if (achievement.condition(game)) {
                    game.achievements.push(achievement.id);
                    
                    // å ±é…¬ã®é©ç”¨
                    if (achievement.reward.money) {
                        game.money += achievement.reward.money;
                    }
                    if (achievement.reward.brandPower) {
                        game.brandPower = Math.min(5, game.brandPower + achievement.reward.brandPower);
                    }
                    if (achievement.reward.reputation) {
                        game.reputation = Math.min(100, game.reputation + achievement.reward.reputation);
                    }
                    
                    showModal('ğŸ† å®Ÿç¸¾è§£é™¤ï¼', 
                        `<div style="text-align: center; margin-bottom: 15px;">
                            <div style="font-size: 24px;">${achievement.name}</div>
                            <div style="color: #666; margin: 10px 0;">${achievement.description}</div>
                            <div style="color: #4CAF50; font-weight: bold;">å ±é…¬ã‚’ç²å¾—ã—ã¾ã—ãŸï¼</div>
                        </div>`
                    );
                }
            });
        }

        // ã‚¿ãƒ¼ãƒ³é€²è¡Œï¼ˆå¼·åŒ–ç‰ˆï¼‰
        function nextTurn() {
            game.turn++;
            game.week++;
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
            processRandomEvents();
            
            if (game.week > 4) {
                game.week = 1;
                game.month++;
                if (game.month > 12) {
                    game.month = 1;
                    game.year++;
                }
                
                // æœˆæ¬¡å‡¦ç†
                const effects = applyEventEffects();
                const baseRevenue = game.products.reduce((sum, p) => sum + (p.quality * 10000), 0);
                const revenue = baseRevenue * effects.revenueMultiplier;
                const baseCosts = game.employees.reduce((sum, emp) => sum + emp.salary, 0);
                const costs = baseCosts * effects.salaryMultiplier;
                
                game.monthlyRevenue = revenue;
                game.money += revenue - costs;
                
                // å®Ÿç¸¾ãƒã‚§ãƒƒã‚¯
                checkAchievements();
                
                if (game.money < 0) {
                    showModal('ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼', 'è³‡é‡‘ä¸è¶³ã§å€’ç”£ã—ã¾ã—ãŸ...');
                    return;
                }
                
                // ç«¶åˆAIæ›´æ–°
                updateCompetitors();
                generateNews();
                
                let statusMessage = `å£²ä¸Š: ${Math.floor(revenue/10000)}ä¸‡å††\nçµŒè²»: ${Math.floor(costs/10000)}ä¸‡å††\nåˆ©ç›Š: ${Math.floor((revenue-costs)/10000)}ä¸‡å††`;
                
                // ã‚¤ãƒ™ãƒ³ãƒˆåŠ¹æœã®è¡¨ç¤º
                if (effects.revenueMultiplier !== 1) {
                    statusMessage += `\n\nğŸ“Š å¸‚å ´ç’°å¢ƒ: ${game.marketTrend === 'boom' ? 'ãƒ–ãƒ¼ãƒ ' : game.marketTrend === 'recession' ? 'ä¸æ³' : 'å®‰å®š'}`;
                }
                
                showModal('æœˆæ¬¡æ±ºç®—', statusMessage);
            }
            updateDisplay();
        }

        // ã‚»ãƒ¼ãƒ–
        function saveGame() {
            localStorage.setItem('businessEmpire', JSON.stringify(game));
            showModal('ä¿å­˜å®Œäº†', 'ã‚²ãƒ¼ãƒ ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«
        function showModal(title, body) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = body.replace(/\n/g, '<br>');
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        init();
    </script>
</body>
</html>