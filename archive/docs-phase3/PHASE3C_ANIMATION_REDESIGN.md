# Phase 3C: ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ å†è¨­è¨ˆ
**ãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ³ãƒ‘ã‚¤ã‚¢ 2.0 - RimWorld/ã‚«ã‚¤ãƒ­ã‚½ãƒ•ãƒˆå“è³ªã¸ã®é€²åŒ–**

**ä½œæˆæ—¥**: 2025-10-28
**ç›®æ¨™**: ç¾åœ¨ã®ä½å“è³ªãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ãƒ«ç”Ÿæˆã‚’ã€åä½œ2Dã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ ç´šã®é«˜å“è³ªã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã«åˆ·æ–°

---

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›®æ¨™

### ç¾çŠ¶ã®å•é¡Œç‚¹
- âŒ Canvas APIï¼ˆçŸ©å½¢ãƒ»å††ãƒ»ç·šï¼‰ã®ã¿ã®æŠ½è±¡çš„ãªè¡¨ç¾
- âŒ å˜ç´”ãªä½ç½®ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆYÂ±2pxï¼‰ã§ã€Œå‹•ã„ã¦ã„ã‚‹æ„Ÿã€ãŒãªã„
- âŒ 48x48pxã®è§£åƒåº¦ã§ãƒ‡ã‚£ãƒ†ãƒ¼ãƒ«ä¸è¶³
- âŒ è·ç¨®ã®è¦–è¦šçš„å·®åˆ¥åŒ–ãŒå¼±ã„ï¼ˆè‰²ã¨ã‚¢ã‚¤ã‚³ãƒ³ã®ã¿ï¼‰
- âŒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒãªã„æ–¹ãŒãƒã‚·ãªãƒ¬ãƒ™ãƒ«ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ‘˜ï¼‰

### é”æˆç›®æ¨™
- âœ… **RimWorldç´šã®è¦–è¦šçš„æ˜ç­æ€§**: é ç›®ã§ã‚‚è·ç¨®ãŒä¸€ç›®ã§åˆ†ã‹ã‚‹
- âœ… **ã‚«ã‚¤ãƒ­ã‚½ãƒ•ãƒˆç´šã®è¦ªã—ã¿ã‚„ã™ã•**: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã«æ„›ç€ãŒæ¹§ããƒ‡ã‚¶ã‚¤ãƒ³
- âœ… **æ»‘ã‚‰ã‹ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ•ãƒ¬ãƒ¼ãƒ è£œé–“ã¨ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³
- âœ… **è±Šå¯Œãªãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³**: æ€§åˆ¥ãƒ»å¹´é½¢ãƒ»è¡¨æƒ…ãƒ»æœè£…ã®å¤šæ§˜æ€§

---

## ğŸ“Š RimWorldæŠ€è¡“åˆ†æã‹ã‚‰å­¦ã‚“ã ã“ã¨

### 1. **ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ **
**RimWorldã®å®Ÿè£…**:
```
ãƒ¬ã‚¤ãƒ¤ãƒ¼é †ï¼ˆå¾Œã‚ã‹ã‚‰å‰ï¼‰ï¼š
1. ãƒ™ãƒ¼ã‚¹ãƒœãƒ‡ã‚£ï¼ˆè£¸ä½“ãƒ»è‚Œè‰²ï¼‰
2. ä¸‹ç€ãƒ»ä¸‹è¡£
3. ä¸Šè¡£ï¼ˆã‚·ãƒ£ãƒ„ãƒ»ã‚¸ãƒ£ã‚±ãƒƒãƒˆï¼‰
4. ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ï¼ˆãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç­‰ï¼‰
5. è£…å‚™ãƒ»æŒã¡ç‰©
6. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆæ±—ãƒ»ã‚­ãƒ©ã‚­ãƒ©ç­‰ï¼‰
```

**æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®é©ç”¨**:
- æ—¢å­˜ã®5ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã‚’ç¶­æŒ
- ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ãƒ«ç”Ÿæˆ â†’ **AIç”Ÿæˆã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚·ãƒ¼ãƒˆ**ã«ç½®ãæ›ãˆ
- å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç‹¬ç«‹ã—ãŸç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ç®¡ç†

### 2. **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³**
**RimWorldã®å®Ÿè£…**:
```typescript
enum AnimationState {
  IDLE,          // å¾…æ©Ÿï¼ˆä½“é‡ç§»å‹•ãƒ»ã¾ã°ãŸãï¼‰
  LOCOMOTION,    // ç§»å‹•ï¼ˆæ­©è¡Œãƒ»èµ°è¡Œï¼‰
  ACTION,        // ä½œæ¥­ï¼ˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°ãƒ»é€šè©±ç­‰ï¼‰
  SOCIAL,        // ä¼šè©±ãƒ»äº¤æµ
  EMOTIONAL      // æ„Ÿæƒ…è¡¨ç¾ï¼ˆå–œã³ãƒ»ã‚¹ãƒˆãƒ¬ã‚¹ï¼‰
}
```

**æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®é©ç”¨**:
```typescript
// å„è·ç¨®ã”ã¨ã«å°‚ç”¨ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
const JOB_ACTIONS = {
  developer: 'typing',      // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°å‹•ä½œ
  sales: 'phone_call',      // é›»è©±å–¶æ¥­
  marketing: 'presenting',  // ãƒ—ãƒ¬ã‚¼ãƒ³å‹•ä½œ
  manager: 'reviewing'      // æ›¸é¡ç¢ºèª
};
```

### 3. **ãƒ•ãƒ¬ãƒ¼ãƒ è£œé–“ã¨ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°**
**RimWorldã®æŠ€è¡“**:
- ã‚µãƒ–ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ï¼ˆå°æ•°ç‚¹ç²¾åº¦ï¼‰ã§æ»‘ã‚‰ã‹ãªç§»å‹•
- ã‚¤ãƒ¼ã‚¸ãƒ³ã‚°é–¢æ•°ã§è‡ªç„¶ãªåŠ é€Ÿãƒ»æ¸›é€Ÿ
- ã‚¹ãƒ†ãƒ¼ãƒˆé·ç§»æ™‚ã®ãƒ–ãƒ¬ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

**æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®é©ç”¨**:
```typescript
// Phaser 3ã®Tweenã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨
this.scene.tweens.add({
  targets: sprite,
  x: targetX,
  y: targetY,
  duration: 500,
  ease: 'Sine.easeInOut'  // è‡ªç„¶ãªåŠ é€Ÿåº¦
});
```

### 4. **æ·±åº¦ã‚½ãƒ¼ãƒˆã¨Z-ordering**
**RimWorldã®æ–¹å¼**:
- Yåº§æ¨™ãŒå¤§ãã„ï¼ˆç”»é¢ä¸‹éƒ¨ï¼‰â†’ æ‰‹å‰ã«è¡¨ç¤º
- åŒã˜Yåº§æ¨™ã®å ´åˆã¯Xåº§æ¨™ã§æ¯”è¼ƒ

**æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®é©ç”¨**:
```typescript
// Phaserã®depthãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‹•çš„ã«æ›´æ–°
sprite.depth = sprite.y;  // Yåº§æ¨™ = æç”»æ·±åº¦
```

---

## ğŸ¨ 2Dã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. **å¼·ã„ã‚­ãƒ¼ãƒãƒ¼ã‚ºï¼ˆClear Silhouettesï¼‰**
**ã‚«ã‚¤ãƒ­ã‚½ãƒ•ãƒˆã®æ‰‹æ³•**:
- å„è·ç¨®ã®ç‰¹å¾´çš„ãªãƒãƒ¼ã‚ºã‚’å¼·èª¿
- ã‚·ãƒ«ã‚¨ãƒƒãƒˆã ã‘ã§è·ç¨®ãŒè­˜åˆ¥å¯èƒ½

**å®Ÿè£…æ–¹é‡**:
| è·ç¨® | ã‚­ãƒ¼ãƒãƒ¼ã‚º | ç‰¹å¾´çš„ãªè¦ç´  |
|------|----------|-------------|
| é–‹ç™ºè€… | å‰å‚¾å§¿å‹¢ãƒ»ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã«æ‰‹ | ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³ãƒ»ãƒ•ãƒ¼ãƒ‡ã‚£ |
| å–¶æ¥­ | ç›´ç«‹ãƒ»é›»è©±ã‚’è€³ã«å½“ã¦ã‚‹ | ã‚¹ãƒ¼ãƒ„ãƒ»ãƒã‚¯ã‚¿ã‚¤ãƒ»ãƒ–ãƒªãƒ¼ãƒ•ã‚±ãƒ¼ã‚¹ |
| ä¼ç”» | ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç¢ºèªå§¿å‹¢ | ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¸ãƒ£ã‚±ãƒƒãƒˆãƒ»è³‡æ–™ |
| ç®¡ç† | è…•çµ„ã¿ãƒ»æ›¸é¡ç¢ºèª | ãƒ•ã‚©ãƒ¼ãƒãƒ«ã‚¹ãƒ¼ãƒ„ãƒ»è…•æ™‚è¨ˆ |

### 2. **ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆç”Ÿãç”Ÿãã¨ã—ãŸå‹•ãï¼‰**
**Prison Architect/RimWorldã®æ‰‹æ³•**:
- é«ªã®æºã‚Œ
- æœã®è£¾ã®å‹•ã
- ã¾ã°ãŸããƒ»ä½“é‡ç§»å‹•

**å®Ÿè£…æ–¹é‡**:
- IDLEçŠ¶æ…‹ï¼š2ç§’ã”ã¨ã«å¾®å¦™ãªä½“é‡ç§»å‹•
- ç§»å‹•æ™‚ï¼šé«ªãƒ»æœãŒé€²è¡Œæ–¹å‘ã«æºã‚Œã‚‹
- ä½œæ¥­ä¸­ï¼šå‘¨æœŸçš„ãªæ‰‹ã®å‹•ãï¼ˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°ãƒ»ãƒšãƒ¼ã‚¸ã‚ãã‚Šç­‰ï¼‰

### 3. **è¦–è¦šçš„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ†ãƒªãƒ³ã‚°**
**ã‚«ã‚¤ãƒ­ã‚½ãƒ•ãƒˆã®æ‰‹æ³•**:
- è‰²ãƒ»ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ãƒ»è¡¨æƒ…ã§æ€§æ ¼ã‚’è¡¨ç¾
- è³‡æ ¼ãƒ»çµŒé¨“ãŒè¦‹ãŸç›®ã«åæ˜ 

**å®Ÿè£…æ–¹é‡**:
```typescript
// è³‡æ ¼ä¿æœ‰è€…ã¯ç‰¹åˆ¥ãªãƒãƒƒã‚¸è¡¨ç¤º
if (employee.qualification) {
  sprite.addChild(qualificationBadge);
}

// ã‚¹ãƒˆãƒ¬ã‚¹ãƒ¬ãƒ™ãƒ«ã§è¡¨æƒ…å¤‰åŒ–
if (employee.stress > 80) {
  sprite.setTexture('face_tired');
}
```

---

## ğŸ› ï¸ æŠ€è¡“è¨­è¨ˆä»•æ§˜

### ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚·ãƒ¼ãƒˆæ§‹æˆ

#### **è§£åƒåº¦ã¨ãƒ•ãƒ¬ãƒ¼ãƒ æ•°**
```
ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚µã‚¤ã‚º: 64x64pxï¼ˆ48x48pxã‹ã‚‰æ‹¡å¤§ï¼‰
ç†ç”±: ãƒ‡ã‚£ãƒ†ãƒ¼ãƒ«è¡¨ç¾åŠ›1.7å€ã€ãƒ¢ãƒ€ãƒ³ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤å¯¾å¿œ

ãƒ•ãƒ¬ãƒ¼ãƒ æ•°:
- IDLE: 4ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆ2ç§’ãƒ«ãƒ¼ãƒ—ã€0.5ç§’/ãƒ•ãƒ¬ãƒ¼ãƒ ï¼‰
- WALK: 8ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆ1ç§’ãƒ«ãƒ¼ãƒ—ã€0.125ç§’/ãƒ•ãƒ¬ãƒ¼ãƒ ï¼‰
- ACTION: 6ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆ1.5ç§’ãƒ«ãƒ¼ãƒ—ã€0.25ç§’/ãƒ•ãƒ¬ãƒ¼ãƒ ï¼‰
```

#### **æ–¹å‘æ€§**
```
4æ–¹å‘å¯¾å¿œ: North, East, South, West
- East/Westã¯å·¦å³åè»¢ã§å¯¾å¿œï¼ˆãƒ¡ãƒ¢ãƒªç¯€ç´„ï¼‰
- åˆè¨ˆ: (4+8+6) Ã— 3æ–¹å‘ = 54ãƒ•ãƒ¬ãƒ¼ãƒ /è·ç¨®
```

#### **ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ**
```
å„è·ç¨®ã”ã¨ã«ä»¥ä¸‹ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼:
1. body_base.png      - ä½“ãƒ»é ­ãƒ»è‚Œï¼ˆå…±é€šï¼‰
2. hair_[style].png   - é«ªå‹ï¼ˆ5ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ Ã— æ€§åˆ¥ï¼‰
3. clothing_lower.png - ä¸‹è¡£ï¼ˆè·ç¨®åˆ¥ï¼‰
4. clothing_upper.png - ä¸Šè¡£ï¼ˆè·ç¨®åˆ¥ï¼‰
5. accessory.png      - ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ï¼ˆè·ç¨®åˆ¥ï¼‰
6. badge.png          - è·ç¨®ãƒãƒƒã‚¸

ã‚ªãƒ—ã‚·ãƒ§ãƒ³:
- face_[emotion].png - è¡¨æƒ…ï¼ˆç¬‘é¡”ãƒ»ç–²åŠ´ãƒ»é›†ä¸­ï¼‰
- effect_[type].png  - ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆæ±—ãƒ»ã‚­ãƒ©ã‚­ãƒ©ï¼‰
```

---

## ğŸ¤– AIç”Ÿæˆã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã®ä½œæˆè¨ˆç”»

### Phase 1: ãƒ„ãƒ¼ãƒ«é¸å®šã¨ãƒ†ã‚¹ãƒˆç”Ÿæˆï¼ˆ30åˆ†ï¼‰

#### **å€™è£œãƒ„ãƒ¼ãƒ«æ¯”è¼ƒ**
| ãƒ„ãƒ¼ãƒ« | å“è³ª | é€Ÿåº¦ | ã‚³ã‚¹ãƒˆ | ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆå¯¾å¿œ | æ¨å¥¨åº¦ |
|--------|------|------|--------|-------------------|--------|
| **Pixela AI** | â­â­â­â­â­ | é€Ÿã„ | $20/æœˆ | âœ… ç‰¹åŒ– | â˜…â˜…â˜…â˜…â˜… |
| **MageSpace** | â­â­â­â­ | æ™®é€š | ç„¡æ–™ï½ | âœ… å¯¾å¿œ | â˜…â˜…â˜…â˜… |
| **Stable Diffusion + LoRA** | â­â­â­â­â­ | é…ã„ | ç„¡æ–™ | âš ï¸ è¦èª¿æ•´ | â˜…â˜…â˜… |
| **Aseprite + æ‰‹æã** | â­â­â­â­â­ | æ¥µé… | ç„¡æ–™ | âœ… æœ€é© | â˜…â˜… |

**æ¨å¥¨**: **Pixela AI**ï¼ˆã‚²ãƒ¼ãƒ ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆç‰¹åŒ–ã€å“è³ªã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã®ãƒãƒ©ãƒ³ã‚¹æœ€é«˜ï¼‰

#### **ãƒ†ã‚¹ãƒˆç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆé–‹ç™ºè€…ï¼‰**
```
Prompt:
"pixel art game sprite sheet, 64x64 pixels,
business game character, software developer,
young adult male, casual blue hoodie, headphones,
sitting at desk typing on laptop,
4 frame idle animation + 8 frame walk cycle + 6 frame typing animation,
top-down 45-degree angle view,
clean pixel art style, transparent background PNG,
color palette: #4A90E2 blue theme"

Negative prompt:
"blurry, realistic, 3D, photo, complex background,
multiple characters, text, watermark"
```

### Phase 2: å…¨è·ç¨®ãƒãƒƒãƒç”Ÿæˆï¼ˆ2-3æ™‚é–“ï¼‰

#### **ç”Ÿæˆãƒãƒˆãƒªã‚¯ã‚¹**
```
4è·ç¨® Ã— 2æ€§åˆ¥ Ã— 5ãƒ¬ã‚¤ãƒ¤ãƒ¼ Ã— 3ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ = 120ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚·ãƒ¼ãƒˆ

å†…è¨³:
- é–‹ç™ºè€…ï¼ˆç”·å¥³ï¼‰: å„10ã‚·ãƒ¼ãƒˆ
- å–¶æ¥­ï¼ˆç”·å¥³ï¼‰: å„10ã‚·ãƒ¼ãƒˆ
- ä¼ç”»ï¼ˆç”·å¥³ï¼‰: å„10ã‚·ãƒ¼ãƒˆ
- ç®¡ç†ï¼ˆç”·å¥³ï¼‰: å„10ã‚·ãƒ¼ãƒˆ
```

#### **ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡**
```
{job}_{gender}_{layer}_{animation}_{direction}.png

ä¾‹:
developer_male_body_idle_south.png
developer_male_clothing_walk_east.png
sales_female_accessory_action_north.png
```

### Phase 3: å¾Œå‡¦ç†ã¨æœ€é©åŒ–ï¼ˆ1æ™‚é–“ï¼‰

#### **å“è³ªãƒã‚§ãƒƒã‚¯**
- [ ] å…¨ãƒ•ãƒ¬ãƒ¼ãƒ ã®æ•´åˆæ€§ç¢ºèªï¼ˆä½ç½®ãšã‚Œãƒ»ã‚µã‚¤ã‚ºé•ã„ï¼‰
- [ ] é€éèƒŒæ™¯ã®å®Œå…¨æ€§ç¢ºèª
- [ ] è‰²å‘³ã®çµ±ä¸€æ€§ç¢ºèª

#### **æœ€é©åŒ–å‡¦ç†**
```bash
# PNGCrushã§åœ§ç¸®ï¼ˆå“è³ªåŠ£åŒ–ãªã—ï¼‰
pngcrush -brute input.png output.png

# ä¸€æ‹¬å‡¦ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
for file in assets/sprites/*.png; do
  pngcrush -brute "$file" "optimized/${file##*/}"
done
```

---

## ğŸ’» å®Ÿè£…è¨ˆç”»

### Step 1: ã‚¢ã‚»ãƒƒãƒˆãƒ­ãƒ¼ãƒ€ãƒ¼ã®å®Ÿè£…ï¼ˆ1æ™‚é–“ï¼‰

```typescript
// src/lib/animation/SpriteLoader.ts

export class SpriteLoader {
  private scene: Phaser.Scene;
  private loadedSprites: Map<string, boolean> = new Map();

  constructor(scene: Phaser.Scene) {
    this.scene = scene;
  }

  /**
   * å…¨è·ç¨®ã®ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚·ãƒ¼ãƒˆã‚’äº‹å‰ãƒ­ãƒ¼ãƒ‰
   */
  preloadAllSprites(): void {
    const jobs = ['developer', 'sales', 'marketing', 'manager'];
    const genders = ['male', 'female'];
    const layers = ['body', 'hair', 'clothing_lower', 'clothing_upper', 'accessory', 'badge'];
    const animations = ['idle', 'walk', 'action'];
    const directions = ['north', 'south', 'east'];

    jobs.forEach(job => {
      genders.forEach(gender => {
        layers.forEach(layer => {
          animations.forEach(anim => {
            directions.forEach(dir => {
              const key = `${job}_${gender}_${layer}_${anim}_${dir}`;
              const path = `assets/sprites/${job}/${key}.png`;

              this.scene.load.spritesheet(key, path, {
                frameWidth: 64,
                frameHeight: 64
              });
            });
          });
        });
      });
    });
  }

  /**
   * å‹•çš„ã«ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚’ãƒ­ãƒ¼ãƒ‰ï¼ˆé…å»¶ãƒ­ãƒ¼ãƒ‰ï¼‰
   */
  async loadSpriteOnDemand(
    job: string,
    gender: string,
    layer: string,
    animation: string,
    direction: string
  ): Promise<void> {
    const key = `${job}_${gender}_${layer}_${animation}_${direction}`;

    if (this.loadedSprites.has(key)) {
      return; // æ—¢ã«ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿
    }

    return new Promise((resolve, reject) => {
      const path = `assets/sprites/${job}/${key}.png`;

      this.scene.load.spritesheet(key, path, {
        frameWidth: 64,
        frameHeight: 64
      });

      this.scene.load.once('complete', () => {
        this.loadedSprites.set(key, true);
        resolve();
      });

      this.scene.load.once('loaderror', () => {
        console.error(`Failed to load sprite: ${key}`);
        reject(new Error(`Sprite load failed: ${key}`));
      });

      this.scene.load.start();
    });
  }
}
```

### Step 2: ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆ1.5æ™‚é–“ï¼‰

```typescript
// src/lib/animation/LayeredCharacter.ts

export class LayeredCharacter {
  private scene: Phaser.Scene;
  private container: Phaser.GameObjects.Container;
  private layers: Map<string, Phaser.GameObjects.Sprite> = new Map();
  private currentState: AnimationState = AnimationState.IDLE;
  private currentDirection: Direction = Direction.SOUTH;

  constructor(scene: Phaser.Scene, x: number, y: number, config: CharacterConfig) {
    this.scene = scene;
    this.container = scene.add.container(x, y);

    this.buildLayers(config);
    this.setupAnimations(config);
  }

  /**
   * ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é †ç•ªã«æ§‹ç¯‰
   */
  private buildLayers(config: CharacterConfig): void {
    const layerOrder = [
      'body',
      'clothing_lower',
      'clothing_upper',
      'hair',
      'accessory',
      'badge'
    ];

    layerOrder.forEach((layerName, index) => {
      const spriteKey = this.getSpriteKey(
        config.job,
        config.gender,
        layerName,
        this.currentState,
        this.currentDirection
      );

      const sprite = this.scene.add.sprite(0, 0, spriteKey);
      sprite.setDepth(index); // ãƒ¬ã‚¤ãƒ¤ãƒ¼é †ã‚’ä¿è¨¼

      this.layers.set(layerName, sprite);
      this.container.add(sprite);
    });

    // ã‚³ãƒ³ãƒ†ãƒŠå…¨ä½“ã®depthã‚’Yåº§æ¨™ã«é€£å‹•
    this.container.depth = y;
  }

  /**
   * å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
   */
  private setupAnimations(config: CharacterConfig): void {
    const states = ['idle', 'walk', 'action'];
    const directions = ['north', 'south', 'east', 'west'];

    states.forEach(state => {
      directions.forEach(dir => {
        const animKey = `${config.job}_${state}_${dir}`;

        if (!this.scene.anims.exists(animKey)) {
          this.scene.anims.create({
            key: animKey,
            frames: this.scene.anims.generateFrameNumbers(
              this.getSpriteKey(config.job, config.gender, 'body', state, dir),
              { start: 0, end: this.getFrameCount(state) - 1 }
            ),
            frameRate: this.getFrameRate(state),
            repeat: -1  // ç„¡é™ãƒ«ãƒ¼ãƒ—
          });
        }
      });
    });
  }

  /**
   * ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¤‰æ›´ï¼ˆå…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼åŒæœŸï¼‰
   */
  changeState(newState: AnimationState, direction?: Direction): void {
    if (direction) {
      this.currentDirection = direction;
    }

    this.currentState = newState;

    // å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åŒæœŸå†ç”Ÿ
    this.layers.forEach((sprite, layerName) => {
      const animKey = `${this.config.job}_${newState}_${this.currentDirection}`;
      sprite.play(animKey, true);
    });
  }

  /**
   * ä½ç½®ã‚’æ›´æ–°ï¼ˆTweenã§æ»‘ã‚‰ã‹ç§»å‹•ï¼‰
   */
  moveTo(targetX: number, targetY: number, duration: number = 500): void {
    this.changeState(AnimationState.WALK, this.getDirectionTo(targetX, targetY));

    this.scene.tweens.add({
      targets: this.container,
      x: targetX,
      y: targetY,
      duration: duration,
      ease: 'Sine.easeInOut',
      onUpdate: () => {
        // ç§»å‹•ä¸­ã‚‚æ·±åº¦ã‚’æ›´æ–°
        this.container.depth = this.container.y;
      },
      onComplete: () => {
        this.changeState(AnimationState.IDLE);
      }
    });
  }

  /**
   * ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåº§æ¨™ã¸ã®æ–¹å‘ã‚’è¨ˆç®—
   */
  private getDirectionTo(targetX: number, targetY: number): Direction {
    const dx = targetX - this.container.x;
    const dy = targetY - this.container.y;

    if (Math.abs(dx) > Math.abs(dy)) {
      return dx > 0 ? Direction.EAST : Direction.WEST;
    } else {
      return dy > 0 ? Direction.SOUTH : Direction.NORTH;
    }
  }

  /**
   * è¡¨æƒ…ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å‹•çš„ã«å¤‰æ›´
   */
  setEmotion(emotion: 'happy' | 'tired' | 'focused' | 'stressed'): void {
    const faceLayer = this.layers.get('face');
    if (faceLayer) {
      faceLayer.setTexture(`face_${emotion}`);
    }
  }

  /**
   * ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ï¼ˆæ±—ãƒ»ã‚­ãƒ©ã‚­ãƒ©ç­‰ï¼‰
   */
  addEffect(effectType: 'sweat' | 'sparkle' | 'zzz'): void {
    const effect = this.scene.add.sprite(0, -20, `effect_${effectType}`);
    effect.play(`effect_${effectType}_anim`);

    this.container.add(effect);

    // 3ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
    this.scene.time.delayedCall(3000, () => {
      effect.destroy();
    });
  }

  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¡ã‚½ãƒƒãƒ‰
  private getSpriteKey(...args: string[]): string {
    return args.join('_');
  }

  private getFrameCount(state: string): number {
    const counts = { idle: 4, walk: 8, action: 6 };
    return counts[state] || 4;
  }

  private getFrameRate(state: string): number {
    const rates = { idle: 2, walk: 8, action: 4 };
    return rates[state] || 4;
  }

  // å…¬é–‹API
  destroy(): void {
    this.container.destroy(true);
  }

  setPosition(x: number, y: number): void {
    this.container.setPosition(x, y);
    this.container.depth = y;
  }

  getPosition(): { x: number; y: number } {
    return { x: this.container.x, y: this.container.y };
  }
}

// å‹å®šç¾©
enum AnimationState {
  IDLE = 'idle',
  WALK = 'walk',
  ACTION = 'action'
}

enum Direction {
  NORTH = 'north',
  SOUTH = 'south',
  EAST = 'east',
  WEST = 'west'
}

interface CharacterConfig {
  job: 'developer' | 'sales' | 'marketing' | 'manager';
  gender: 'male' | 'female';
  skinTone?: number;  // 0-4
  hairStyle?: number; // 0-4
}
```

### Step 3: ã‚²ãƒ¼ãƒ ã¸ã®çµ±åˆï¼ˆ1æ™‚é–“ï¼‰

```typescript
// src/lib/game.ts ã«çµ±åˆ

import { LayeredCharacter } from './animation/LayeredCharacter';
import { SpriteLoader } from './animation/SpriteLoader';

// åˆæœŸåŒ–æ™‚
const spriteLoader = new SpriteLoader(phaserScene);
spriteLoader.preloadAllSprites();

// å¾“æ¥­å“¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆç”Ÿæˆ
function createEmployeeSprite(employee: Employee): LayeredCharacter {
  const config: CharacterConfig = {
    job: determineJobType(employee),
    gender: employee.gender || 'male',
    skinTone: employee.skinTone || 0,
    hairStyle: employee.hairStyle || 0
  };

  const sprite = new LayeredCharacter(
    phaserScene,
    100 + Math.random() * 600,
    100 + Math.random() * 300,
    config
  );

  return sprite;
}

// æ—¢å­˜ã®syncAllEmployeeSprites()ã‚’ç½®ãæ›ãˆ
function syncAllEmployeeSprites(): void {
  game.employees.forEach((employee, index) => {
    if (!employee.sprite) {
      employee.sprite = createEmployeeSprite(employee);
    }

    // ã‚¹ãƒˆãƒ¬ã‚¹ãƒ¬ãƒ™ãƒ«ã§è¡¨æƒ…å¤‰åŒ–
    if (employee.stress > 80) {
      employee.sprite.setEmotion('stressed');
      employee.sprite.addEffect('sweat');
    } else if (employee.motivation > 90) {
      employee.sprite.setEmotion('happy');
      employee.sprite.addEffect('sparkle');
    }

    // å®šæœŸçš„ã«ãƒ©ãƒ³ãƒ€ãƒ ãªä½ç½®ã«ç§»å‹•ï¼ˆã‚ªãƒ•ã‚£ã‚¹å†…å·¡å›ï¼‰
    if (Math.random() < 0.01) {  // 1%ã®ç¢ºç‡ã§ç§»å‹•
      const targetX = 100 + Math.random() * 600;
      const targetY = 100 + Math.random() * 300;
      employee.sprite.moveTo(targetX, targetY, 2000);
    }
  });
}
```

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. **Object Pooling**
```typescript
// ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã®å†åˆ©ç”¨ã§ãƒ¡ãƒ¢ãƒªç¢ºä¿ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›
class SpritePool {
  private pool: LayeredCharacter[] = [];

  acquire(config: CharacterConfig): LayeredCharacter {
    if (this.pool.length > 0) {
      const sprite = this.pool.pop()!;
      sprite.reconfigure(config);
      return sprite;
    }
    return new LayeredCharacter(scene, 0, 0, config);
  }

  release(sprite: LayeredCharacter): void {
    sprite.setVisible(false);
    this.pool.push(sprite);
  }
}
```

### 2. **ç”»é¢å¤–ã‚«ãƒªãƒ³ã‚°**
```typescript
// ç”»é¢å¤–ã®ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã¯æ›´æ–°ã‚’åœæ­¢
function cullOffscreenSprites(): void {
  const cameraBounds = phaserScene.cameras.main.getBounds();

  game.employees.forEach(employee => {
    const pos = employee.sprite.getPosition();
    const isVisible = Phaser.Geom.Rectangle.Contains(
      cameraBounds,
      pos.x,
      pos.y
    );

    employee.sprite.setActive(isVisible);
    employee.sprite.setVisible(isVisible);
  });
}
```

### 3. **LOD (Level of Detail)**
```typescript
// ã‚ºãƒ¼ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç°¡ç•¥åŒ–
function updateLOD(): void {
  const zoom = phaserScene.cameras.main.zoom;

  if (zoom < 0.5) {
    // æ¥µç«¯ã«ã‚ºãƒ¼ãƒ ã‚¢ã‚¦ãƒˆ â†’ é™æ­¢ç”»åƒã®ã¿
    game.employees.forEach(e => e.sprite.changeState(AnimationState.IDLE));
  } else if (zoom < 1.0) {
    // ä¸­è·é›¢ â†’ ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆåŠæ¸›
    game.employees.forEach(e => e.sprite.setFrameRate(4));
  } else {
    // é€šå¸¸è·é›¢ â†’ ãƒ•ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    game.employees.forEach(e => e.sprite.setFrameRate(8));
  }
}
```

---

## âœ… å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 3C: AIç”Ÿæˆã‚¹ãƒ—ãƒ©ã‚¤ãƒˆå°å…¥ï¼ˆåˆè¨ˆ: 6-8æ™‚é–“ï¼‰

#### **Part 1: æº–å‚™ãƒ»ãƒ„ãƒ¼ãƒ«é¸å®šï¼ˆ1æ™‚é–“ï¼‰**
- [ ] Pixela AIã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆï¼ˆç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§1è·ç¨®ç”Ÿæˆ
- [ ] å“è³ªãƒ»ã‚¹ã‚¿ã‚¤ãƒ«è©•ä¾¡
- [ ] æœ€çµ‚çš„ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç¢ºå®š

#### **Part 2: ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆç”Ÿæˆï¼ˆ3æ™‚é–“ï¼‰**
- [ ] é–‹ç™ºè€…ï¼ˆç”·å¥³ï¼‰: å„10ã‚·ãƒ¼ãƒˆç”Ÿæˆ
- [ ] å–¶æ¥­ï¼ˆç”·å¥³ï¼‰: å„10ã‚·ãƒ¼ãƒˆç”Ÿæˆ
- [ ] ä¼ç”»ï¼ˆç”·å¥³ï¼‰: å„10ã‚·ãƒ¼ãƒˆç”Ÿæˆ
- [ ] ç®¡ç†ï¼ˆç”·å¥³ï¼‰: å„10ã‚·ãƒ¼ãƒˆç”Ÿæˆ
- [ ] å¾Œå‡¦ç†ï¼ˆé€éèƒŒæ™¯ç¢ºèªãƒ»åœ§ç¸®ï¼‰

#### **Part 3: å®Ÿè£…ï¼ˆ3æ™‚é–“ï¼‰**
- [ ] `SpriteLoader.ts` å®Ÿè£…
- [ ] `LayeredCharacter.ts` å®Ÿè£…
- [ ] `game.ts` çµ±åˆ
- [ ] æ—¢å­˜ã®ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ãƒ«ç”Ÿæˆã‚³ãƒ¼ãƒ‰å‰Šé™¤

#### **Part 4: ãƒ†ã‚¹ãƒˆãƒ»èª¿æ•´ï¼ˆ1æ™‚é–“ï¼‰**
- [ ] å…¨è·ç¨®ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ç¢ºèª
- [ ] ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æ»‘ã‚‰ã‹ã•ç¢ºèª
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆFPS 60ç¶­æŒï¼‰
- [ ] ãƒã‚°ä¿®æ­£

---

## ğŸ“ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Š
1. **è¦–èªæ€§**: é ç›®ã§ã‚‚è·ç¨®ãŒä¸€ç›®ã§è­˜åˆ¥å¯èƒ½
2. **æ„›ç€**: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã«æ„Ÿæƒ…ç§»å…¥ã§ãã‚‹
3. **æ²¡å…¥æ„Ÿ**: æ»‘ã‚‰ã‹ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ªãƒ•ã‚£ã‚¹ãŒã€Œç”Ÿãã¦ã„ã‚‹ã€æ„Ÿè¦š
4. **å¤šæ§˜æ€§**: æ€§åˆ¥ãƒ»é«ªå‹ãƒ»æœè£…ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã§å€‹æ€§è¡¨ç¾

### æŠ€è¡“çš„ãƒ¡ãƒªãƒƒãƒˆ
1. **ä¿å®ˆæ€§**: ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ãƒ«ç”Ÿæˆã®è¤‡é›‘ãªã‚³ãƒ¼ãƒ‰ãŒä¸è¦ã«
2. **æ‹¡å¼µæ€§**: æ–°è·ç¨®ãƒ»æ–°è£…å‚™ã®è¿½åŠ ãŒå®¹æ˜“
3. **å“è³ª**: ãƒ—ãƒ­ãƒ¬ãƒ™ãƒ«ã®ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆ
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: æœ€é©åŒ–ã«ã‚ˆã‚Š60FPSç¶­æŒ

---

## ğŸ“š å‚è€ƒè³‡æ–™ãƒ»å¼•ç”¨

### æŠ€è¡“èª¿æŸ»
- **RimWorld Animation Analysis**: Phaser tile-based rendering, layered sprite system
- **2D Simulation Best Practices**: Strong key poses, secondary actions, visual differentiation
- **Phaser 3.90 Documentation**: Sprite sheets, animation manager, tween system

### ãƒ„ãƒ¼ãƒ«
- **Pixela AI**: https://pixela.ai/ - ã‚²ãƒ¼ãƒ ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆç‰¹åŒ–AI
- **TexturePacker**: https://www.codeandweb.com/texturepacker - ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚·ãƒ¼ãƒˆæœ€é©åŒ–
- **PNGCrush**: PNGåœ§ç¸®ï¼ˆå“è³ªåŠ£åŒ–ãªã—ï¼‰

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ä»Šã™ãé–‹å§‹**: Pixela AIã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã¨ãƒ†ã‚¹ãƒˆç”Ÿæˆï¼ˆ30åˆ†ï¼‰
2. **æœ¬æ—¥ä¸­**: 1è·ç¨®ã®å®Œå…¨ãªã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚»ãƒƒãƒˆç”Ÿæˆï¼ˆ2æ™‚é–“ï¼‰
3. **æ˜æ—¥**: å…¨è·ç¨®ãƒãƒƒãƒç”Ÿæˆ + å®Ÿè£…é–‹å§‹ï¼ˆ4æ™‚é–“ï¼‰
4. **2æ—¥å¾Œ**: ãƒ†ã‚¹ãƒˆãƒ»èª¿æ•´ãƒ»å®Œæˆï¼ˆ2æ™‚é–“ï¼‰

**åˆè¨ˆæ‰€è¦æ™‚é–“**: 8-10æ™‚é–“ã§**ã‚²ãƒ¼ãƒ ã®è¦‹ãŸç›®ãŒåŠ‡çš„ã«æ”¹å–„**ã—ã¾ã™ï¼

---

**ä½œæˆè€…**: Claude Code + AIãƒãƒ¼ãƒ å”åƒï¼ˆPerplexityæŠ€è¡“èª¿æŸ» + Geminiå®Ÿè£…åˆ†æï¼‰
**æ¬¡å›æ›´æ–°**: Phase 3Cå®Œäº†å¾Œ
**æœ€çµ‚ç›®æ¨™**: ã€ŒRimWorld Ã— ã‚«ã‚¤ãƒ­ã‚½ãƒ•ãƒˆã€ç´šã®é«˜å“è³ªãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«
