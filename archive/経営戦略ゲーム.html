<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ³ãƒ‘ã‚¤ã‚¢ - çµŒå–¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Sans', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .company-name { font-size: 22px; font-weight: bold; margin-bottom: 8px; }
        .date { font-size: 14px; opacity: 0.9; }
        .stats {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: rgba(255,255,255,0.1);
        }
        .stat { text-align: center; }
        .stat-label { font-size: 12px; opacity: 0.8; margin-bottom: 4px; }
        .stat-value { font-size: 18px; font-weight: bold; }
        
        /* ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚«ãƒ¼ */
        .news-ticker {
            background: #333;
            color: #ffd700;
            padding: 8px;
            overflow: hidden;
            white-space: nowrap;
            font-size: 12px;
        }
        .news-ticker span {
            display: inline-block;
            animation: scroll 20s linear infinite;
        }
        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        /* ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º */
        .ranking-bar {
            background: #f0f0f0;
            padding: 10px;
            display: flex;
            justify-content: space-around;
            font-size: 11px;
        }
        .rank-item {
            text-align: center;
            padding: 5px;
            border-radius: 5px;
        }
        .rank-item.player { background: #ffd700; font-weight: bold; }
        
        .tabs {
            display: flex;
            padding: 15px 15px 0;
            gap: 10px;
            overflow-x: auto;
            background: white;
        }
        .tab {
            padding: 10px 15px;
            background: #f0f0f0;
            border: none;
            border-radius: 10px 10px 0 0;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .content {
            padding: 20px;
            min-height: 400px;
            background: white;
        }
        .panel { display: none; }
        .panel.active { display: block; }
        .btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        .btn:disabled {
            background: #b0b0b0;
            cursor: not-allowed;
            box-shadow: none;
        }
        .btn:disabled:active { transform: none; }
        .btn:active { transform: scale(0.98); }
        #restartButton { display: none; }
        .employee {
            background: #f8f8f8;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        .employee-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .employee-name { font-weight: bold; font-size: 16px; }
        .personality {
            background: #667eea;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        .abilities {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        .ability { font-size: 13px; }
        .ability-name { color: #666; }
        .ability-value { font-weight: bold; color: #333; }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 350px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-title { font-size: 20px; font-weight: bold; margin-bottom: 15px; }
        .modal-close {
            width: 100%;
            padding: 12px;
            background: #e0e0e0;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 15px;
            cursor: pointer;
        }
        .empty { text-align: center; color: #999; padding: 40px 20px; }
        .product {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
        }
        .info-box {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        .competitor {
            background: #fff3cd;
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            border-left: 3px solid #ff9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="company-name">æ ªå¼ä¼šç¤¾ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—</div>
            <div class="date" id="gameDate">2025å¹´1æœˆ ç¬¬1é€±</div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">ğŸ’° è³‡é‡‘</div>
                    <div class="stat-value" id="money">1000ä¸‡</div>
                </div>
                <div class="stat">
                    <div class="stat-label">ğŸ‘¥ å¾“æ¥­å“¡</div>
                    <div class="stat-value" id="employeeCount">1</div>
                </div>
                <div class="stat">
                    <div class="stat-label">ğŸ“Š å£²ä¸Š</div>
                    <div class="stat-value" id="revenue">0ä¸‡</div>
                </div>
            </div>
        </div>

        <!-- ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚«ãƒ¼ -->
        <div class="news-ticker">
            <span id="newsText">ğŸ“° ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ITæ¥­ç•Œã§æˆåŠŸã‚’ç›®æŒ‡ãã†ï¼</span>
        </div>

        <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º -->
        <div class="ranking-bar" id="rankingBar">
            <div class="rank-item">1ä½: ãƒ†ãƒƒã‚¯ã‚³ãƒ¼ãƒ—(35%)</div>
            <div class="rank-item">2ä½: ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ¯ãƒ¼ã‚¯ã‚¹(29%)</div>
            <div class="rank-item">3ä½: ã‚µã‚¤ãƒãƒ¼ã‚½ãƒ•ãƒˆ(22%)</div>
            <div class="rank-item player">4ä½: ã‚ãªãŸ(0.1%)</div>
        </div>

        <div class="tabs">
            <button class="tab active" data-panel="overview" onclick="showPanel(this, 'overview')">ğŸ“Š æ¦‚è¦</button>
            <button class="tab" data-panel="employees" onclick="showPanel(this, 'employees')">ğŸ‘¥ äººäº‹</button>
            <button class="tab" data-panel="products" onclick="showPanel(this, 'products')">ğŸ“¦ è£½å“</button>
            <button class="tab" data-panel="market" onclick="showPanel(this, 'market')">ğŸ¢ å¸‚å ´</button>
            <button class="tab" data-panel="finance" onclick="showPanel(this, 'finance')">ğŸ’° è²¡å‹™</button>
        </div>

        <div class="content">
            <div id="overview" class="panel active">
                <h3>ğŸ¢ ä¼šç¤¾æ¦‚è¦</h3>
                <div class="info-box">
                    <div>æ¥­ç•Œ: ITãƒ»ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢</div>
                    <div>å¸‚å ´ã‚·ã‚§ã‚¢: <span id="marketShare">0.1%</span></div>
                    <div>ãƒ–ãƒ©ãƒ³ãƒ‰åŠ›: <span id="brand">â­</span></div>
                </div>
                <button class="btn" data-requires-active="true" onclick="nextTurn()">â­ï¸ æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã¸</button>
                <button class="btn" data-requires-active="true" onclick="saveGame()">ğŸ’¾ ã‚²ãƒ¼ãƒ ä¿å­˜</button>
                <button class="btn" id="restartButton" onclick="restartGame()">ğŸ”„ ã‚²ãƒ¼ãƒ å†ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            </div>

            <div id="employees" class="panel">
                <h3>ğŸ‘¥ å¾“æ¥­å“¡ç®¡ç†</h3>
                <div id="employeeList"></div>
                <button class="btn" data-requires-active="true" onclick="showHiring()">â• æ¡ç”¨æ´»å‹•</button>
                <button class="btn" data-requires-active="true" onclick="trainEmployees()">ğŸ“š ç ”ä¿®å®Ÿæ–½</button>
            </div>

            <div id="products" class="panel">
                <h3>ğŸ“¦ è£½å“é–‹ç™º</h3>
                <div id="productList"></div>
                <button class="btn" data-requires-active="true" onclick="developProduct()">ğŸ”§ æ–°è£½å“é–‹ç™º</button>
            </div>

            <div id="market" class="panel">
                <h3>ğŸ¢ å¸‚å ´çŠ¶æ³</h3>
                <div id="marketInfo"></div>
                <button class="btn" data-requires-active="true" onclick="doMarketing()">ğŸ“¢ ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°</button>
            </div>

            <div id="finance" class="panel">
                <h3>ğŸ’° è²¡å‹™çŠ¶æ³</h3>
                <div id="financeInfo"></div>
                <button class="btn" data-requires-active="true" onclick="getLoan()">ğŸ¦ éŠ€è¡Œèè³‡</button>
                <button class="btn" data-requires-active="true" onclick="repayLoan()">ğŸ’¸ èè³‡è¿”æ¸ˆ</button>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle"></div>
            <div id="modalBody"></div>
            <button class="modal-close" onclick="closeModal()">é–‰ã˜ã‚‹</button>
        </div>
    </div>
    <script>
        const defaultGameState = {
            money: 10000000,
            employees: [],
            products: [],
            turn: 1,
            year: 2025,
            month: 1,
            week: 1,
            marketShare: 0.1,
            brandPower: 1,
            monthlyRevenue: 0,
            debt: 0,
            isBankrupt: false
        };

        const LOAN_AMOUNT = 5000000;
        const LOAN_INTEREST_RATE = 0.02;
        const SAVE_KEY = 'businessEmpire';

        const game = cloneDefaults();
        let activePanel = 'overview';

        const competitors = [
            { name: 'ãƒ†ãƒƒã‚¯ã‚³ãƒ¼ãƒ—', share: 35, strategy: 'aggressive', power: 100 },
            { name: 'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ¯ãƒ¼ã‚¯ã‚¹', share: 29, strategy: 'balanced', power: 85 },
            { name: 'ã‚µã‚¤ãƒãƒ¼ã‚½ãƒ•ãƒˆ', share: 22, strategy: 'defensive', power: 70 }
        ];

        const newsTemplates = [
            '${company}ãŒæ–°è£½å“ã‚’ç™ºè¡¨ï¼æ¥­ç•Œã«è¡æ’ƒ',
            '${company}ã®å£²ä¸ŠãŒ${percent}%å¢—åŠ ',
            'ITæ¥­ç•Œã®æˆé•·ç‡ãŒ${percent}%ã«',
            '${company}ãŒå¤§å‹è²·åã‚’æ¤œè¨ä¸­',
            'æ–°æŠ€è¡“ã®ç™»å ´ã§å¸‚å ´ãŒæ´»æ€§åŒ–',
            '${company}ã®CEOãŒä»Šå¾Œã®æˆ¦ç•¥ã‚’èªã‚‹',
            'ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ä¼æ¥­ã®å‚å…¥ãŒç›¸æ¬¡ã'
        ];

        function cloneDefaults() {
            return JSON.parse(JSON.stringify(defaultGameState));
        }

        function overwriteGameState(source) {
            Object.keys(game).forEach(key => delete game[key]);
            Object.assign(game, source);
        }

        function ensureCollections() {
            if (!Array.isArray(game.employees)) game.employees = [];
            if (!Array.isArray(game.products)) game.products = [];
        }

        function normalizeGameState() {
            ensureCollections();
            game.money = Number(game.money) || 0;
            game.turn = Number(game.turn) || 1;
            game.year = Number(game.year) || 2025;
            game.month = Number(game.month) || 1;
            game.week = Number(game.week) || 1;
            game.marketShare = Number(game.marketShare) || 0;
            game.brandPower = Number(game.brandPower) || 0;
            game.monthlyRevenue = Number(game.monthlyRevenue) || 0;
            game.debt = Math.max(0, Number(game.debt) || 0);
            game.isBankrupt = Boolean(game.isBankrupt);
            game.employees.forEach(emp => {
                emp.salary = Number(emp.salary) || 0;
                if (typeof emp.abilities !== 'object' || emp.abilities === null) {
                    emp.abilities = { technical: 0, sales: 0, planning: 0, management: 0 };
                }
                Object.keys(emp.abilities).forEach(key => {
                    emp.abilities[key] = Number(emp.abilities[key]) || 0;
                });
            });
            game.products.forEach(product => {
                product.sales = Number(product.sales) || 0;
                product.quality = Number(product.quality) || 0;
            });
        }

        function resetGameState() {
            overwriteGameState(cloneDefaults());
            normalizeGameState();
            activePanel = 'overview';
        }

        function addInitialEmployee() {
            ensureCollections();
            if (game.employees.length > 0) return;
            const initialEmployee = {
                id: 1,
                name: 'å±±ç”° å¤ªéƒ',
                personality: 'ã¾ã˜ã‚',
                abilities: { technical: 65, sales: 45, planning: 55, management: 50 },
                motivation: 75,
                salary: 400000,
                department: 'é–‹ç™ºéƒ¨'
            };
            game.employees.push(initialEmployee);
        }

        function loadGameFromStorage() {
            try {
                const saved = localStorage.getItem(SAVE_KEY);
                if (!saved) return false;
                const parsed = JSON.parse(saved);
                const merged = Object.assign(cloneDefaults(), parsed);
                overwriteGameState(merged);
                normalizeGameState();
                activePanel = typeof parsed.activePanel === 'string' ? parsed.activePanel : 'overview';
                delete game.activePanel;
                return true;
            } catch (error) {
                console.error('Failed to load save data', error);
                return false;
            }
        }

        function init() {
            const loaded = loadGameFromStorage();
            if (!loaded) {
                resetGameState();
                addInitialEmployee();
            } else {
                normalizeGameState();
                if (game.employees.length === 0) addInitialEmployee();
            }
            generateNews();
            updateDisplay();
            updateRanking();
            showPanel(null, activePanel);
        }

        function generateNews() {
            const template = newsTemplates[Math.floor(Math.random() * newsTemplates.length)];
            const company = competitors[Math.floor(Math.random() * competitors.length)].name;
            const percent = Math.floor(Math.random() * 30) + 10;
            const news = template.replace('${company}', company).replace('${percent}', percent);
            document.getElementById('newsText').textContent = 'ğŸ“° ' + news;
        }

        function updateCompetitors() {
            competitors.forEach(comp => {
                if (game.marketShare > 5) {
                    if (comp.strategy === 'aggressive') {
                        comp.power += 5;
                        generateNews();
                    }
                }
                if (comp.strategy === 'aggressive') {
                    comp.share += Math.random() * 2;
                } else if (comp.strategy === 'defensive') {
                    comp.share -= Math.random();
                }
                comp.share = Math.max(5, Math.min(60, comp.share));
                if (comp.share > 40) {
                    game.marketShare = Math.max(0.1, game.marketShare - 0.2);
                    if (game.brandPower > 1) {
                        game.brandPower--;
                    }
                }
            });
        }

        function updateRanking() {
            const allCompanies = [
                ...competitors.map(c => ({ name: c.name, share: c.share })),
                { name: 'ã‚ãªãŸ', share: game.marketShare, isPlayer: true }
            ].sort((a, b) => b.share - a.share);

            const rankingHtml = allCompanies.slice(0, 4).map((company, index) =>
                `<div class="rank-item ${company.isPlayer ? 'player' : ''}">
                    ${index + 1}ä½: ${company.name}(${company.share.toFixed(1)}%)
                </div>`
            ).join('');

            document.getElementById('rankingBar').innerHTML = rankingHtml;
        }

        function showPanel(tabButton, panelId) {
            const targetPanelId = panelId || 'overview';
            const targetTab = tabButton || document.querySelector(`.tab[data-panel="${targetPanelId}"]`);
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            if (targetTab) {
                targetTab.classList.add('active');
            }
            document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
            const panelElement = document.getElementById(targetPanelId);
            if (panelElement) {
                panelElement.classList.add('active');
            }
            activePanel = targetPanelId;
            renderActivePanel();
        }

        function renderActivePanel() {
            if (activePanel === 'employees') {
                renderEmployees();
            } else if (activePanel === 'products') {
                renderProducts();
            } else if (activePanel === 'market') {
                renderMarket();
            } else if (activePanel === 'finance') {
                renderFinance();
            }
        }

        function updateDisplay() {
            document.getElementById('money').textContent = `${Math.floor(game.money / 10000)}ä¸‡`;
            document.getElementById('employeeCount').textContent = game.employees.length;
            document.getElementById('revenue').textContent = `${Math.floor(game.monthlyRevenue / 10000)}ä¸‡`;
            document.getElementById('gameDate').textContent = `${game.year}å¹´${game.month}æœˆ ç¬¬${game.week}é€±`;
            document.getElementById('marketShare').textContent = `${game.marketShare.toFixed(1)}%`;
            const brandCount = Math.max(0, Math.min(5, Math.floor(game.brandPower)));
            document.getElementById('brand').textContent = brandCount > 0 ? 'â­'.repeat(brandCount) : 'â€•';
            updateControls();
        }

        function updateControls() {
            const disabled = game.isBankrupt;
            document.querySelectorAll('[data-requires-active="true"]').forEach(btn => {
                btn.disabled = disabled;
            });
            const restartBtn = document.getElementById('restartButton');
            if (restartBtn) {
                restartBtn.style.display = disabled ? 'block' : 'none';
            }
        }

        function renderEmployees() {
            const list = document.getElementById('employeeList');
            if (game.employees.length === 0) {
                list.innerHTML = '<div class="empty">å¾“æ¥­å“¡ãŒã„ã¾ã›ã‚“</div>';
                return;
            }
            list.innerHTML = game.employees.map(emp => `
                <div class="employee">
                    <div class="employee-header">
                        <div class="employee-name">${emp.name}</div>
                        <span class="personality">${emp.personality}</span>
                    </div>
                    <div class="abilities">
                        <div class="ability">
                            <span class="ability-name">æŠ€è¡“:</span>
                            <span class="ability-value">${emp.abilities.technical}</span>
                        </div>
                        <div class="ability">
                            <span class="ability-name">å–¶æ¥­:</span>
                            <span class="ability-value">${emp.abilities.sales}</span>
                        </div>
                    </div>
                    <div>æœˆçµ¦: ${Math.floor(emp.salary / 10000)}ä¸‡å††</div>
                </div>
            `).join('');
        }

        function renderProducts() {
            const list = document.getElementById('productList');
            if (game.products.length === 0) {
                list.innerHTML = '<div class="empty">è£½å“ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            list.innerHTML = game.products.map(product => `
                <div class="product">
                    <div style="font-weight: bold;">${product.name}</div>
                    <div>å“è³ª: ${product.quality}%</div>
                    <div>ç´¯è¨ˆå£²ä¸Š: ${Math.floor(product.sales / 10000)}ä¸‡å††</div>
                </div>
            `).join('');
        }

        function renderMarket() {
            const info = document.getElementById('marketInfo');
            info.innerHTML = `
                <h4>ğŸ† ç«¶åˆä¼æ¥­</h4>
                ${competitors.map(comp => `
                    <div class="competitor">
                        <strong>${comp.name}</strong>
                        <div>å¸‚å ´ã‚·ã‚§ã‚¢: ${comp.share.toFixed(1)}%</div>
                        <div>æˆ¦ç•¥: ${comp.strategy === 'aggressive' ? 'æ”»æ’ƒçš„' :
                                   comp.strategy === 'balanced' ? 'ãƒãƒ©ãƒ³ã‚¹å‹' : 'å®ˆå‚™çš„'}</div>
                    </div>
                `).join('')}
            `;
        }

        function renderFinance() {
            const info = document.getElementById('financeInfo');
            const salaryTotal = game.employees.reduce((sum, emp) => sum + emp.salary, 0);
            const interestPreview = game.debt > 0 ? Math.floor(game.debt * LOAN_INTEREST_RATE) : 0;
            info.innerHTML = `
                <div class="info-box">
                    <div>å£²ä¸Šé«˜: ${Math.floor(game.monthlyRevenue / 10000)}ä¸‡å††</div>
                    <div>äººä»¶è²»: ${Math.floor(salaryTotal / 10000)}ä¸‡å††</div>
                    <div>ç´”åˆ©ç›Š: ${Math.floor((game.monthlyRevenue - salaryTotal - interestPreview) / 10000)}ä¸‡å††</div>
                    ${game.debt ? `<div>å€Ÿé‡‘æ®‹é«˜: ${Math.floor(game.debt / 10000)}ä¸‡å††</div>` : ''}
                    ${interestPreview ? `<div>æ¬¡æœˆåˆ©æ¯è¦‹è¾¼: ${Math.floor(interestPreview / 10000)}ä¸‡å††</div>` : ''}
                </div>
            `;
        }

        function requireCompanyActive() {
            if (!game.isBankrupt) return true;
            showModal('æ“ä½œä¸å¯', 'å€’ç”£çŠ¶æ…‹ã®ãŸã‚æ“ä½œã§ãã¾ã›ã‚“ã€‚å†ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚');
            return false;
        }

        function showHiring() {
            if (!requireCompanyActive()) return;
            if (game.money < 200000) {
                showModal('æ¡ç”¨å¤±æ•—', 'è³‡é‡‘ä¸è¶³ã§ã™ï¼ˆæœ€ä½20ä¸‡å††å¿…è¦ï¼‰');
                return;
            }
            const names = ['ä½è—¤', 'éˆ´æœ¨', 'é«˜æ©‹', 'ç”°ä¸­'];
            const firstNames = ['å¤ªéƒ', 'èŠ±å­', 'ä¸€éƒ', 'ç¾å’²'];
            const personalities = ['ã™ãªãŠ', 'ã¾ã˜ã‚', 'ãŠèª¿å­è€…', 'é‡å¿ƒå®¶', 'å”èª¿çš„'];

            const candidate = {
                id: Date.now(),
                name: names[Math.floor(Math.random() * names.length)] + ' ' +
                      firstNames[Math.floor(Math.random() * firstNames.length)],
                personality: personalities[Math.floor(Math.random() * personalities.length)],
                abilities: {
                    technical: 30 + Math.floor(Math.random() * 50),
                    sales: 30 + Math.floor(Math.random() * 50),
                    planning: 30 + Math.floor(Math.random() * 50),
                    management: 30 + Math.floor(Math.random() * 50)
                },
                motivation: 70,
                salary: 300000 + Math.floor(Math.random() * 200000),
                department: 'é–‹ç™ºéƒ¨'
            };

            const html = `
                <div>å€™è£œè€…: ${candidate.name}</div>
                <div>æ€§æ ¼: ${candidate.personality}</div>
                <div>æŠ€è¡“: ${candidate.abilities.technical}</div>
                <div>å–¶æ¥­: ${candidate.abilities.sales}</div>
                <div>å¸Œæœ›çµ¦ä¸: ${Math.floor(candidate.salary / 10000)}ä¸‡å††/æœˆ</div>
                <button class="btn" onclick="hireEmployee(${JSON.stringify(candidate).replace(/"/g, '&quot;')})">æ¡ç”¨ã™ã‚‹</button>
            `;
            showModal('æ¡ç”¨é¢æ¥', html);
        }

        function hireEmployee(candidate) {
            if (!requireCompanyActive()) return;
            if (game.money < candidate.salary * 3) {
                showModal('æ¡ç”¨å¤±æ•—', 'è³‡é‡‘ä¸è¶³ã§ã™');
                return;
            }
            game.money -= candidate.salary * 3;
            game.employees.push(candidate);
            updateDisplay();
            renderActivePanel();
            closeModal();
            showModal('æ¡ç”¨æˆåŠŸ', `${candidate.name}ã•ã‚“ã‚’æ¡ç”¨ã—ã¾ã—ãŸï¼`);
        }

        function trainEmployees() {
            if (!requireCompanyActive()) return;
            if (game.employees.length === 0) {
                showModal('ç ”ä¿®å¤±æ•—', 'å¾“æ¥­å“¡ãŒã„ã¾ã›ã‚“');
                return;
            }
            const cost = 300000 * game.employees.length;
            if (game.money < cost) {
                showModal('ç ”ä¿®å¤±æ•—', `è³‡é‡‘ä¸è¶³ã§ã™ï¼ˆå¿…è¦: ${cost / 10000}ä¸‡å††ï¼‰`);
                return;
            }
            game.money -= cost;
            game.employees.forEach(emp => {
                Object.keys(emp.abilities).forEach(key => {
                    emp.abilities[key] = Math.min(100, emp.abilities[key] + 10);
                });
            });
            updateDisplay();
            renderActivePanel();
            showModal('ç ”ä¿®å®Œäº†', 'å¾“æ¥­å“¡ã®ã‚¹ã‚­ãƒ«ãŒå‘ä¸Šã—ã¾ã—ãŸï¼');
        }

        function developProduct() {
            if (!requireCompanyActive()) return;
            if (game.employees.length < 2) {
                showModal('é–‹ç™ºå¤±æ•—', 'æœ€ä½2åã®å¾“æ¥­å“¡ãŒå¿…è¦ã§ã™');
                return;
            }
            if (game.money < 2000000) {
                showModal('é–‹ç™ºå¤±æ•—', 'è³‡é‡‘ä¸è¶³ã§ã™ï¼ˆ200ä¸‡å††å¿…è¦ï¼‰');
                return;
            }
            game.money -= 2000000;
            const product = {
                id: Date.now(),
                name: `è£½å“${game.products.length + 1}`,
                quality: 50 + Math.floor(Math.random() * 30),
                sales: 0
            };
            game.products.push(product);
            updateDisplay();
            renderActivePanel();
            showModal('é–‹ç™ºæˆåŠŸ', `${product.name}ã‚’é–‹ç™ºã—ã¾ã—ãŸï¼`);
        }

        function doMarketing() {
            if (!requireCompanyActive()) return;
            if (game.money < 1000000) {
                showModal('å®Ÿæ–½å¤±æ•—', 'è³‡é‡‘ä¸è¶³ã§ã™ï¼ˆ100ä¸‡å††å¿…è¦ï¼‰');
                return;
            }
            game.money -= 1000000;
            game.marketShare = Math.min(15, game.marketShare + 0.3);
            game.brandPower = Math.min(5, game.brandPower + 1);
            updateDisplay();
            renderActivePanel();
            updateRanking();
            showModal('ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆåŠŸ', 'å¸‚å ´ã‚·ã‚§ã‚¢ã¨ãƒ–ãƒ©ãƒ³ãƒ‰åŠ›ãŒå‘ä¸Šï¼');
        }

        function getLoan() {
            if (!requireCompanyActive()) return;
            game.money += LOAN_AMOUNT;
            game.debt += LOAN_AMOUNT;
            updateDisplay();
            renderActivePanel();
            showModal('èè³‡å®Ÿè¡Œ', `500ä¸‡å††ã®èè³‡ã‚’å—ã‘ã¾ã—ãŸï¼ˆåˆ©ç‡: ${(LOAN_INTEREST_RATE * 100).toFixed(1)}%/æœˆï¼‰`);
        }

        function repayLoan() {
            if (!requireCompanyActive()) return;
            if (game.debt <= 0) {
                showModal('è¿”æ¸ˆä¸è¦', 'ç¾åœ¨ã®å€Ÿå…¥ã¯ã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            const maxRepay = Math.min(game.debt, game.money);
            if (maxRepay <= 0) {
                showModal('è¿”æ¸ˆå¤±æ•—', 'è¿”æ¸ˆã«å……ã¦ã‚‹è³‡é‡‘ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            game.money -= maxRepay;
            game.debt -= maxRepay;
            updateDisplay();
            renderActivePanel();
            showModal('è¿”æ¸ˆå®Œäº†', `${Math.floor(maxRepay / 10000)}ä¸‡å††ã‚’è¿”æ¸ˆã—ã¾ã—ãŸ`);
        }

        function nextTurn() {
            if (!requireCompanyActive()) return;
            game.turn++;
            game.week++;
            if (game.week > 4) {
                game.week = 1;
                game.month++;
                if (game.month > 12) {
                    game.month = 1;
                    game.year++;
                }
                let revenue = 0;
                game.products.forEach(product => {
                    const productRevenue = product.quality * 10000;
                    product.sales += productRevenue;
                    revenue += productRevenue;
                });
                const salaryTotal = game.employees.reduce((sum, emp) => sum + emp.salary, 0);
                const interest = game.debt > 0 ? Math.floor(game.debt * LOAN_INTEREST_RATE) : 0;
                game.monthlyRevenue = revenue;
                const profit = revenue - salaryTotal - interest;
                game.money += profit;
                if (game.money < 0) {
                    game.isBankrupt = true;
                    updateDisplay();
                    renderActivePanel();
                    updateRanking();
                    showModal('ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼', 'è³‡é‡‘ä¸è¶³ã§å€’ç”£ã—ã¾ã—ãŸ... å†ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                const summaryLines = [
                    `å£²ä¸Š: ${Math.floor(revenue / 10000)}ä¸‡å††`,
                    `äººä»¶è²»: ${Math.floor(salaryTotal / 10000)}ä¸‡å††`
                ];
                if (interest > 0) {
                    summaryLines.push(`åˆ©æ¯: ${Math.floor(interest / 10000)}ä¸‡å††`);
                }
                summaryLines.push(`æœ€çµ‚åˆ©ç›Š: ${Math.floor((revenue - salaryTotal - interest) / 10000)}ä¸‡å††`);
                showModal('æœˆæ¬¡æ±ºç®—', summaryLines.join('\n'));
                updateCompetitors();
                generateNews();
            }
            updateDisplay();
            renderActivePanel();
            updateRanking();
        }

        function saveGame() {
            if (!requireCompanyActive()) return;
            try {
                const saveData = Object.assign({}, game, { activePanel });
                localStorage.setItem(SAVE_KEY, JSON.stringify(saveData));
                showModal('ä¿å­˜å®Œäº†', 'ã‚²ãƒ¼ãƒ ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Failed to save game', error);
                showModal('ä¿å­˜å¤±æ•—', 'ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function restartGame() {
            closeModal();
            resetGameState();
            addInitialEmployee();
            updateDisplay();
            renderEmployees();
            renderProducts();
            renderMarket();
            renderFinance();
            updateRanking();
            showPanel(null, 'overview');
            generateNews();
            localStorage.removeItem(SAVE_KEY);
            showModal('å†ã‚¹ã‚¿ãƒ¼ãƒˆ', 'æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¾ã—ãŸ');
        }

        function showModal(title, body) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = body.replace(/\n/g, '<br>');
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        init();
    </script>

</body>
</html>
